@prefix fhir: <http://hl7.org/fhir/> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sct: <http://snomed.info/id/> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

# - resource -------------------------------------------------------------------

<http://cqframework.org/cpg-example-anthrax/Library/anthrax-post-exposure-prophylaxis-library> a fhir:Library ;
  fhir:nodeRole fhir:treeRoot ;
  fhir:id [ fhir:v "anthrax-post-exposure-prophylaxis-library"] ; # 
  fhir:text [
     fhir:status [ fhir:v "generated" ] ;
     fhir:div "<div xmlns=\"http://www.w3.org/1999/xhtml\"><p class=\"res-header-id\"><b>Generated Narrative: Library anthrax-post-exposure-prophylaxis-library</b></p><a name=\"anthrax-post-exposure-prophylaxis-library\"> </a><a name=\"hcanthrax-post-exposure-prophylaxis-library\"> </a><a name=\"anthrax-post-exposure-prophylaxis-library-en-US\"> </a><h2>Participants</h2><table class=\"grid\"><tr><td>Author</td><td>Alliance to Modernize Healthcare FFRDC</td></tr><tr><td>Endorser</td><td>Centers for Disease Control and Prevention</td></tr></table><h2>Contents</h2><p><code>text/cql</code></p><pre><code>/*  Library: Anthrax Post Exposure Prophylaxis (PEP) for Adults, FHIR R4 data model.\n    Author: CMS Alliance to Modernize Healthcare, operated by THE MITRE Corporation.\n\n    (C) 2019 The MITRE Corporation. All Rights Reserved. Approved for Public Release: 19-2048. Distribution Unlimited.\n\n    Change log:\n    - Version 1.1.0: Updated output resources to align with draft profiles posted at:\n    http://build.fhir.org/ig/HL7/cqf-recommendations/profiles.html\n    Also refactored CQL to put CDC-specific functions in a seperate library.\n*/\nlibrary Anthrax_Post_Exposure_Prophylaxis_Adults_FHIRv400 version '1.1.0'\n\n/* ------------- REFERENCES ----------------------------------------------------\n- Hendricks, K.A. et al., Centers for Disease Control and Prevention Expert Panel Meetings on Prevention and Treatment of Anthrax in Adults. Emerg Infect Dis, 20(20), Feb 2014.\n- Hendricks, K.A. et al., Centers for Disease Control and Prevention Expert Panel Meetings on Prevention and Treatment of Anthrax in Adults: Technical Report. Emerg Infect Dis. 20(20), Feb 2014.\n- Emergent BioSolutions, BioThrax Anthrax Vaccine Adsorbed (http://www.biothrax.com/whatisbiothrax/).\n- Centers for Disease Control and Prevention, Ciprofloxacin for Post-Exposure Prophylaxis of Anthrax: Emergency Use Instructions for Healthcare Providers, 2017.\n- Centers for Disease Control and Prevention. Doxycyxcline for Post-Exposure Prophylaxis of Anthrax: Emergency Use Instructions for Healthcare Providers, 2017.\n- Public Health Information Network Vocabulary Access and Distribution System (PHIN VADS), PHVS_SignsSymptoms_Anthrax (OID 2.16.840.1.114222.4.11.3212), 2009.\n- Meanye-Delman D et al., Special Considerations for Prophylaxis for and Treatment of Anthrax in Pregnant and Postpartum Women, Emerg Infect Dis, 20(2), 2014.\n- Meanye-Delman D et al., Special Considerations for Prophylaxis for and Treatment of Anthrax in Pregnant and Postpartum Women: Technical Report, Emerg Infect Dis, 20(2), 2014.\n- Wright, J.G et al., Use of Anthrax Vaccine in the United States: Recommendations of the Advisory Committee on Immunization Practices (ACIP), 2009, Morbidity and Mortality Weekly Report, July 23, 2010 / 59(RR06); 1-30.\n*/\n\n/* ------------- KEY ASSUMPTIONS -----------------------------------------------\n1. Anthrax exposure represented by one of two codes in either a Condition or Observation FHIR R4 resource. The parameter Exposure_Look_Back_Period controls how far back to filter potential exposure resources. Default is 60 days.\n2. Asymptomatic represented by SNOMED-CT code 84387000 in an Observation FHIR R4 resource. Asymptomatic Observation must occur on the same day or after the exposure date.\n3. Existing antimicrobial Rx found by querying MedicationRequest and MedicationStatement FHIR R4 resources.\n4. Administration of the Anthrax vaccine represented by one of the sequential SNOMED-CT procedure codes. This is how past doses are discovered via querying for Procedure FHIR resources.\n5. The recommended spacing between subsequent doses of the vaccine is controlled by the parameter Spacing_Between_Vaccine_Doses, which has a default value of two weeks. A patient undergoing Anthrax PEP will only be recommended their next vaccine dose if two weeks have elapsed since their last and if they have not received the recommended allotmant of three doses.\n6. Pregnancy can be represented as an Observation or a Condition FHIR R4 resource. Both types of resouces are examined to determine if the patient is pregnant.\n7. Allergies are discovered by querying for AllergyIntolerance FHIR R4 resources that contain ingredient/substance codes for any of the potentially recommended PEP treatments. This includes the antimicrobials, the vaccine, and latex.\n8. Alerts are communicated via either DetectedIssue or Flag FHIR resources.\n9. Aside from the alerts, the main output of this CDS is an order set. It is represented via FHIR R4 resources (ActivityDefinition and PlanDefinition).\n10. This CDS outputs various FHIR resource objects. For the purposes of local FHIR references, it is assumed all generated FHIR resources will be returned in a single FHIR bundle.\n*/\n\n// Data model\nusing FHIR version '4.0.0'\n\n// ------------- LIBRARIES --------------------------------------------------\n// The CDS Connect Commons for FHIRv400 library provides functions representing\n// commonly used CDS logic and patterns.\ninclude CDS_Connect_Commons_for_FHIRv400 version '1.3.2' called C3F\n// The FHIRHelpers library provides functions for working with FHIR resources.\ninclude FHIRHelpers version '4.0.0' called FHIRHelpers\n// More common logic for CDC CDS\ninclude CDC_Common_Logic_FHIRv400 version '1.0.0' called CCL\n\n// ------------- CODE SYSTEMS --------------------------------------------------\ncodesystem &quot;LOINC&quot;: 'http://loinc.org'\ncodesystem &quot;SNOMED-CT&quot;: 'http://snomed.info/sct'\ncodesystem &quot;ICD-10-CM&quot;: 'http://hl7.org/fhir/sid/icd-10-cm'\ncodesystem &quot;RXNORM&quot;: 'http://www.nlm.nih.gov/research/umls/rxnorm'\ncodesystem &quot;ACTCODE&quot;: 'http://terminology.hl7.org/CodeSystem/v3-ActCode'\ncodesystem &quot;CVX&quot;: 'http://hl7.org/fhir/sid/cvx'\ncodesystem &quot;FHIR-ACTION-TYPE&quot;: 'http://terminology.hl7.org/CodeSystem/action-type'\ncodesystem &quot;FHIR-PLANDEFINITION-TYPE&quot;: 'http://terminology.hl7.org/CodeSystem/plan-definition-type'\ncodesystem &quot;FHIR-USAGE-CONTEXT-TYPE&quot;: 'http://terminology.hl7.org/CodeSystem/usage-context-type'\ncodesystem &quot;ISO-3166-COUNTRY-CODES&quot;: 'urn:iso:std:iso:3166'\n\n// ------------- VALUE SETS ----------------------------------------------------\nvalueset &quot;Ciprofloxacin medications&quot;: '2.16.840.1.113762.1.4.1032.67'\nvalueset &quot;Doxycycline medications&quot;: '2.16.840.1.113762.1.4.1032.66'\nvalueset &quot;Levofloxacin medications&quot;: '2.16.840.1.113762.1.4.1032.69'\nvalueset &quot;Moxifloxacin medications&quot;: '2.16.840.1.113762.1.4.1032.70'\nvalueset &quot;Clindamycin medications&quot;: '2.16.840.1.113762.1.4.1032.68'\nvalueset &quot;Latex&quot;: '2.16.840.1.113762.1.4.1032.76'\nvalueset &quot;Pregnancy&quot;: '2.16.840.1.113883.3.526.3.378'\n\n// ------------- CODES ---------------------------------------------------------\n// Exposure codes\ncode &quot;Exposure to Anthrax code&quot;: 'Z20.810' from &quot;ICD-10-CM&quot; display 'Exposure to Anthrax'\ncode &quot;Exposure to Bacillus anthracis (event) code&quot;: '170475009' from &quot;SNOMED-CT&quot;\n  display 'Exposure to Bacillus anthracis (event)'\n\n// Asymptomatic code.\ncode &quot;Asymptomatic code&quot;: '84387000' from &quot;SNOMED-CT&quot; display 'Asymptomatic (finding)'\n\n// Pregnancy codes.\ncode &quot;Pregnancy status code&quot;: '82810-3' from &quot;LOINC&quot; display 'Pregnancy status'\ncode &quot;Pregnant code&quot;: '77386006' from &quot;SNOMED-CT&quot; display 'Patient currently pregnant (finding)'\n\n// Anthrax vaccine represented as four separate codes, one for each sequentially administered dose.\ncode &quot;Anthrax vaccination code&quot;: '49598002' from &quot;SNOMED-CT&quot; display 'Anthrax vaccination (procedure)'\ncode &quot;First anthrax vaccination code&quot;: '170338000' from &quot;SNOMED-CT&quot; display 'First anthrax vaccination (procedure)'\ncode &quot;Second anthrax vaccination code&quot;: '170339008' from &quot;SNOMED-CT&quot; display 'Second anthrax vaccination (procedure)'\ncode &quot;Third anthrax vaccination code&quot;: '170340005' from &quot;SNOMED-CT&quot; display 'Third anthrax vaccination (procedure)'\ncode &quot;Fourth anthrax vaccination code&quot;: '170341009' from &quot;SNOMED-CT&quot; display 'Fourth anthrax vaccination (procedure)'\n\n// Recommended antimicrobials each represented by a single RxNorm code.\ncode &quot;Ciprofloxacin Rx code&quot;: '309309' from &quot;RXNORM&quot; display 'Ciprofloxacin 500 MG Oral Tablet'\ncode &quot;Doxycycline Rx code&quot;: '1650143' from &quot;RXNORM&quot; display 'doxycycline hyclate 100 MG Oral Tablet'\ncode &quot;Levofloxacin Rx code&quot;: '311296' from &quot;RXNORM&quot; display 'Levofloxacin 750 MG Oral Tablet'\ncode &quot;Moxifloxacin Rx code&quot;: '311787' from &quot;RXNORM&quot; display 'moxifloxacin HCl 400 MG Oral Tablet'\ncode &quot;Clindamycin Rx code&quot;: '284215' from &quot;RXNORM&quot; display 'clindamycin HCl 300 MG Oral Capsule'\n\n// Codes for substances, needed to help check for certain allergies.\ncode &quot;Ciprofloxacin substance code&quot;: '2551' from &quot;RXNORM&quot; display 'Ciprofloxacin (substance/ingredient)'\ncode &quot;Doxycycline substance code&quot;: '3640' from &quot;RXNORM&quot; display 'Doxycycline (substance/ingredient)'\ncode &quot;Levofloxacin substance code&quot;: '82122' from &quot;RXNORM&quot; display 'Levofloxacin (substance/ingredient)'\ncode &quot;Moxifloxacin substance code&quot;: '139462' from &quot;RXNORM&quot; display 'Moxifloxacin (substance/ingredient)'\ncode &quot;Clindamycin substance code&quot;: '2582' from &quot;RXNORM&quot; display 'Clindamycin (substance/ingredient)'\ncode &quot;Latex substance code&quot;: '1314891' from &quot;RXNORM&quot; display 'Latex (substance/ingredient)'\ncode &quot;Anthrax vaccine substance code&quot;: '404774' from &quot;RXNORM&quot; display 'Anthrax Vaccine Absorbed (substance/ingredient)'\ncode &quot;Anthrax vaccine CVX code&quot;: '24' from &quot;CVX&quot; display 'Anthrax vaccine'\n\n// Alert codes\ncode &quot;Device code&quot;: '701002007' from &quot;SNOMED-CT&quot; display 'Clinical data collection/management information system application software (physical object)'\ncode &quot;Document signs and symptoms code&quot;: '223447008' from &quot;SNOMED-CT&quot; display 'Recommendation to document signs and symptoms (procedure)'\ncode &quot;Medication review code&quot;: '314529007' from &quot;SNOMED-CT&quot; display 'Medication review due (situation)'\ncode &quot;Not equivalent alert code&quot;: 'NOTEQUIV' from &quot;ACTCODE&quot; display 'Not equivalent alert'\ncode &quot;Timing detected issue code&quot;: 'TIME' from &quot;ACTCODE&quot; display 'Timing detected issue'\ncode &quot;Verify allergy status code&quot;: '370860007' from &quot;SNOMED-CT&quot; display 'Verification of allergy status (procedure)'\n\n// Order set codes\ncode &quot;FHIR ActionType create code&quot;: 'create' from &quot;FHIR-ACTION-TYPE&quot; display 'Create'\ncode &quot;FHIR PlanDefinition eca-rule code&quot;: 'eca-rule' from &quot;FHIR-PLANDEFINITION-TYPE&quot; display 'ECA Rule'\ncode &quot;FHIR PlanDefinition order-set code&quot;: 'order-set' from &quot;FHIR-PLANDEFINITION-TYPE&quot; display 'Order Set'\ncode &quot;FHIR age range usage context code&quot;: 'age' from &quot;FHIR-USAGE-CONTEXT-TYPE&quot; display 'Age Range'\ncode &quot;FHIR clinical focus usage context code&quot;: 'focus' from &quot;FHIR-USAGE-CONTEXT-TYPE&quot; display 'Clinical Focus'\ncode &quot;FHIR clinical venue usage context code&quot;: 'venue' from &quot;FHIR-USAGE-CONTEXT-TYPE&quot; display 'Clinical Venue'\ncode &quot;SNOMED outpatient code&quot;: '440655000' from &quot;SNOMED-CT&quot; display 'Outpatient environment'\ncode &quot;United States code&quot;: 'US' from &quot;ISO-3166-COUNTRY-CODES&quot; display 'United States of America'\ncode &quot;Oral route code&quot;: '26643006' from &quot;SNOMED-CT&quot; display 'Oral Route'\ncode &quot;Swallow dosing instruction code&quot;: '421521009' from &quot;SNOMED-CT&quot; display 'Swallow - dosing instruction imperative (qualifier value)'\ncode &quot;Subcutaneous route code&quot;: '34206005' from &quot;SNOMED-CT&quot; display 'Subcutaneous route'\n\n// ------------- CONCEPTS ------------------------------------------------------\n// Exposure is represented by two codes, one from ICD10 one from SNOMED-CT.\nconcept &quot;Anthrax exposure&quot;: { &quot;Exposure to Anthrax code&quot;, &quot;Exposure to Bacillus anthracis (event) code&quot; } display 'Anthrax exposure'\n\n// Asymptomatic is represented by a single SNOMED-CT code.\nconcept &quot;AsymptomaticConcept&quot;: { &quot;Asymptomatic code&quot; } display 'Asymptomatic'\nconcept &quot;Anthrax vaccine&quot;: { &quot;Anthrax vaccine substance code&quot;, &quot;Anthrax vaccine CVX code&quot;} display 'Anthrax vaccine'\n\n// Pregnancy can be represented as a status, an observation, or a condition (see valueset above).\nconcept &quot;Pregnancy status&quot;: { &quot;Pregnancy status code&quot; } display 'Pregnancy status'\nconcept &quot;Pregnant&quot;: { &quot;Pregnant code&quot; } display 'Patient currently pregnant (finding)'\n\n// ------------- PARAMETERS ----------------------------------------------------\n// Lookback period for defining &quot;recent&quot; exposure (default: 60 days).\nparameter Exposure_Look_Back_Period default 60 days\n\n// Recommended spacing between vacccine doses\nparameter Spacing_Between_Vaccine_Doses default 2 weeks\n\n// ------------- PATIENT CONTEXT -----------------------------------------------\ncontext Patient\n\n// Version of this CQL\ndefine CqlVersion: '1.1.0'\n\n// ------------- INCLUSIONS &amp; EXCLUSIONS ---------------------------------------\n// Must be 18 years or older.\ndefine Is18orOlder:\n  AgeInYears() &gt;= 18\n\n// ------------- ANTHRAX EXPOSURE ----------------------------------------------\n/* Exposure to Anthrax can be represented as either a Condition or an Observation\nresource. We need to look for recent (&lt;= Exposure_Look_Back_Period) indications\nof exposure in order to decide if the patient needs to be treated with PEP. See\nAssumption 1. */\n\n// Confirmed, recent (&lt;= Exposure_Look_Back_Period), and active or recurring Conditions.\ndefine RecentAnthraxExposureConditions:\n  C3F.Confirmed(C3F.ConditionLookBack(C3F.ActiveOrRecurring([Condition: &quot;Anthrax exposure&quot;]), Exposure_Look_Back_Period))\n\n// The most recent exposure Condition from within the exposure lookback period.\ndefine MostRecentAnthraxExposureCondition:\n  (CCL.MostRecentCondition(RecentAnthraxExposureConditions)) C\n  return {\n    Type: 'Condition',\n    Id: C.id.value,\n    Date: CCL.FindConditionDate(C)\n  }\n\n// Verified and recent (&lt;= Exposure_Look_Back_Period) Observations.\ndefine RecentAnthraxExposureObservations:\n  C3F.Verified(C3F.ObservationLookBack([Observation: &quot;Anthrax exposure&quot;], Exposure_Look_Back_Period))\n\n// The most recent exposure Observation.\ndefine MostRecentAnthraxExposureObservation:\n  (C3F.MostRecent(RecentAnthraxExposureObservations)) O\n  return {\n    Type: 'Observation',\n    Id: O.id.value,\n    Date: C3F.FindDate(O)\n  }\n\n// Form the union of all the resources that could be used to indicate exposure.\ndefine RecentAnthraxExposureResources:\n  ( MostRecentAnthraxExposureCondition union MostRecentAnthraxExposureObservation ) L\n  where L.Date is not null\n  sort by Date desc\n\n// Determine if there is a recent (&lt;= Exposure_Look_Back_Period) exposure to Anthrax.\ndefine RecentlyExposedToAnthrax:\n  exists(RecentAnthraxExposureResources)\n\n// The most recent (&lt;= Exposure_Look_Back_Period) exposure resource.\ndefine MostRecentAnthraxExposureResource:\n  Coalesce(RecentAnthraxExposureResources)\n\n// Date of most recent (&lt;= Exposure_Look_Back_Period) exposure.\ndefine MostRecentAnthraxExposureDate:\n  MostRecentAnthraxExposureResource.Date\n\n// ------------- ASYMPTOMATIC --------------------------------------------------\n/* Asymptomatic must be represented as an Observation resource. In order for a patient\nto be determined to be asymptomatic, the asymptomatic Observation must occur on\nor after the date of exposure. See Assumption 2. */\n\n// Check for recent and verified Observations that patient is asymptomatic.\ndefine RecentAsymptomaticObservations:\n  C3F.Verified(C3F.ObservationLookBack([Observation: &quot;AsymptomaticConcept&quot;], Exposure_Look_Back_Period))\n\n// Most recent (&lt;= Exposure_Look_Back_Period) asymptomatic Observation.\ndefine MostRecentAsymptomaticObservation:\n  C3F.MostRecent(RecentAsymptomaticObservations)\n\n// Date of the most recent (&lt;= Exposure_Look_Back_Period) asymptomatic Observation.\ndefine MostRecentAsymptomaticObservationDate:\n  C3F.FindDate(MostRecentAsymptomaticObservation)\n\n// Determine if the patient is asymptomatic, checking to ensure asymptomatic observation\n// occurs **after** exposure.\ndefine Asymptomatic:\n  MostRecentAsymptomaticObservationDate is not null and\n  MostRecentAsymptomaticObservationDate same day or after MostRecentAnthraxExposureDate\n\n// ------------- PREGNANCY -----------------------------------------------------\n/* Pregnancy can be represented as an Observation or a Condition. Both types of\nresouces are examined to determine if the patient is pregnant. */\n\n// Confirmed, active or recurring, Conditions from the last 42 weeks indicating pregnancy.\ndefine PregnancyConditions:\n  C3F.Confirmed(C3F.ConditionLookBack(C3F.ActiveOrRecurring([Condition: &quot;Pregnancy&quot;]), 42 weeks))\n\n// Verified Observations on pregnancy status from the last 42 weeks.\ndefine PregnancyObservations:\n  C3F.Verified(C3F.ObservationLookBack([Observation: &quot;Pregnancy status&quot;], 42 weeks))\n\n// The most recent pregnancy Observation from the last 42 weeks.\ndefine MostRecentPregnancyObservation:\n  C3F.MostRecent(PregnancyObservations)\n\n// Boolean indicating whether the most recent pregnancy Observation in the past\n// 42 weeks indicates a pregnancy.\ndefine MostRecentPregnancyObservationIsPositive:\n  C3F.ConceptValue(MostRecentPregnancyObservation) ~ &quot;Pregnant&quot;\n\n// Pregnancy status is defined by either a confirmed, active or recurring, and recent\n// (&lt; 42 weeks) pregnancy Condition, or a verified pregnancy Observation within the\n// the past 42 weeks indicating a pregnancy\ndefine IsPregnant:\n  exists(PregnancyConditions)\n  or MostRecentPregnancyObservationIsPositive\n\n// ------------- EXISTING PEP TREATMENTS ---------------------------------------\n\n// Check patient record for current Rx of any of the recommended antimicrobials.\n// Need to exmaine both MedicationRequest and MedicationStatement resources.\n\n// Active MedicationRequests for any of the recommended antimicrobials.\ndefine ActiveCiprofloxacinRequests:\n  C3F.ActiveMedicationRequest([MedicationRequest: &quot;Ciprofloxacin medications&quot;])\n\ndefine ActiveDoxycyclineRequests:\n  C3F.ActiveMedicationRequest([MedicationRequest: &quot;Doxycycline medications&quot;])\n\ndefine ActiveLevofloxacinRequests:\n  C3F.ActiveMedicationRequest([MedicationRequest: &quot;Levofloxacin medications&quot;])\n\ndefine ActiveMoxifloxacinRequests:\n  C3F.ActiveMedicationRequest([MedicationRequest: &quot;Moxifloxacin medications&quot;])\n\ndefine ActiveClindamycinRequests:\n  C3F.ActiveMedicationRequest([MedicationRequest: &quot;Clindamycin medications&quot;])\n\ndefine ActiveAntimicrobialMedicationRequests:\n  ActiveCiprofloxacinRequests\n  union ActiveDoxycyclineRequests\n  union ActiveLevofloxacinRequests\n  union ActiveMoxifloxacinRequests\n  union ActiveClindamycinRequests\n\n// Active MedicationStatements for any of the recommended antimicrobials.\ndefine ActiveCiprofloxacinStatements:\n  C3F.ActiveMedicationStatement([MedicationStatement: &quot;Ciprofloxacin medications&quot;])\n\ndefine ActiveDoxycyclineStatements:\n  C3F.ActiveMedicationStatement([MedicationStatement: &quot;Doxycycline medications&quot;])\n\ndefine ActiveLevofloxacinStatements:\n  C3F.ActiveMedicationStatement([MedicationStatement: &quot;Levofloxacin medications&quot;])\n\ndefine ActiveMoxifloxacinStatements:\n  C3F.ActiveMedicationStatement([MedicationStatement: &quot;Moxifloxacin medications&quot;])\n\ndefine ActiveClindamycinStatements:\n  C3F.ActiveMedicationStatement([MedicationStatement: &quot;Clindamycin medications&quot;])\n\ndefine ActiveAntimicrobialMedicationStatements:\n  ActiveCiprofloxacinStatements\n  union ActiveDoxycyclineStatements\n  union ActiveLevofloxacinStatements\n  union ActiveMoxifloxacinStatements\n  union ActiveClindamycinStatements\n\n// Need to keep track of the specifics of which of the antimicrobials have active Rx.\ndefine HasCiprofloxacinRx:\n  exists(ActiveCiprofloxacinRequests) or exists(ActiveCiprofloxacinStatements)\n\ndefine HasDoxycyclineRx:\n  exists(ActiveDoxycyclineRequests) or exists(ActiveDoxycyclineStatements)\n\ndefine HasLevofloxacinRx:\n  exists(ActiveLevofloxacinRequests) or exists(ActiveLevofloxacinStatements)\n\ndefine HasMoxifloxacinRx:\n  exists(ActiveMoxifloxacinRequests) or exists(ActiveMoxifloxacinStatements)\n\ndefine HasClindamycinRx:\n  exists(ActiveClindamycinRequests) or exists(ActiveClindamycinStatements)\n\n// Format and sort the antimicrobial MedicationRequest list.\ndefine FormattedAntimicrobialMedicationRequests:\n  (ActiveAntimicrobialMedicationRequests) O\n  return {\n    Type:  'MedicationRequest',\n    Id: O.id.value,\n    Date: CCL.DateTimeText(O.authoredOn)\n  }\n  sort by Date desc\n\n// Format and sort the antimicrobial MedicationStatement list.\ndefine FormattedAntimicrobialMedicationStatements:\n  (ActiveAntimicrobialMedicationStatements) S\n  return {\n    Type:  'MedicationStatement',\n    Id: S.id.value,\n    Date: CCL.MedicationStatementDate(S)\n  }\n  sort by Date desc\n\n// Combine the formatted MedicationRequest and MedicationStatement lists.\ndefine FormattedAntimicrobialMedicationResources:\n  (FormattedAntimicrobialMedicationRequests\n    union FormattedAntimicrobialMedicationStatements) M\n  sort by Date desc\n\n// Boolean indicating whether patient has an exisiting antimicrobial Rx.\ndefine HasExistingAntimicrobialRx:\n  exists(FormattedAntimicrobialMedicationResources)\n\n// Check patient record for any recent doses of the vaccine.\n// Each dose in the vaccine sequence has its own SNOMED-CT procedure code.\n\n// Look for completed Produres for administering the first dose.\ndefine ProceduresForFirstVaccineDose:\n  C3F.Completed([Procedure: &quot;First anthrax vaccination code&quot;])\n\n// Look for completed Produres for administering the second dose.\ndefine ProceduresForSecondVaccineDose:\n  C3F.Completed([Procedure: &quot;Second anthrax vaccination code&quot;])\n\n// Look for completed Produres for administering the third dose.\ndefine ProceduresForThirdVaccineDose:\n  C3F.Completed([Procedure: &quot;Third anthrax vaccination code&quot;])\n\n// Look for completed Produres for administering the fourth dose.\ndefine ProceduresForFourthVaccineDose:\n  C3F.Completed([Procedure: &quot;Fourth anthrax vaccination code&quot;])\n\n// ------------- VACCINE LOGIC -------------------------------------------------\n/* How many doses has the patient had? Cases of interest to the logic are:\n- 0 doses\n- 1-2 doses\n- &gt;=3 doses\n*/\n\n// Has the patient had the first dose administered?\ndefine HasFirstVaccineDose:\n  exists(ProceduresForFirstVaccineDose)\n\n// Has the patient had the second dose administered?\ndefine HasSecondVaccineDose:\n  exists(ProceduresForSecondVaccineDose)\n\n// Has the patient had the third dose administered?\ndefine HasThirdVaccineDose:\n  exists(ProceduresForThirdVaccineDose)\n\n// Has the patient had the fourth dose administered?\ndefine HasFourthVaccineDose:\n  exists(ProceduresForFourthVaccineDose)\n\n/* What is the next dose in the vaccine sequence that the patient should receive?\nNote that this logic is very strict, and will miss things like non-sequential dosing.\nThis and another data inconsistency is detected below and alerted on later on.\n*/\ndefine NextVaccineDoseNumber:\n  case\n    when not HasFirstVaccineDose and not HasSecondVaccineDose and not HasThirdVaccineDose and not HasFourthVaccineDose\n      then 1 // The next dose will be the first.\n    when HasFirstVaccineDose and not HasSecondVaccineDose and not HasThirdVaccineDose and not HasFourthVaccineDose\n      then 2 // The next dose will be the second.\n    when HasFirstVaccineDose and HasSecondVaccineDose and not HasThirdVaccineDose and not HasFourthVaccineDose\n      then 3 // The next does will be third (last).\n    else null // There is no fourth dose for PEP.\n  end\n\n// The most recent vaccine Procedure.\ndefine MostRecentVaccineProcedure:\n  case\n    when HasFourthVaccineDose // They have their fourth dose.\n      then CCL.MostRecentProcedure(ProceduresForFourthVaccineDose)\n    when HasThirdVaccineDose // They have their third dose.\n      then CCL.MostRecentProcedure(ProceduresForThirdVaccineDose)\n    when HasSecondVaccineDose // They have their second dose.\n      then CCL.MostRecentProcedure(ProceduresForSecondVaccineDose)\n    when HasFirstVaccineDose // They have first dose.\n      then CCL.MostRecentProcedure(ProceduresForFirstVaccineDose)\n    else null // Patient has not had a previous dose.\n  end\n\n// When was the last vaccine Procedure?\ndefine DateOfLastVaccineDose:\n  CCL.FindProcedureDate(MostRecentVaccineProcedure)\n\n/* Has enough time elasped since the last vaccine dose that the next one can be\napplied? */\ndefine ReadyForNextVaccineDose:\n  if (DateOfLastVaccineDose is not null) then\n    if (NextVaccineDoseNumber is not null) then\n      if (Spacing_Between_Vaccine_Doses is not null) then\n        if (NextVaccineDoseNumber in {2,3}\n          and (DateOfLastVaccineDose same day or before (Today() - Spacing_Between_Vaccine_Doses))) then true\n        else false\n      else false\n    else false\n  else\n    if (NextVaccineDoseNumber is not null) then\n      if (NextVaccineDoseNumber = 1) then true // Need their first dose.\n      else false\n    else false\n\n/* Logic to detect whether or not the last vaccine Procedure is missing a date.\nIf this is the case, then the above logic will fail. So an alert is generated\nlater on to notify the provider of this potential issue.\n*/\ndefine LastVaccineProcedureMissingDate:\n  if (NextVaccineDoseNumber is not null and DateOfLastVaccineDose is null) then\n    if (NextVaccineDoseNumber = 1) then false\n    else true\n  else false\n\n/* Logic to detect missing Vaccine doses. An example would be if the patient record\nshows the patient receiving the second vaccine dose but not the first. If this is\nthe case, then the above logic will fail. So an alert is generated later on to notify\nthe provider of this potential issue.\n*/\ndefine MissingVaccineDose:\n  if (NextVaccineDoseNumber is null) then\n    if (HasFirstVaccineDose and HasSecondVaccineDose and HasThirdVaccineDose) then false\n    else true\n  else false\n\n// ------------- ALLERGIES -----------------------------------------------------\n/* Check patient record for allergies to any of the recommended PEP treatments, plus\n// latex. Patient allergies are discovered by querying AllergyIntolerance resources. */\n\n// Active or confirmed AllergyIntolerance for Ciprofloxacin.\ndefine CiprofloxacinAllergyIntolerances:\n  C3F.ConfirmedAllergyIntolerance([AllergyIntolerance: &quot;Ciprofloxacin substance code&quot;])\n\n// Active or confirmed AllergyIntolerance for Doxycycline.\ndefine DoxycyclineAllergyIntolerances:\n  C3F.ConfirmedAllergyIntolerance([AllergyIntolerance: &quot;Doxycycline substance code&quot;])\n\n// Active or confirmed AllergyIntolerance for Levofloxacin.\ndefine LevofloxacinAllergyIntolerances:\n  C3F.ConfirmedAllergyIntolerance([AllergyIntolerance: &quot;Levofloxacin substance code&quot;])\n\n// Active or confirmed AllergyIntolerance for Moxifloxacin.\ndefine MoxifloxacinAllergyIntolerances:\n  C3F.ConfirmedAllergyIntolerance([AllergyIntolerance: &quot;Moxifloxacin substance code&quot;])\n\n// Active or confirmed AllergyIntolerance for Clindamycin.\ndefine ClindamycinAllergyIntolerances:\n  C3F.ConfirmedAllergyIntolerance([AllergyIntolerance: &quot;Clindamycin substance code&quot;])\n\n// Active or confirmed AllergyIntolerance for BioThrax.\ndefine VaccineAllergyIntolerances:\n  C3F.ConfirmedAllergyIntolerance([AllergyIntolerance: &quot;Anthrax vaccine&quot;])\n\n// Active or confirmed AllergyIntolerance for Latex.\ndefine LatexAllergyIntolerances:\n  C3F.ConfirmedAllergyIntolerance([AllergyIntolerance: &quot;Latex substance code&quot;]\n    union [AllergyIntolerance: &quot;Latex&quot;])\n\n// Create a formatted list of all the antimicrobial AllergyIntolerance resources.\ndefine AntimicrobialAllergyList:\n  (CiprofloxacinAllergyIntolerances\n    union DoxycyclineAllergyIntolerances\n    union LevofloxacinAllergyIntolerances\n    union MoxifloxacinAllergyIntolerances\n    union ClindamycinAllergyIntolerances) A\n  return {\n    Type: 'AllergyIntolerance',\n    Id: A.id.value,\n    DateRecorded: CCL.DateTimeText(A.recordedDate)\n  }\n  sort by DateRecorded desc\n\n// Create a formatted list of all the vaccine AllergyIntolerance resources.\ndefine VaccineAllergyList:\n  (VaccineAllergyIntolerances) A\n  return {\n    Type: 'AllergyIntolerance',\n    Id: A.id.value,\n    DateRecorded: CCL.DateTimeText(A.recordedDate)\n  }\n  sort by DateRecorded desc\n\n// Create a formatted list of all the latex AllergyIntolerance resources.\ndefine LatexAllergyList:\n  (LatexAllergyIntolerances) A\n  return {\n    Type: 'AllergyIntolerance',\n    Id: A.id.value,\n    DateRecorded: CCL.DateTimeText(A.recordedDate)\n  }\n  sort by DateRecorded desc\n\n// Any allergies to any of the antimicrobials?\ndefine HasAntimicrobialAllergy:\n  exists(AntimicrobialAllergyList)\n\n// Any allergies to the vaccine?\ndefine HasVaccineAllergy:\n  exists(VaccineAllergyList)\n\n// Any allergies to latex?\ndefine HasLatexAllergy:\n  exists(LatexAllergyList)\n\n// ------------- ALERTS --------------------------------------------------------\n/* There are currently five alerts that can potentially be generated by this CDS:\n1. Exposed but not asymptomatic.\n2. Existing antimicrobial Rx.\n3. Potential antimicrobial allergy.\n4. Potential vaccine allergy.\n5. Potential latex allergy.\n6. Inconsistencies in patient BioThrax dosing history.\n\nThese alerts are represented using either a DetectedIssue or Flag FHIR R4 resource.\nThey each make reference to FHIR resources that have been discovered by querying the\npatient record (e.g., an AllergyIntolerance resource indicating a patient allergy to\nthe vaccine).\n*/\n\n// Define a Device resource for referring to this CQL within the alert resources.\ndefine Device: {\n  resourceType: 'Device',\n  id: '1',\n  type: {\n    coding: { CCL.FormatCode(&quot;Device code&quot;) }\n  },\n  identifier: {\n    {\n      value: 'Anthrax_Post_Exposure_Prophylaxis_FHIRv400.cql'\n    }\n  },\n  manufacturer: 'Centers for Disease Control and Prevention',\n  version: { {\n    value: CqlVersion\n  } }\n}\n\n/* Alert 1: Patient is exposed to anthrax but does not have an asymptomatic Observation.\nIf this is the case, a Flag resource will be generated below to highlight this issue\nsince post exposure prophylaxis is only recommended for asymptomatic patients. A\nflag-detail extension reference to the resource indicating exposure and a code for\ndocumenting signs and symptoms are also included. If patient is both exposed and asymptomatic,\nthen this Flag resource will be empty (null). */\ndefine FlagNoAsymptomaticObservation:\n  if (RecentlyExposedToAnthrax and Is18orOlder and not Asymptomatic) then {\n    resourceType: 'Flag',\n    id: '2',\n    text: {\n      status: 'generated',\n      &quot;div&quot;: '&lt;div xmlns=\\&quot;http://www.w3.org/1999/xhtml\\&quot;&gt;If patient has signs or symptoms consistent with anthrax, conduct a full diagnostic evaluation for anthrax. Signs and symptoms of anthrax include fever, chills, headache, malaise, nausea, vomiting, diarrhea, abdominal pain, diaphoresis, anorexia, nonproductive cough, difficulty breathing, dyspnea, stridor, hypoxemia, hypotension, shock, cyanosis, chest pain, lymphadenopathy, cutaneous ulcer and black eschar. If patient has NO signs or symptoms consistent with anthrax, document “asymptomatic SNOMEDCT 84387000.&lt;/div&gt;'\n    },\n    subject: {\n      reference: 'Patient/' + Patient.id.value\n    },\n    author: {\n      reference: CCL.GenerateLocalReference('Device', Device.id)\n    },\n    status: 'active',\n    code: {\n      coding: { CCL.FormatCode(&quot;Document signs and symptoms code&quot;) }\n    },\n    extension: {\n      { // flag-detail extension that references the exposure resource.\n        url: 'http://hl7.org/fhir/StructureDefinition/flag-detail',\n        valueReference: {\n          reference: CCL.GenerateLocalReference(\n          MostRecentAnthraxExposureResource.Type,\n          MostRecentAnthraxExposureResource.Id)\n        }\n      }\n    }\n  }\n  else null\n\n// List of references needed for Alert 2 (DetectedIssueExistingAntimicrobialRx).\ndefine ImplicatedExistingMedicationResources:\n  (FormattedAntimicrobialMedicationResources) L\n  return {\n    reference: CCL.GenerateLocalReference(L.Type, L.Id)\n  }\n\n// Strings needed to build message for Alert 2 (DetectedIssueExistingAntimicrobialRx).\ndefine CiprofloxacinRxText:\n  if (HasCiprofloxacinRx) then {\n    name: 'Ciprofloxacin',\n    rx: 'Ciprofloxacin 500 mg by mouth every 12 hours for 60 days' } else null\n\ndefine DoxycyclineRxText:\n  if (HasDoxycyclineRx) then {\n    name: 'Doxycycline',\n    rx: 'Doxycycline 100 mg by mouth every 12 hours for 60 days' } else null\n\ndefine LevofloxacinRxText:\n  if (HasLevofloxacinRx) then {\n    name: 'Levofloxacin',\n    rx: 'Levofloxacin 750 mg by mouth once daily for 60 days' } else null\n\ndefine MoxifloxacinRxText:\n  if (HasMoxifloxacinRx) then {\n    name: 'Moxifloxacin',\n    rx: 'Moxifloxacin 400 mg by mouth once daily for 60 days' } else null\n\ndefine ClindamycinRxText:\n  if (HasClindamycinRx) then {\n    name: 'Clindamycin',\n    rx: 'Clindamycin 600 mg by mouth every 8 hours for 60 days]' } else null\n\n// Text string to be displayed in Alert 2 (DetectedIssueExistingAntimicrobialRx).\ndefine ExistingAntimicrobialText:\n  Combine({\n    'The patient has an active prescription for [',\n    Combine(\n      CCL.CullNullStrings({\n        CiprofloxacinRxText.name,\n        DoxycyclineRxText.name,\n        LevofloxacinRxText.name,\n        MoxifloxacinRxText.name,\n        ClindamycinRxText.name}), ' , '),\n    ']. Evaluate the dosage and duration to ensure a 60-day regimen of appropriate antibiotic post-anthrax exposure: [',\n    Combine(\n      CCL.CullNullStrings({\n        CiprofloxacinRxText.rx,\n        DoxycyclineRxText.rx,\n        LevofloxacinRxText.rx,\n        MoxifloxacinRxText.rx,\n        ClindamycinRxText.rx}), ' , '),\n    '].'})\n\n/* Alert 2: Patient has at least one existing prescription to one of the recommended\nantimicrobials. If the patient is exposed, asymptomatic, and has an active Rx for\na pertinent antimicrobial, a DetectedIssue resource will be generated which will\nreference the most recent Medication resource for one of the antimicrobials. The\nsuggested mitigation will be to review the patient's medication to ensure it appropriately\nmeets CDC recommended dosage and duration. If the patient does not have an existing\nRx, then this DetectedIssue resource will be empty (null). */\ndefine DetectedIssueExistingAntimicrobialRx:\n  if (RecentlyExposedToAnthrax and Is18orOlder and Asymptomatic and HasExistingAntimicrobialRx) then {\n    resourceType: 'DetectedIssue',\n    id: '3',\n    detail: ExistingAntimicrobialText,\n    author: {\n      reference: CCL.GenerateLocalReference('Device', Device.id)\n    },\n    code: {\n      coding: { CCL.FormatCode(&quot;Not equivalent alert code&quot;) }\n    },\n    implicated: ImplicatedExistingMedicationResources,\n    mitigation: { {\n      action: {\n        coding: { CCL.FormatCode(&quot;Medication review code&quot;) }\n      }\n    } },\n    status: 'preliminary'\n  }\n  else null\n\n// List of references needed for Alert 3 (FlagAntimicrobialMedicationAllergies).\ndefine AntimicrobialAllergyExtensionReferences:\n  (AntimicrobialAllergyList) L\n  return {\n    url: 'http://hl7.org/fhir/StructureDefinition/flag-detail',\n    valueReference: {\n      reference: CCL.GenerateLocalReference(L.Type, L.Id)\n    }\n  }\n\n// Strings needed to build message for Alert 3 (FlagAntimicrobialMedicationAllergies).\ndefine CiprofloxacinAllergyText:\n  if (exists(CiprofloxacinAllergyIntolerances)) then 'Ciprofloxacin' else null\n\ndefine DoxycyclineAllergyText:\n  if (exists(DoxycyclineAllergyIntolerances)) then 'Doxycycline' else null\n\ndefine LevofloxacinAllergyText:\n  if (exists(LevofloxacinAllergyIntolerances)) then 'Levofloxacin' else null\n\ndefine MoxifloxacinAllergyText:\n  if (exists(MoxifloxacinAllergyIntolerances)) then 'Moxifloxacin' else null\n\ndefine ClindamycinAllergyText:\n  if (exists(ClindamycinAllergyIntolerances)) then 'Clindamycin' else null\n\n// Text string to be displayed in Alert 3 (FlagAntimicrobialMedicationAllergies).\ndefine AllergyAlertText:\n  Combine({\n    '&lt;div xmlns=\\&quot;http://www.w3.org/1999/xhtml\\&quot;&gt;Potential patient allergy to [',\n    Combine(\n      CCL.CullNullStrings({\n        CiprofloxacinAllergyText,\n        DoxycyclineAllergyText,\n        LevofloxacinAllergyText,\n        MoxifloxacinAllergyText,\n        ClindamycinAllergyText}), ' , '),\n    ']. Confirm allergy status.&lt;/div&gt;'})\n\n/* Alert 3: Patient potentially has an allergy to one of the antimicrobials. If the\npatient is exposed, asymptomatic, and has an AllergyIntolerance resource for one\nof the recommended antimicrobials, a Flag resource will be generated to alert on\nthis. The list of potential allergies are included in the flag-detail extension\nfield. If the patient has no allergies, then this Flag resource will be empty (null). */\ndefine FlagAntimicrobialMedicationAllergies:\n  if (RecentlyExposedToAnthrax and Is18orOlder and Asymptomatic and HasAntimicrobialAllergy) then {\n    resourceType: 'Flag',\n    id: '4',\n    text: {\n      status: 'generated',\n      &quot;div&quot;: AllergyAlertText\n    },\n    subject: {\n      reference: 'Patient/' + Patient.id.value\n    },\n    author: {\n      reference: CCL.GenerateLocalReference('Device', Device.id)\n    },\n    status: 'active',\n    code: {\n      coding: { CCL.FormatCode(&quot;Verify allergy status code&quot;) }\n    },\n    extension:  AntimicrobialAllergyExtensionReferences\n  }\n  else null\n\n// List of references needed for Alert 4 (FlagBioThraxAllergy).\ndefine VaccineAllergyExtensionReferences:\n  (VaccineAllergyList) L\n  return {\n    url: 'http://hl7.org/fhir/StructureDefinition/flag-detail',\n    valueReference: {\n      reference: CCL.GenerateLocalReference(L.Type, L.Id)\n    }\n  }\n\n/* Alert 4: Patient potentially has an allergy to the anthrax vaccine. If the\npatient is exposed, asymptomatic, and has an AllergyIntolerance resource for the\nanthrax vaccine, a Flag resource will be generated to alert on this. The list of\npotential AllergyIntolerance resources are included in the flag-detail extension\nfield of the Flag. If the patient has no allergies to the vaccine, then this Flag\nresource will be empty (null). */\ndefine FlagBioThraxAllergy:\n  if (RecentlyExposedToAnthrax and Is18orOlder and Asymptomatic and HasVaccineAllergy) then {\n    resourceType: 'Flag',\n    id: '5',\n    text: {\n      status: 'generated',\n      &quot;div&quot;: '&lt;div xmlns=\\&quot;http://www.w3.org/1999/xhtml\\&quot;&gt;Potential patient allergy to BioThrax. Confirm allergy status.&lt;/div&gt;'\n    },\n    subject: {\n      reference: 'Patient/' + Patient.id.value\n    },\n    author: {\n      reference: CCL.GenerateLocalReference('Device', Device.id)\n    },\n    status: 'active',\n    code: {\n      coding: { CCL.FormatCode(&quot;Verify allergy status code&quot;) }\n    },\n    extension: VaccineAllergyExtensionReferences\n  }\n  else null\n\n// List of references needed for Alert 5 (FlagLatexAllergy).\ndefine LatexAllergyExtensionReferences:\n  (LatexAllergyList) L\n  return {\n    url: 'http://hl7.org/fhir/StructureDefinition/flag-detail',\n    valueReference: {\n      reference: CCL.GenerateLocalReference(L.Type, L.Id)\n    }\n  }\n\n/* Alert 5: Patient potentially has an allergy to latex. If the patient is exposed,\nasymptomatic, and has resources indicating an allergy to latex, a Flag resource\nwill be generated to alert on this. The list of potential resources indicating a\nlatex allergy are included in the flag-detail extension field of the Flag. If the\npatient has no allergies to latex, then this Flag resource will be empty (null). */\ndefine FlagLatexAllergy:\n  if (RecentlyExposedToAnthrax and Is18orOlder and Asymptomatic and HasLatexAllergy) then {\n    resourceType: 'Flag',\n    id: '6',\n    text: {\n      status: 'generated',\n      &quot;div&quot;: '&lt;div xmlns=\\&quot;http://www.w3.org/1999/xhtml\\&quot;&gt;Potential patient allergy to latex. The stopper of BioThrax (anthrax vaccine) vial contains latex. Confirm allergy status.&lt;/div&gt;'\n    },\n    subject: {\n      reference: 'Patient/' + Patient.id.value\n    },\n    author: {\n      reference: CCL.GenerateLocalReference('Device', Device.id)\n    },\n    status: 'active',\n    code: {\n      coding: { CCL.FormatCode(&quot;Verify allergy status code&quot;) }\n    },\n    extension: LatexAllergyExtensionReferences\n  }\n  else null\n\n// List of references needed for Alert 6 (DetectedIssueBioThraxHistoryInconsistencies).\ndefine ImplicatedVaccineProcedure:\n  {\n    reference: CCL.GenerateLocalReference('Procedure', MostRecentVaccineProcedure.id.value)\n  }\n\n/* Alert 6: Patient BioThrax dosing history has data consistency issues. Either\nthere is an indication that the recommended dosing sequence was not followed (i.e.,\nthere is a missing dose), or the last vaccine Procedure is missing a date. Under\nthese conditions this CDS cannot reliably provide the correct PEP treatment\nrecommendations. If there is a missing dose in the vaccine sequence, or if the\nlast vaccine Procedure is missing a date, then a DetectedIssue resource will be\ngenerated which will reference the most recent vaccine Procedure resource. The\nsuggested mitigation will be to review the patient's medication to ensure it appropriately\nmeets CDC guidelines. If no inconsistencies are found, then this DetectedIssue resource\nwill be empty (null). */\ndefine DetectedIssueBioThraxHistoryInconsistencies:\n  if ( RecentlyExposedToAnthrax and Is18orOlder and Asymptomatic and\n    (LastVaccineProcedureMissingDate or MissingVaccineDose) ) then {\n    resourceType: 'DetectedIssue',\n    id: '7',\n    detail: 'Potential BioThrax vaccine series problem(s) identified. A vaccine in the recommended series might be missing or a vaccination date might be missing. Review BioThrax vaccine series history.',\n    author: {\n      reference: CCL.GenerateLocalReference('Device', Device.id)\n    },\n    code: {\n      coding: { CCL.FormatCode(&quot;Timing detected issue code&quot;) }\n    },\n    implicated: { ImplicatedVaccineProcedure },\n    mitigation: { {\n      action: {\n        coding: { CCL.FormatCode(&quot;Medication review code&quot;) }\n      }\n    } },\n    status: 'preliminary'\n  }\n  else null\n\n// ------------- ORDER SET ----------------------------------------------------\n/* The main output of this CDS is an order set which specifies the recommended\ntreatment for Anthrax PEP. This treatment could include a dose of the Anthrax\nvaccine, a prescription for a recommended antimicrobial, both, or neither.\n*/\n\n/* The appropriate Procedure codes for the next dose of the Anthrax vaccine. If the\npatient is not getting another dose at this time, then this will be empty.\n*/\ndefine VaccineCoding:\n  case\n    when NextVaccineDoseNumber = 1 then {\n      coding: {\n        CCL.FormatCode(&quot;Anthrax vaccination code&quot;),\n        CCL.FormatCode(&quot;First anthrax vaccination code&quot;)\n      }\n    }\n    when NextVaccineDoseNumber = 2 then {\n      coding: {\n        CCL.FormatCode(&quot;Anthrax vaccination code&quot;),\n        CCL.FormatCode(&quot;Second anthrax vaccination code&quot;)\n      }\n    }\n    when NextVaccineDoseNumber = 3 then {\n      coding: {\n        CCL.FormatCode(&quot;Anthrax vaccination code&quot;),\n        CCL.FormatCode(&quot;Third anthrax vaccination code&quot;)\n      }\n    }\n    else null\n    end\n\n// Additional instructions for the VaccineRequest.\ndefine VaccineAdditionalInstructions:\n  if (IsPregnant) then {\n    {\n      text: 'Pregnant women at risk for inhalation anthrax should receive the anthrax vaccine regardless of pregnancy trimester.'\n    },\n    {\n      text: 'Epinephrine solution (1:1000) should be available for immediate use in the event that an anaphylactic reaction occurs.'\n    }\n  }\n  else {\n      text: 'Epinephrine solution (1:1000) should be available for immediate use in the event that an anaphylactic reaction occurs.'\n  }\n\n// Description to be used in all ActivityDefintion resources generated by this library\ndefine ActivityDefinitionDescription:\n  'In 2009, the US Advisory Committee on Immunization Practices recommended in addition to antimicrobial therapy, a 3-dose series of Anthrax Vaccine Adsorbed (AVA) BioThrax (Emergent BioSolutions Inc., Rockville, MD, USA) for long-term protection after exposure to anthrax  in individuals without any previous vaccine. After exposure to aerosolized B. anthracis spores, antimicrobial therapy should be initiated as soon as possible. Ideally, the first dose of vaccine should be administered within 10 days. ACIP recommends a post exposure regimen of 60 days of appropriate antimicrobial prophylaxis (covered previously) combined with 3 subcutaneous doses of AVA (administered at 0, 2, and 4 weeks post exposure) as the most effective protection against inhalation anthrax for previously unvaccinated persons aged ≥18 years who have been exposed to aerosolized B. anthracis spores. In general, the peak serologic response to anthrax vaccine occurs 10–14 days after the third dose. (Wright, J.G et al., Morbidity and Mortality Weekly Report, July 23, 2010 / 59(RR06); 1-30). Additionally, the Advisory Committee on Immunization Practices subsequently reviewed all safety data available as of March 2008, including the final results of a retrospective study, and concluded that AVA is safe to administer to anthrax-exposed women during pregnancy. In the setting of an anthrax event that poses a high risk for exposure to aerosolized B. anthracis spores, pregnancy is neither a precaution nor a contraindication to vaccination. Pregnant women at risk for inhalation anthrax should receive AVA and antimicrobial drug therapy regardless of pregnancy trimester (Meanye-Delman D et al., Emerg Infect Dis, 20(2), 2014).'\n\n// Purpose to be used in all ActivityDefintion resources generated by this library\ndefine ActivityDefinitionPurpose:\n  'Provides clinicians with information for quickly assessing individuals exposed to anthrax unrelated to occupational exposure, for example in bioterrorism events, and provides the recommended post-exposure prophylaxis (PEP) regimen for asymptomatic patients. Includes immediate treatment with antimicrobials and vaccine and follow-up administration of subsequent vaccines to complete the recommended 3-dose vaccination series.'\n\n// Usage to be used in all ActivityDefintion resources generated by this library\ndefine ActivityDefinitionUsage:\n  'Intended for use by clinicians caring for individuals ≥18 years of age in an outpatient setting.'\n\n// UsageContext to be used in all ActivityDefinition and PlanDefinition resources generated by this library\ndefine TreatmentUseContext:\n  {\n    {\n      code: CCL.FormatCode(&quot;FHIR age range usage context code&quot;),\n      valueRange: {\n        low: {\n          value: 18\n        }\n      }\n    },\n    {\n      code: CCL.FormatCode(&quot;FHIR clinical venue usage context code&quot;),\n      valueCodeableConcept: {\n        coding: { CCL.FormatCode(&quot;SNOMED outpatient code&quot;) }\n      }\n    },\n    {\n      code: CCL.FormatCode(&quot;FHIR clinical focus usage context code&quot;),\n      valueCodeableConcept: {\n        coding: { CCL.FormatCode(&quot;Exposure to Anthrax code&quot;) }\n      }\n    },\n    {\n      code: CCL.FormatCode(&quot;FHIR clinical focus usage context code&quot;),\n      valueCodeableConcept: {\n        coding: { CCL.FormatCode(&quot;Exposure to Bacillus anthracis (event) code&quot;) }\n      }\n    },\n    {\n      code: CCL.FormatCode(&quot;FHIR clinical focus usage context code&quot;),\n      valueCodeableConcept: {\n        coding: { CCL.FormatCode(&quot;Asymptomatic code&quot;) }\n      }\n    }\n  }\n\n// Topics for this library (used in all generated ActivityDefinition and PlanDefinition resources)\ndefine Topics:\n  {\n    {\n      text: 'Anthrax'\n    },\n    {\n      text: 'Emergency Medicine'\n    },\n    {\n      text: 'Post-Exposure Prophylaxis'\n    }\n  }\n\n// Contributors for this library (used in all generated ActivityDefinition and PlanDefinition resources)\ndefine Author:\n  {\n   name: 'Alliance to Modernize Healthcare FFRDC'\n  }\n\ndefine Endorser:\n  {\n    name: 'Centers for Disease Control and Prevention'\n  }\n// Contact information for this library (used in all generated ActivityDefinition and PlanDefinition resources)\ndefine ContactInfo:\n  {\n    {\n      telecom: {\n        {\n          system: 'url',\n          value: 'https://cds.ahrq.gov/cdsconnect/artifact/anthrax-post-exposure-prophylaxis',\n          use: 'work'\n        }\n      }\n    }\n  }\n\n// Copyright statement for this library (used in all generated ActivityDefinition and PlanDefinition resources)\ndefine CopyrightStatement:\n  '(C) 2018 The MITRE Corporation. All Rights Reserved.'\n\n// An ActivityDefinition resource representing an ImmunizationRecommendation.\ndefine VaccineRequest:\n  {\n    resourceType: 'ActivityDefinition',\n    id: 'VaccineRequest',\n    url: 'https://cds.ahrq.gov/cdsconnect/artifact/anthrax-post-exposure-prophylaxis',\n    identifier: {\n      {\n        value: 'Anthrax_Post_Exposure_Prophylaxis_FHIRv400_CQL_v110/VaccineRequest'\n      }\n    },\n    version: CqlVersion,\n    name: 'Anthrax_Post_Exposure_Prophylaxis_Adults_Vaccine_Request',\n    title: 'Anthrax Post Exposure Prophylaxis (PEP) for Adults: Vaccine Request',\n    status: 'draft',\n    experimental: true,\n    date: '2019-06-07',\n    publisher: 'Centers for Disease Control and Prevention',\n    description: ActivityDefinitionDescription,\n    purpose: ActivityDefinitionPurpose,\n    usage: ActivityDefinitionUsage,\n    approvalDate: '2019-06-07',\n    lastReviewDate: '2019-06-07',\n    effectivePeriod: {\n      start: '2019-06-07'\n    },\n    useContext: TreatmentUseContext,\n    topic: Topics,\n    author: {Author},\n    endorser: {Endorser},\n    contact: ContactInfo,\n    copyright: CopyrightStatement,\n    kind: 'ImmunizationRecommendation',\n    code: VaccineCoding,\n    productCodeableConcept: {\n      coding: { CCL.FormatCode(&quot;Anthrax vaccine CVX code&quot;) }\n    },\n    dosage: {\n      {\n        text: '0.5mL',\n        additionalInstruction: VaccineAdditionalInstructions,\n        doseAndRate: { {\n          doseQuantity: {\n            value: 0.5,\n            unit: 'mL',\n            system: 'http://unitsofmeasure.org',\n            code: 'mL'\n          }\n        } },\n        route: {\n          coding: { CCL.FormatCode(&quot;Subcutaneous route code&quot;) }\n        }\n      }\n    }\n  }\n\n// The title VaccineAction depends on what dose the patient is getting.\ndefine VaccineActionTitle:\n  case\n    when NextVaccineDoseNumber = 1 then 'Anthrax Vaccination - 1st dose'\n    when NextVaccineDoseNumber = 2 then 'Anthrax Vaccination - 2nd dose'\n    when NextVaccineDoseNumber = 3 then 'Anthrax Vaccination - 3rd dose'\n    else ''\n  end\n\n/* The vaccine Action to appear in the order set. References VaccineRequest resource.\nIf the patient doesn't meet the inclusion criteria and isn't ready for the next dose,\nthen this will be empty.\n*/\ndefine VaccineAction:\n  if (RecentlyExposedToAnthrax and Is18orOlder and Asymptomatic and ReadyForNextVaccineDose) then {\n    title: VaccineActionTitle,\n    type: {\n      coding: { CCL.FormatCode(&quot;FHIR ActionType create code&quot;) }\n    },\n    definitionCanonical: '#' + VaccineRequest.id\n  } else null\n\n// If the patient is pregnant, additional text will be added to the CiprofloxacinRequest.\ndefine PregnancyPriorityCiprofloxacin:\n  if (IsPregnant) then 'FIRST CHOICE: '\n  else ''\n\n/* Additional instructions for the antimicrobials, which is only displayed for patients who\nare pregnant.\n*/\ndefine AntimicrobialPregnancyInstructions:\n if (IsPregnant) then\n {\n   text: 'Pregnant women at risk for inhalation anthrax should receive antimicrobial drug therapy regardless of pregnancy trimester.'\n }\n else null\n\n/* Additional instructions for the CiprofloxacinRequest, including a message displayed only\nfor pregnant patients.\n*/\ndefine CiprofloxacinAdditionalInstructions:\n  AntimicrobialPregnancyInstructions union\n  {\n    {\n      text: 'CONTRAINDICATIONS: Diagnosis of myasthenia gravis and taking tizanidine.'\n    },\n    {\n      text: 'CAUTIONS: If patient is taking  blood thinners, oral antidiabetic drugs, seizure drugs, theophylline, drugs that prolong QT interval, duloxetine (Cymbalta), zolpidem (Ambien), clozapine or any other drug that may interact and cause serious side effects, consider another antibiotic regimen.'\n    },\n    {\n      text: 'Provide patient education on medications.'\n    }\n  }\n\n// An ActivityDefinition resource representing a MedicationRequest for Ciprofloxacin.\ndefine CiprofloxacinRequest:\n  {\n    resourceType: 'ActivityDefinition',\n    id: 'CiprofloxacinRequest',\n    url: 'https://cds.ahrq.gov/cdsconnect/artifact/anthrax-post-exposure-prophylaxis',\n    identifier: {\n      {\n        value: 'Anthrax_Post_Exposure_Prophylaxis_FHIRv400_CQL_v110/CiprofloxacinRequest'\n      }\n    },\n    version: CqlVersion,\n    name: 'Anthrax_Post_Exposure_Prophylaxis_Adults_Ciprofloxacin_Request',\n    title: 'Anthrax Post Exposure Prophylaxis (PEP) for Adults: Ciprofloxacin Request',\n    status: 'draft',\n    experimental: true,\n    date: '2019-06-07',\n    publisher: 'Centers for Disease Control and Prevention',\n    description: ActivityDefinitionDescription,\n    purpose: ActivityDefinitionPurpose,\n    usage: ActivityDefinitionUsage,\n    approvalDate: '2019-06-07',\n    lastReviewDate: '2019-06-07',\n    effectivePeriod: {\n      start: '2019-06-07'\n    },\n    useContext: TreatmentUseContext,\n    topic: Topics,\n    author: {Author},\n    endorser: {Endorser},\n    contact: ContactInfo,\n    copyright: CopyrightStatement,\n    kind: 'MedicationRequest',\n    productCodeableConcept: {\n      coding: { CCL.FormatCode(&quot;Ciprofloxacin Rx code&quot;) },\n      text: PregnancyPriorityCiprofloxacin + &quot;Ciprofloxacin Rx code&quot;.display\n    },\n    quantity: {\n      value: 120,\n      system: 'http://hl7.org/fhir/v3/orderableDrugForm',\n      code: 'ORTAB'\n    },\n    dosage: {\n      {\n        text: 'One every 12 hours for 60 days',\n        additionalInstruction: CiprofloxacinAdditionalInstructions,\n        patientInstruction: 'Take with full glass of water',\n        timing: {\n          repeat: {\n            frequency: 1,\n            period: 12,\n            periodUnit: 'h'\n          }\n        },\n        route: {\n          coding: { CCL.FormatCode(&quot;Oral route code&quot;) }\n        },\n        method: {\n          coding: { CCL.FormatCode(&quot;Swallow dosing instruction code&quot;) }\n        }\n      }\n    }\n  }\n\n// If the patient is pregnant, additional text will be added to the DoxycyclineRequest.\ndefine PregnancyPriorityDoxycycline:\n  if (IsPregnant) then 'SECOND CHOICE: '\n  else ''\n\n/* Additional instructions for the DoxycyclineRequest, including a message displayed only\nfor pregnant patients.\n*/\ndefine DoxycyclineAdditionalInstructions:\n  AntimicrobialPregnancyInstructions union\n  {\n    {\n      text: 'CAUTIONS: If patient is taking  blood thinners, oral antidiabetic drugs, seizure drugs, or any other drug that may interact and cause serious side effects, consider another antibiotic regimen.'\n    },\n    {\n      text: 'Provide patient education on medications.'\n    }\n  }\n\n// An ActivityDefinition resource representing a MedicationRequest for Doxycycline.\ndefine DoxycyclineRequest:\n  {\n    resourceType: 'ActivityDefinition',\n    id: 'DoxycyclineRequest',\n    url: 'https://cds.ahrq.gov/cdsconnect/artifact/anthrax-post-exposure-prophylaxis',\n    identifier: {\n      {\n        value: 'Anthrax_Post_Exposure_Prophylaxis_FHIRv400_CQL_v110/DoxycyclineRequest'\n      }\n    },\n    version: CqlVersion,\n    name: 'Anthrax_Post_Exposure_Prophylaxis_Adults_Doxycycline_Request',\n    title: 'Anthrax Post Exposure Prophylaxis (PEP) for Adults: Doxycycline Request',\n    status: 'draft',\n    experimental: true,\n    date: '2019-06-07',\n    publisher: 'Centers for Disease Control and Prevention',\n    description: ActivityDefinitionDescription,\n    purpose: ActivityDefinitionPurpose,\n    usage: ActivityDefinitionUsage,\n    approvalDate: '2019-06-07',\n    lastReviewDate: '2019-06-07',\n    effectivePeriod: {\n      start: '2019-06-07'\n    },\n    useContext: TreatmentUseContext,\n    topic: Topics,\n    author: {Author},\n    endorser: {Endorser},\n    contact: ContactInfo,\n    copyright: CopyrightStatement,\n    kind: 'MedicationRequest',\n    productCodeableConcept: {\n      coding: { CCL.FormatCode(&quot;Doxycycline Rx code&quot;) },\n      text: PregnancyPriorityDoxycycline + &quot;Doxycycline Rx code&quot;.display\n    },\n    quantity: {\n      value: 120,\n      system: 'http://hl7.org/fhir/v3/orderableDrugForm',\n      code: 'ORTAB'\n    },\n    dosage: {\n      {\n        text: 'One every 12 hours for 60 days',\n        additionalInstruction: DoxycyclineAdditionalInstructions,\n        patientInstruction: 'Take with full glass of water',\n        timing: {\n          repeat: {\n            frequency: 1,\n            period: 12,\n            periodUnit: 'h'\n          }\n        },\n        route: {\n          coding: { CCL.FormatCode(&quot;Oral route code&quot;) }\n        },\n        method: {\n          coding: { CCL.FormatCode(&quot;Swallow dosing instruction code&quot;) }\n        }\n      }\n    }\n  }\n\n/* Additional instructions for the LevofloxacinRequest, including a message displayed only\nfor pregnant patients.\n*/\ndefine LevofloxacinAdditionalInstructions:\n  if (IsPregnant) then { AntimicrobialPregnancyInstructions }\n  else { { text: 'none'} }\n\n// An ActivityDefinition resource representing a MedicationRequest for Levofloxacin.\ndefine LevofloxacinRequest:\n  {\n    resourceType: 'ActivityDefinition',\n    id: 'LevofloxacinRequest',\n    url: 'https://cds.ahrq.gov/cdsconnect/artifact/anthrax-post-exposure-prophylaxis',\n    identifier: {\n      {\n        value: 'Anthrax_Post_Exposure_Prophylaxis_FHIRv400_CQL_v110/LevofloxacinRequest'\n      }\n    },\n    version: CqlVersion,\n    name: 'Anthrax_Post_Exposure_Prophylaxis_Adults_Levofloxacin_Request',\n    title: 'Anthrax Post Exposure Prophylaxis (PEP) for Adults: Levofloxacin Request',\n    status: 'draft',\n    experimental: true,\n    date: '2019-06-07',\n    publisher: 'Centers for Disease Control and Prevention',\n    description: ActivityDefinitionDescription,\n    purpose: ActivityDefinitionPurpose,\n    usage: ActivityDefinitionUsage,\n    approvalDate: '2019-06-07',\n    lastReviewDate: '2019-06-07',\n    effectivePeriod: {\n      start: '2019-06-07'\n    },\n    useContext: TreatmentUseContext,\n    topic: Topics,\n    author: {Author},\n    endorser: {Endorser},\n    contact: ContactInfo,\n    copyright: CopyrightStatement,\n    kind: 'MedicationRequest',\n    productCodeableConcept: {\n      coding: { CCL.FormatCode(&quot;Levofloxacin Rx code&quot;) },\n      text: &quot;Levofloxacin Rx code&quot;.display\n    },\n    quantity: {\n      value: 60,\n      system: 'http://hl7.org/fhir/v3/orderableDrugForm',\n      code: 'ORTAB'\n    },\n    dosage: {\n      {\n        text: 'One every day for 60 days',\n        additionalInstruction: LevofloxacinAdditionalInstructions,\n        timing: {\n          repeat: {\n            frequency: 1,\n            period: 1,\n            periodUnit: 'd'\n          }\n        },\n        route: {\n          coding: { CCL.FormatCode(&quot;Oral route code&quot;) }\n        },\n        method: {\n          coding: { CCL.FormatCode(&quot;Swallow dosing instruction code&quot;) }\n        }\n      }\n    }\n  }\n\n/* Additional instructions for the MoxifloxacinRequest, including a message displayed only\nfor pregnant patients.\n*/\ndefine MoxifloxacinAdditionalInstructions:\n  if (IsPregnant) then { AntimicrobialPregnancyInstructions }\n  else { { text: 'none'} }\n\n// An ActivityDefinition resource representing a MedicationRequest for Moxifloxacin.\ndefine MoxifloxacinRequest:\n  {\n    resourceType: 'ActivityDefinition',\n    id: 'MoxifloxacinRequest',\n    url: 'https://cds.ahrq.gov/cdsconnect/artifact/anthrax-post-exposure-prophylaxis',\n    identifier: {\n      {\n        value: 'Anthrax_Post_Exposure_Prophylaxis_FHIRv400_CQL_v110/MoxifloxacinRequest'\n      }\n    },\n    version: CqlVersion,\n    name: 'Anthrax_Post_Exposure_Prophylaxis_Adults_Moxifloxacin_Request',\n    title: 'Anthrax Post Exposure Prophylaxis (PEP) for Adults: Moxifloxacin Request',\n    status: 'draft',\n    experimental: true,\n    date: '2019-06-07',\n    publisher: 'Centers for Disease Control and Prevention',\n    description: ActivityDefinitionDescription,\n    purpose: ActivityDefinitionPurpose,\n    usage: ActivityDefinitionUsage,\n    approvalDate: '2019-06-07',\n    lastReviewDate: '2019-06-07',\n    effectivePeriod: {\n      start: '2019-06-07'\n    },\n    useContext: TreatmentUseContext,\n    topic: Topics,\n    author: {Author},\n    endorser: {Endorser},\n    contact: ContactInfo,\n    copyright: CopyrightStatement,\n    kind: 'MedicationRequest',\n    productCodeableConcept: {\n      coding: { CCL.FormatCode(&quot;Moxifloxacin Rx code&quot;) },\n      text: &quot;Moxifloxacin Rx code&quot;.display\n    },\n    quantity: {\n      value: 60,\n      system: 'http://hl7.org/fhir/v3/orderableDrugForm',\n      code: 'ORTAB'\n    },\n    dosage: {\n      {\n        text: 'One every day for 60 days',\n        additionalInstruction: MoxifloxacinAdditionalInstructions,\n        timing: {\n          repeat: {\n            frequency: 1,\n            period: 1,\n            periodUnit: 'd'\n          }\n        },\n        route: {\n          coding: { CCL.FormatCode(&quot;Oral route code&quot;) }\n        },\n        method: {\n          coding: { CCL.FormatCode(&quot;Swallow dosing instruction code&quot;) }\n        }\n      }\n    }\n  }\n\n/* Additional instructions for the ClindamycinRequest, including a message displayed only\nfor pregnant patients.\n*/\ndefine ClindamycinAdditionalInstructions:\n  if (IsPregnant) then { AntimicrobialPregnancyInstructions }\n  else { { text: 'none'} }\n\n// An ActivityDefinition resource representing a MedicationRequest for Clindamycin.\ndefine ClindamycinRequest:\n  {\n    resourceType: 'ActivityDefinition',\n    id: 'ClindamycinRequest',\n    url: 'https://cds.ahrq.gov/cdsconnect/artifact/anthrax-post-exposure-prophylaxis',\n    identifier: {\n      {\n        value: 'Anthrax_Post_Exposure_Prophylaxis_FHIRv400_CQL_v110/ClindamycinRequest'\n      }\n    },\n    version: CqlVersion,\n    name: 'Anthrax_Post_Exposure_Prophylaxis_Adults_Clindamycin_Request',\n    title: 'Anthrax Post Exposure Prophylaxis (PEP) for Adults: Clindamycin Request',\n    status: 'draft',\n    experimental: true,\n    date: '2019-06-07',\n    publisher: 'Centers for Disease Control and Prevention',\n    description: ActivityDefinitionDescription,\n    purpose: ActivityDefinitionPurpose,\n    usage: ActivityDefinitionUsage,\n    approvalDate: '2019-06-07',\n    lastReviewDate: '2019-06-07',\n    effectivePeriod: {\n      start: '2019-06-07'\n    },\n    useContext: TreatmentUseContext,\n    topic: Topics,\n    author: {Author},\n    endorser: {Endorser},\n    contact: ContactInfo,\n    copyright: CopyrightStatement,\n    kind: 'MedicationRequest',\n    productCodeableConcept: {\n      coding: { CCL.FormatCode(&quot;Clindamycin Rx code&quot;) },\n      text: &quot;Clindamycin Rx code&quot;.display\n    },\n    quantity: {\n      value: 360,\n      system: 'http://hl7.org/fhir/v3/orderableDrugForm',\n      code: 'ORTAB'\n    },\n    dosage: {\n      {\n        text: 'Two tablets every 8 hours for 60 days',\n        additionalInstruction: ClindamycinAdditionalInstructions,\n        timing: {\n          repeat: {\n            frequency: 2,\n            period: 8,\n            periodUnit: 'h'\n          }\n        },\n        route: {\n          coding: { CCL.FormatCode(&quot;Oral route code&quot;) }\n        },\n        method: {\n          coding: { CCL.FormatCode(&quot;Swallow dosing instruction code&quot;) }\n        }\n      }\n    }\n  }\n\n/* The antimicrobial Action to appear in the order set. References the five preceeding\nantimicrobial MedicationRequest resources. If the patient doesn't meet the inclusion\ncriteria and already has an existing prescription, then this will be empty.\n*/\ndefine AntimicrobialAction:\n  if (RecentlyExposedToAnthrax and Is18orOlder and Asymptomatic) then {\n    title: 'Antimicrobial medications for anthrax post-exposure prophylaxis',\n    groupingBehavior: 'visual-group',\n    selectionBehavior: 'at-most-one',\n    action: {\n    {\n      title: 'First line antimicrobial medications for anthrax post-exposure prophylaxis',\n      groupingBehavior: 'visual-group',\n      selectionBehavior: 'at-most-one',\n      action: {\n        {\n          type: {\n            coding: { CCL.FormatCode(&quot;FHIR ActionType create code&quot;) }\n          },\n          definitionCanonical: '#' + CiprofloxacinRequest.id\n        },\n        {\n          type: {\n            coding: { CCL.FormatCode(&quot;FHIR ActionType create code&quot;) }\n          },\n          definitionCanonical: '#' + DoxycyclineRequest.id\n        }\n      }\n    },\n    {\n      title: 'Second line antimicrobial medications for anthrax post-exposure prophylaxis',\n      groupingBehavior: 'visual-group',\n      selectionBehavior: 'at-most-one',\n      action: {\n        {\n          type: {\n            coding: { CCL.FormatCode(&quot;FHIR ActionType create code&quot;) }\n          },\n          definitionCanonical: '#' + LevofloxacinRequest.id\n        },\n        {\n          type: {\n            coding: { CCL.FormatCode(&quot;FHIR ActionType create code&quot;) }\n          },\n          definitionCanonical: '#' + MoxifloxacinRequest.id\n        },\n        {\n          type: {\n            coding: { CCL.FormatCode(&quot;FHIR ActionType create code&quot;) }\n          },\n          definitionCanonical: '#' + ClindamycinRequest.id\n        }\n      }\n    }}\n  } else null\n\n/* The list of actions for the PlanDefinition order set. It can consist of AntimicrobialAction,\nVaccineAction, both, or neither.\n*/\ndefine ActionList:\n  if (VaccineAction is not null) then\n    if (AntimicrobialAction is not null) then {\n      AntimicrobialAction,\n      VaccineAction\n    }\n    else {\n      VaccineAction\n    }\n  else\n    if (AntimicrobialAction is not null) then {\n      AntimicrobialAction\n    }\n    else null\n\n/* To make packaging the order set easier, we embed all the Actions into the order set\nusing FHIR contained resources. This list of contained resources can contain the\nActivityDefinitions for the antimicrobial, the vaccine, both, or neither.\n*/\ndefine ContainedResourcesList:\n  if (VaccineAction is not null) then\n    if (AntimicrobialAction is not null) then {\n      CiprofloxacinRequest,\n      DoxycyclineRequest,\n      LevofloxacinRequest,\n      MoxifloxacinRequest,\n      ClindamycinRequest,\n      VaccineRequest\n    }\n    else {\n      VaccineRequest\n    }\n  else\n    if (AntimicrobialAction is not null) then {\n      CiprofloxacinRequest,\n      DoxycyclineRequest,\n      LevofloxacinRequest,\n      MoxifloxacinRequest,\n      ClindamycinRequest\n    }\n    else null\n\ndefine GenerateOrderSet:\n  RecentlyExposedToAnthrax and Is18orOlder and Asymptomatic\n\n/* The order set containing the recommended treatment for Anthrax PEP. It references the\nActionList and the ContainedResourcesList. If treatment is not recommended, then this\nresource will be empty.\n*/\ndefine OrderSet:\n  if (GenerateOrderSet) then {\n    resourceType: 'PlanDefinition',\n    url: 'https://cds.ahrq.gov/cdsconnect/artifact/anthrax-post-exposure-prophylaxis',\n    identifier: {\n      {\n        value: 'Anthrax_Post_Exposure_Prophylaxis_FHIRv400_CQL_v110/OrderSet'\n      }\n    },\n    version: CqlVersion,\n    name: 'Anthrax_Post_Exposure_Prophylaxis_Adults',\n    title: 'Anthrax Post Exposure Prophylaxis (PEP) for Adults',\n    status: 'draft',\n    experimental: true,\n    type: {\n      coding: {\n        CCL.FormatCode(&quot;FHIR PlanDefinition eca-rule code&quot;),\n        CCL.FormatCode(&quot;FHIR PlanDefinition order-set code&quot;)\n      }\n    },\n    date: '2019-06-07',\n    publisher: 'Centers for Disease Control and Prevention',\n    description: 'Provides information for treating patients greater than or equal to 18 years old exposed to anthrax within the past 60 days, who do not have anthrax. It is divided into two parts: \\\\n- Part #1: For patients that may be symptomatic to flag the need to conduct a full diagnostic evaluation to rule out anthrax before proceeding with post-exposure prophylaxis (PEP) \\\\n- Part #2: For patients  who are  asymptomatic (not displaying signs and symptoms of anthrax), it provides recommended PEP regimen',\n    purpose: 'Provides clinicians with information for quickly assessing individuals exposed to anthrax unrelated to occupational exposure, for example in bioterrorism events, and provides the recommended post-exposure prophylaxis (PEP) regimen for asymptomatic patients. Includes immediate treatment with antimicrobials and vaccine and follow-up administration of subsequent vaccines to complete the recommended 3-dose vaccination series.',\n    usage: 'Intended for use by clinicians caring for individuals ≥18 years of age in an outpatient setting.',\n    approvalDate: '2019-06-07',\n    lastReviewDate: '2019-06-07',\n    effectivePeriod: {\n      start: '2019-06-07'\n    },\n    useContext: TreatmentUseContext,\n    jurisdiction: { { &quot;coding&quot;: { CCL.FormatCode(&quot;United States code&quot;) } } },\n    topic: Topics,\n    author: {Author},\n    endorser: {Endorser},\n    contact: ContactInfo,\n    copyright: CopyrightStatement,\n    &quot;library&quot;: {\n      'Library/Anthrax_Post_Exposure_Prophylaxis_FHIRv400_Library'\n    },\n    action: { {\n      title: 'Anthrax Post Exposure Prophylaxis',\n      groupingBehavior: 'logical-group',\n      selectionBehavior: 'any',\n      trigger: {\n        {\n          type: 'data-added',\n          data: {\n            {\n              type: 'Condition',\n              codeFilter: {\n                {\n                  path: 'code',\n                  code: {\n                    CCL.FormatCode(&quot;Exposure to Anthrax code&quot;),\n                    CCL.FormatCode(&quot;Exposure to Bacillus anthracis (event) code&quot;)\n                  }\n                }\n              }\n            }\n          }\n        },\n        {\n          type: 'data-added',\n          data: {\n            {\n              type: 'Observation',\n              codeFilter: {\n                {\n                  path: 'code',\n                  code: {\n                    CCL.FormatCode(&quot;Exposure to Anthrax code&quot;),\n                    CCL.FormatCode(&quot;Exposure to Bacillus anthracis (event) code&quot;),\n                    CCL.FormatCode(&quot;Asymptomatic code&quot;)\n                  }\n                }\n              }\n            }\n          }\n        }\n      },\n      condition: {\n        {\n          kind: 'applicability',\n          expression: {\n            language: 'text/cql',\n            expression: 'GenerateOrderSet'\n          }\n        }\n      },\n      action: ActionList\n    } },\n    contained: ContainedResourcesList\n  }\n  else null\n</code></pre><p><code>No Content</code> (<code>application/elm+xml</code>)</p></div>"
  ] ; # 
  fhir:url [ fhir:v "http://cqframework.org/cpg-example-anthrax/Library/anthrax-post-exposure-prophylaxis-library"^^xsd:anyURI] ; # 
  fhir:identifier ( [
     fhir:use [ fhir:v "official" ] ;
     fhir:value [ fhir:v "Anthrax_Post_Exposure_Prophylaxis_FHIRv400" ]
  ] ) ; # 
  fhir:version [ fhir:v "1.1.0"] ; # 
  fhir:name [ fhir:v "Anthrax_Post_Exposure_Prophylaxis_FHIRv400_Library"] ; # 
  fhir:title [ fhir:v "Anthrax Post Exposure Prophylaxis (PEP) for Adults FHIRv400 Logic"] ; # 
  fhir:status [ fhir:v "draft"] ; # 
  fhir:experimental [ fhir:v "true"^^xsd:boolean] ; # 
  fhir:type [
     fhir:coding ( [
       fhir:system [ fhir:v "http://terminology.hl7.org/CodeSystem/library-type"^^xsd:anyURI ] ;
       fhir:code [ fhir:v "logic-library" ]
     ] )
  ] ; # 
  fhir:date [ fhir:v "2024-11-18T16:43:41+00:00"^^xsd:dateTime] ; # 
  fhir:publisher [ fhir:v "HL7 International - Clinical Decision Support WG"] ; # 
  fhir:contact ( [
     fhir:name [ fhir:v "HL7 International - Clinical Decision Support WG" ] ;
     fhir:telecom ( [
       fhir:system [ fhir:v "url" ] ;
       fhir:value [ fhir:v "http://www.hl7.org/Special/committees/dss/index.cfm" ]
     ] )
  ] ) ; # 
  fhir:description [ fhir:v "Clinical decision support logic for Anthrax Post Exposure Prophylaxis (PEP) for Adults based on the following Centers for Disease Control and Prevention reports: \\n- Hendricks, K.A. et al., Centers for Disease Control and Prevention Expert Panel Meetings on Prevention and Treatment of Anthrax in Adults. Emerg Infect Dis, 20(20), Feb 2014. \\n - Hendricks, K.A. et al., Centers for Disease Control and Prevention Expert Panel Meetings on Prevention and Treatment of Anthrax in Adults: Technical Report. Emerg Infect Dis. 20(20), Feb 2014. \\n- Emergent BioSolutions, BioThrax Anthrax Vaccine Adsorbed (http://www.biothrax.com/whatisbiothrax/). \\n- Centers for Disease Control and Prevention, Ciprofloxacin for Post-Exposure Prophylaxis of Anthrax: Emergency Use Instructions for Healthcare Providers, 2017. \\n- Centers for Disease Control and Prevention. Doxycyxcline for Post-Exposure Prophylaxis of Anthrax: Emergency Use Instructions for Healthcare Providers, 2017. \\n- Public Health Information Network Vocabulary Access and Distribution System (PHIN VADS), PHVS_SignsSymptoms_Anthrax (OID 2.16.840.1.114222.4.11.3212), 2009. \\n- Meanye-Delman D et al., Special Considerations for Prophylaxis for and Treatment of Anthrax in Pregnant and Postpartum Women, Emerg Infect Dis, 20(2), 2014. \\n- Meanye-Delman D et al., Special Considerations for Prophylaxis for and Treatment of Anthrax in Pregnant and Postpartum Women: Technical Report, Emerg Infect Dis, 20(2), 2014. \\n- Wright, J.G et al., Use of Anthrax Vaccine in the United States: Recommendations of the Advisory Committee on Immunization Practices (ACIP), 2009, Morbidity and Mortality Weeklly Report, July 23, 2010 / 59(RR06); 1-30."] ; # 
  fhir:useContext ( [
     fhir:code [
       fhir:system [ fhir:v "http://terminology.hl7.org/CodeSystem/usage-context-type"^^xsd:anyURI ] ;
       fhir:code [ fhir:v "age" ] ;
       fhir:display [ fhir:v "Age Range" ]
     ] ;
     fhir:value [
       a fhir:Range ;
       fhir:low [
         fhir:value [ fhir:v "18"^^xsd:decimal ]
       ]
     ]
  ] [
     fhir:code [
       fhir:system [ fhir:v "http://terminology.hl7.org/CodeSystem/usage-context-type"^^xsd:anyURI ] ;
       fhir:code [ fhir:v "venue" ] ;
       fhir:display [ fhir:v "Clinical Venue" ]
     ] ;
     fhir:value [
       a fhir:CodeableConcept ;
       fhir:coding ( [
         a sct:440655000 ;
         fhir:system [ fhir:v "http://snomed.info/sct"^^xsd:anyURI ] ;
         fhir:code [ fhir:v "440655000" ] ;
         fhir:display [ fhir:v "Outpatient environment" ]
       ] )
     ]
  ] [
     fhir:code [
       fhir:system [ fhir:v "http://terminology.hl7.org/CodeSystem/usage-context-type"^^xsd:anyURI ] ;
       fhir:code [ fhir:v "focus" ] ;
       fhir:display [ fhir:v "Clinical Focus" ]
     ] ;
     fhir:value [
       a fhir:CodeableConcept ;
       fhir:coding ( [
         fhir:system [ fhir:v "http://hl7.org/fhir/sid/icd-10-cm"^^xsd:anyURI ] ;
         fhir:code [ fhir:v "Z20.810" ] ;
         fhir:display [ fhir:v "Contact with and (suspected) exposure to anthrax" ]
       ] )
     ]
  ] [
     fhir:code [
       fhir:system [ fhir:v "http://terminology.hl7.org/CodeSystem/usage-context-type"^^xsd:anyURI ] ;
       fhir:code [ fhir:v "focus" ] ;
       fhir:display [ fhir:v "Clinical Focus" ]
     ] ;
     fhir:value [
       a fhir:CodeableConcept ;
       fhir:coding ( [
         a sct:170475009 ;
         fhir:system [ fhir:v "http://snomed.info/sct"^^xsd:anyURI ] ;
         fhir:code [ fhir:v "170475009" ] ;
         fhir:display [ fhir:v "Exposure to Bacillus anthracis (event)" ]
       ] )
     ]
  ] [
     fhir:code [
       fhir:system [ fhir:v "http://terminology.hl7.org/CodeSystem/usage-context-type"^^xsd:anyURI ] ;
       fhir:code [ fhir:v "focus" ] ;
       fhir:display [ fhir:v "Clinical Focus" ]
     ] ;
     fhir:value [
       a fhir:CodeableConcept ;
       fhir:coding ( [
         a sct:84387000 ;
         fhir:system [ fhir:v "http://snomed.info/sct"^^xsd:anyURI ] ;
         fhir:code [ fhir:v "84387000" ] ;
         fhir:display [ fhir:v "Asymptomatic (finding)" ]
       ] )
     ]
  ] ) ; # 
  fhir:jurisdiction ( [
     fhir:coding ( [
       fhir:system [ fhir:v "http://unstats.un.org/unsd/methods/m49/m49.htm"^^xsd:anyURI ] ;
       fhir:code [ fhir:v "001" ] ;
       fhir:display [ fhir:v "World" ]
     ] )
  ] ) ; # 
  fhir:purpose [ fhir:v "Provides clinicians with information for quickly assessing individuals exposed to anthrax unrelated to occupational exposure, for example in bioterrorism events, and provides the recommended post-exposure prophylaxis (PEP) regimen for asymptomatic patients. Includes immediate treatment with antimicrobials and vaccine and follow-up administration of subsequent vaccines to complete the recommended 3-dose vaccination series."] ; # 
  fhir:usage [ fhir:v "Intended for use by clinicians caring for individuals ≥18 years of age in an outpatient setting."] ; # 
  fhir:topic ( [
     fhir:text [ fhir:v "Anthrax" ]
  ] [
     fhir:text [ fhir:v "Emergency Medicine" ]
  ] [
     fhir:text [ fhir:v "Post-Exposure Prophylaxis" ]
  ] ) ; # 
  fhir:author ( [
     fhir:name [ fhir:v "Alliance to Modernize Healthcare FFRDC" ]
  ] ) ; # 
  fhir:endorser ( [
     fhir:name [ fhir:v "Centers for Disease Control and Prevention" ]
  ] ) ; # 
  fhir:content ( [
     fhir:contentType [ fhir:v "text/cql" ] ;
     fhir:data [ fhir:v "LyogIExpYnJhcnk6IEFudGhyYXggUG9zdCBFeHBvc3VyZSBQcm9waHlsYXhpcyAoUEVQKSBmb3IgQWR1bHRzLCBGSElSIFI0IGRhdGEgbW9kZWwuCiAgICBBdXRob3I6IENNUyBBbGxpYW5jZSB0byBNb2Rlcm5pemUgSGVhbHRoY2FyZSwgb3BlcmF0ZWQgYnkgVEhFIE1JVFJFIENvcnBvcmF0aW9uLgoKICAgIChDKSAyMDE5IFRoZSBNSVRSRSBDb3Jwb3JhdGlvbi4gQWxsIFJpZ2h0cyBSZXNlcnZlZC4gQXBwcm92ZWQgZm9yIFB1YmxpYyBSZWxlYXNlOiAxOS0yMDQ4LiBEaXN0cmlidXRpb24gVW5saW1pdGVkLgoKICAgIENoYW5nZSBsb2c6CiAgICAtIFZlcnNpb24gMS4xLjA6IFVwZGF0ZWQgb3V0cHV0IHJlc291cmNlcyB0byBhbGlnbiB3aXRoIGRyYWZ0IHByb2ZpbGVzIHBvc3RlZCBhdDoKICAgIGh0dHA6Ly9idWlsZC5maGlyLm9yZy9pZy9ITDcvY3FmLXJlY29tbWVuZGF0aW9ucy9wcm9maWxlcy5odG1sCiAgICBBbHNvIHJlZmFjdG9yZWQgQ1FMIHRvIHB1dCBDREMtc3BlY2lmaWMgZnVuY3Rpb25zIGluIGEgc2VwZXJhdGUgbGlicmFyeS4KKi8KbGlicmFyeSBBbnRocmF4X1Bvc3RfRXhwb3N1cmVfUHJvcGh5bGF4aXNfQWR1bHRzX0ZISVJ2NDAwIHZlcnNpb24gJzEuMS4wJwoKLyogLS0tLS0tLS0tLS0tLSBSRUZFUkVOQ0VTIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLSBIZW5kcmlja3MsIEsuQS4gZXQgYWwuLCBDZW50ZXJzIGZvciBEaXNlYXNlIENvbnRyb2wgYW5kIFByZXZlbnRpb24gRXhwZXJ0IFBhbmVsIE1lZXRpbmdzIG9uIFByZXZlbnRpb24gYW5kIFRyZWF0bWVudCBvZiBBbnRocmF4IGluIEFkdWx0cy4gRW1lcmcgSW5mZWN0IERpcywgMjAoMjApLCBGZWIgMjAxNC4KLSBIZW5kcmlja3MsIEsuQS4gZXQgYWwuLCBDZW50ZXJzIGZvciBEaXNlYXNlIENvbnRyb2wgYW5kIFByZXZlbnRpb24gRXhwZXJ0IFBhbmVsIE1lZXRpbmdzIG9uIFByZXZlbnRpb24gYW5kIFRyZWF0bWVudCBvZiBBbnRocmF4IGluIEFkdWx0czogVGVjaG5pY2FsIFJlcG9ydC4gRW1lcmcgSW5mZWN0IERpcy4gMjAoMjApLCBGZWIgMjAxNC4KLSBFbWVyZ2VudCBCaW9Tb2x1dGlvbnMsIEJpb1RocmF4IEFudGhyYXggVmFjY2luZSBBZHNvcmJlZCAoaHR0cDovL3d3dy5iaW90aHJheC5jb20vd2hhdGlzYmlvdGhyYXgvKS4KLSBDZW50ZXJzIGZvciBEaXNlYXNlIENvbnRyb2wgYW5kIFByZXZlbnRpb24sIENpcHJvZmxveGFjaW4gZm9yIFBvc3QtRXhwb3N1cmUgUHJvcGh5bGF4aXMgb2YgQW50aHJheDogRW1lcmdlbmN5IFVzZSBJbnN0cnVjdGlvbnMgZm9yIEhlYWx0aGNhcmUgUHJvdmlkZXJzLCAyMDE3LgotIENlbnRlcnMgZm9yIERpc2Vhc2UgQ29udHJvbCBhbmQgUHJldmVudGlvbi4gRG94eWN5eGNsaW5lIGZvciBQb3N0LUV4cG9zdXJlIFByb3BoeWxheGlzIG9mIEFudGhyYXg6IEVtZXJnZW5jeSBVc2UgSW5zdHJ1Y3Rpb25zIGZvciBIZWFsdGhjYXJlIFByb3ZpZGVycywgMjAxNy4KLSBQdWJsaWMgSGVhbHRoIEluZm9ybWF0aW9uIE5ldHdvcmsgVm9jYWJ1bGFyeSBBY2Nlc3MgYW5kIERpc3RyaWJ1dGlvbiBTeXN0ZW0gKFBISU4gVkFEUyksIFBIVlNfU2lnbnNTeW1wdG9tc19BbnRocmF4IChPSUQgMi4xNi44NDAuMS4xMTQyMjIuNC4xMS4zMjEyKSwgMjAwOS4KLSBNZWFueWUtRGVsbWFuIEQgZXQgYWwuLCBTcGVjaWFsIENvbnNpZGVyYXRpb25zIGZvciBQcm9waHlsYXhpcyBmb3IgYW5kIFRyZWF0bWVudCBvZiBBbnRocmF4IGluIFByZWduYW50IGFuZCBQb3N0cGFydHVtIFdvbWVuLCBFbWVyZyBJbmZlY3QgRGlzLCAyMCgyKSwgMjAxNC4KLSBNZWFueWUtRGVsbWFuIEQgZXQgYWwuLCBTcGVjaWFsIENvbnNpZGVyYXRpb25zIGZvciBQcm9waHlsYXhpcyBmb3IgYW5kIFRyZWF0bWVudCBvZiBBbnRocmF4IGluIFByZWduYW50IGFuZCBQb3N0cGFydHVtIFdvbWVuOiBUZWNobmljYWwgUmVwb3J0LCBFbWVyZyBJbmZlY3QgRGlzLCAyMCgyKSwgMjAxNC4KLSBXcmlnaHQsIEouRyBldCBhbC4sIFVzZSBvZiBBbnRocmF4IFZhY2NpbmUgaW4gdGhlIFVuaXRlZCBTdGF0ZXM6IFJlY29tbWVuZGF0aW9ucyBvZiB0aGUgQWR2aXNvcnkgQ29tbWl0dGVlIG9uIEltbXVuaXphdGlvbiBQcmFjdGljZXMgKEFDSVApLCAyMDA5LCBNb3JiaWRpdHkgYW5kIE1vcnRhbGl0eSBXZWVrbHkgUmVwb3J0LCBKdWx5IDIzLCAyMDEwIC8gNTkoUlIwNik7IDEtMzAuCiovCgovKiAtLS0tLS0tLS0tLS0tIEtFWSBBU1NVTVBUSU9OUyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoxLiBBbnRocmF4IGV4cG9zdXJlIHJlcHJlc2VudGVkIGJ5IG9uZSBvZiB0d28gY29kZXMgaW4gZWl0aGVyIGEgQ29uZGl0aW9uIG9yIE9ic2VydmF0aW9uIEZISVIgUjQgcmVzb3VyY2UuIFRoZSBwYXJhbWV0ZXIgRXhwb3N1cmVfTG9va19CYWNrX1BlcmlvZCBjb250cm9scyBob3cgZmFyIGJhY2sgdG8gZmlsdGVyIHBvdGVudGlhbCBleHBvc3VyZSByZXNvdXJjZXMuIERlZmF1bHQgaXMgNjAgZGF5cy4KMi4gQXN5bXB0b21hdGljIHJlcHJlc2VudGVkIGJ5IFNOT01FRC1DVCBjb2RlIDg0Mzg3MDAwIGluIGFuIE9ic2VydmF0aW9uIEZISVIgUjQgcmVzb3VyY2UuIEFzeW1wdG9tYXRpYyBPYnNlcnZhdGlvbiBtdXN0IG9jY3VyIG9uIHRoZSBzYW1lIGRheSBvciBhZnRlciB0aGUgZXhwb3N1cmUgZGF0ZS4KMy4gRXhpc3RpbmcgYW50aW1pY3JvYmlhbCBSeCBmb3VuZCBieSBxdWVyeWluZyBNZWRpY2F0aW9uUmVxdWVzdCBhbmQgTWVkaWNhdGlvblN0YXRlbWVudCBGSElSIFI0IHJlc291cmNlcy4KNC4gQWRtaW5pc3RyYXRpb24gb2YgdGhlIEFudGhyYXggdmFjY2luZSByZXByZXNlbnRlZCBieSBvbmUgb2YgdGhlIHNlcXVlbnRpYWwgU05PTUVELUNUIHByb2NlZHVyZSBjb2Rlcy4gVGhpcyBpcyBob3cgcGFzdCBkb3NlcyBhcmUgZGlzY292ZXJlZCB2aWEgcXVlcnlpbmcgZm9yIFByb2NlZHVyZSBGSElSIHJlc291cmNlcy4KNS4gVGhlIHJlY29tbWVuZGVkIHNwYWNpbmcgYmV0d2VlbiBzdWJzZXF1ZW50IGRvc2VzIG9mIHRoZSB2YWNjaW5lIGlzIGNvbnRyb2xsZWQgYnkgdGhlIHBhcmFtZXRlciBTcGFjaW5nX0JldHdlZW5fVmFjY2luZV9Eb3Nlcywgd2hpY2ggaGFzIGEgZGVmYXVsdCB2YWx1ZSBvZiB0d28gd2Vla3MuIEEgcGF0aWVudCB1bmRlcmdvaW5nIEFudGhyYXggUEVQIHdpbGwgb25seSBiZSByZWNvbW1lbmRlZCB0aGVpciBuZXh0IHZhY2NpbmUgZG9zZSBpZiB0d28gd2Vla3MgaGF2ZSBlbGFwc2VkIHNpbmNlIHRoZWlyIGxhc3QgYW5kIGlmIHRoZXkgaGF2ZSBub3QgcmVjZWl2ZWQgdGhlIHJlY29tbWVuZGVkIGFsbG90bWFudCBvZiB0aHJlZSBkb3Nlcy4KNi4gUHJlZ25hbmN5IGNhbiBiZSByZXByZXNlbnRlZCBhcyBhbiBPYnNlcnZhdGlvbiBvciBhIENvbmRpdGlvbiBGSElSIFI0IHJlc291cmNlLiBCb3RoIHR5cGVzIG9mIHJlc291Y2VzIGFyZSBleGFtaW5lZCB0byBkZXRlcm1pbmUgaWYgdGhlIHBhdGllbnQgaXMgcHJlZ25hbnQuCjcuIEFsbGVyZ2llcyBhcmUgZGlzY292ZXJlZCBieSBxdWVyeWluZyBmb3IgQWxsZXJneUludG9sZXJhbmNlIEZISVIgUjQgcmVzb3VyY2VzIHRoYXQgY29udGFpbiBpbmdyZWRpZW50L3N1YnN0YW5jZSBjb2RlcyBmb3IgYW55IG9mIHRoZSBwb3RlbnRpYWxseSByZWNvbW1lbmRlZCBQRVAgdHJlYXRtZW50cy4gVGhpcyBpbmNsdWRlcyB0aGUgYW50aW1pY3JvYmlhbHMsIHRoZSB2YWNjaW5lLCBhbmQgbGF0ZXguCjguIEFsZXJ0cyBhcmUgY29tbXVuaWNhdGVkIHZpYSBlaXRoZXIgRGV0ZWN0ZWRJc3N1ZSBvciBGbGFnIEZISVIgcmVzb3VyY2VzLgo5LiBBc2lkZSBmcm9tIHRoZSBhbGVydHMsIHRoZSBtYWluIG91dHB1dCBvZiB0aGlzIENEUyBpcyBhbiBvcmRlciBzZXQuIEl0IGlzIHJlcHJlc2VudGVkIHZpYSBGSElSIFI0IHJlc291cmNlcyAoQWN0aXZpdHlEZWZpbml0aW9uIGFuZCBQbGFuRGVmaW5pdGlvbikuCjEwLiBUaGlzIENEUyBvdXRwdXRzIHZhcmlvdXMgRkhJUiByZXNvdXJjZSBvYmplY3RzLiBGb3IgdGhlIHB1cnBvc2VzIG9mIGxvY2FsIEZISVIgcmVmZXJlbmNlcywgaXQgaXMgYXNzdW1lZCBhbGwgZ2VuZXJhdGVkIEZISVIgcmVzb3VyY2VzIHdpbGwgYmUgcmV0dXJuZWQgaW4gYSBzaW5nbGUgRkhJUiBidW5kbGUuCiovCgovLyBEYXRhIG1vZGVsCnVzaW5nIEZISVIgdmVyc2lvbiAnNC4wLjAnCgovLyAtLS0tLS0tLS0tLS0tIExJQlJBUklFUyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBUaGUgQ0RTIENvbm5lY3QgQ29tbW9ucyBmb3IgRkhJUnY0MDAgbGlicmFyeSBwcm92aWRlcyBmdW5jdGlvbnMgcmVwcmVzZW50aW5nCi8vIGNvbW1vbmx5IHVzZWQgQ0RTIGxvZ2ljIGFuZCBwYXR0ZXJucy4KaW5jbHVkZSBDRFNfQ29ubmVjdF9Db21tb25zX2Zvcl9GSElSdjQwMCB2ZXJzaW9uICcxLjMuMicgY2FsbGVkIEMzRgovLyBUaGUgRkhJUkhlbHBlcnMgbGlicmFyeSBwcm92aWRlcyBmdW5jdGlvbnMgZm9yIHdvcmtpbmcgd2l0aCBGSElSIHJlc291cmNlcy4KaW5jbHVkZSBGSElSSGVscGVycyB2ZXJzaW9uICc0LjAuMCcgY2FsbGVkIEZISVJIZWxwZXJzCi8vIE1vcmUgY29tbW9uIGxvZ2ljIGZvciBDREMgQ0RTCmluY2x1ZGUgQ0RDX0NvbW1vbl9Mb2dpY19GSElSdjQwMCB2ZXJzaW9uICcxLjAuMCcgY2FsbGVkIENDTAoKLy8gLS0tLS0tLS0tLS0tLSBDT0RFIFNZU1RFTVMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KY29kZXN5c3RlbSAiTE9JTkMiOiAnaHR0cDovL2xvaW5jLm9yZycKY29kZXN5c3RlbSAiU05PTUVELUNUIjogJ2h0dHA6Ly9zbm9tZWQuaW5mby9zY3QnCmNvZGVzeXN0ZW0gIklDRC0xMC1DTSI6ICdodHRwOi8vaGw3Lm9yZy9maGlyL3NpZC9pY2QtMTAtY20nCmNvZGVzeXN0ZW0gIlJYTk9STSI6ICdodHRwOi8vd3d3Lm5sbS5uaWguZ292L3Jlc2VhcmNoL3VtbHMvcnhub3JtJwpjb2Rlc3lzdGVtICJBQ1RDT0RFIjogJ2h0dHA6Ly90ZXJtaW5vbG9neS5obDcub3JnL0NvZGVTeXN0ZW0vdjMtQWN0Q29kZScKY29kZXN5c3RlbSAiQ1ZYIjogJ2h0dHA6Ly9obDcub3JnL2ZoaXIvc2lkL2N2eCcKY29kZXN5c3RlbSAiRkhJUi1BQ1RJT04tVFlQRSI6ICdodHRwOi8vdGVybWlub2xvZ3kuaGw3Lm9yZy9Db2RlU3lzdGVtL2FjdGlvbi10eXBlJwpjb2Rlc3lzdGVtICJGSElSLVBMQU5ERUZJTklUSU9OLVRZUEUiOiAnaHR0cDovL3Rlcm1pbm9sb2d5LmhsNy5vcmcvQ29kZVN5c3RlbS9wbGFuLWRlZmluaXRpb24tdHlwZScKY29kZXN5c3RlbSAiRkhJUi1VU0FHRS1DT05URVhULVRZUEUiOiAnaHR0cDovL3Rlcm1pbm9sb2d5LmhsNy5vcmcvQ29kZVN5c3RlbS91c2FnZS1jb250ZXh0LXR5cGUnCmNvZGVzeXN0ZW0gIklTTy0zMTY2LUNPVU5UUlktQ09ERVMiOiAndXJuOmlzbzpzdGQ6aXNvOjMxNjYnCgovLyAtLS0tLS0tLS0tLS0tIFZBTFVFIFNFVFMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQp2YWx1ZXNldCAiQ2lwcm9mbG94YWNpbiBtZWRpY2F0aW9ucyI6ICcyLjE2Ljg0MC4xLjExMzc2Mi4xLjQuMTAzMi42NycKdmFsdWVzZXQgIkRveHljeWNsaW5lIG1lZGljYXRpb25zIjogJzIuMTYuODQwLjEuMTEzNzYyLjEuNC4xMDMyLjY2Jwp2YWx1ZXNldCAiTGV2b2Zsb3hhY2luIG1lZGljYXRpb25zIjogJzIuMTYuODQwLjEuMTEzNzYyLjEuNC4xMDMyLjY5Jwp2YWx1ZXNldCAiTW94aWZsb3hhY2luIG1lZGljYXRpb25zIjogJzIuMTYuODQwLjEuMTEzNzYyLjEuNC4xMDMyLjcwJwp2YWx1ZXNldCAiQ2xpbmRhbXljaW4gbWVkaWNhdGlvbnMiOiAnMi4xNi44NDAuMS4xMTM3NjIuMS40LjEwMzIuNjgnCnZhbHVlc2V0ICJMYXRleCI6ICcyLjE2Ljg0MC4xLjExMzc2Mi4xLjQuMTAzMi43NicKdmFsdWVzZXQgIlByZWduYW5jeSI6ICcyLjE2Ljg0MC4xLjExMzg4My4zLjUyNi4zLjM3OCcKCi8vIC0tLS0tLS0tLS0tLS0gQ09ERVMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIEV4cG9zdXJlIGNvZGVzCmNvZGUgIkV4cG9zdXJlIHRvIEFudGhyYXggY29kZSI6ICdaMjAuODEwJyBmcm9tICJJQ0QtMTAtQ00iIGRpc3BsYXkgJ0V4cG9zdXJlIHRvIEFudGhyYXgnCmNvZGUgIkV4cG9zdXJlIHRvIEJhY2lsbHVzIGFudGhyYWNpcyAoZXZlbnQpIGNvZGUiOiAnMTcwNDc1MDA5JyBmcm9tICJTTk9NRUQtQ1QiCiAgZGlzcGxheSAnRXhwb3N1cmUgdG8gQmFjaWxsdXMgYW50aHJhY2lzIChldmVudCknCgovLyBBc3ltcHRvbWF0aWMgY29kZS4KY29kZSAiQXN5bXB0b21hdGljIGNvZGUiOiAnODQzODcwMDAnIGZyb20gIlNOT01FRC1DVCIgZGlzcGxheSAnQXN5bXB0b21hdGljIChmaW5kaW5nKScKCi8vIFByZWduYW5jeSBjb2Rlcy4KY29kZSAiUHJlZ25hbmN5IHN0YXR1cyBjb2RlIjogJzgyODEwLTMnIGZyb20gIkxPSU5DIiBkaXNwbGF5ICdQcmVnbmFuY3kgc3RhdHVzJwpjb2RlICJQcmVnbmFudCBjb2RlIjogJzc3Mzg2MDA2JyBmcm9tICJTTk9NRUQtQ1QiIGRpc3BsYXkgJ1BhdGllbnQgY3VycmVudGx5IHByZWduYW50IChmaW5kaW5nKScKCi8vIEFudGhyYXggdmFjY2luZSByZXByZXNlbnRlZCBhcyBmb3VyIHNlcGFyYXRlIGNvZGVzLCBvbmUgZm9yIGVhY2ggc2VxdWVudGlhbGx5IGFkbWluaXN0ZXJlZCBkb3NlLgpjb2RlICJBbnRocmF4IHZhY2NpbmF0aW9uIGNvZGUiOiAnNDk1OTgwMDInIGZyb20gIlNOT01FRC1DVCIgZGlzcGxheSAnQW50aHJheCB2YWNjaW5hdGlvbiAocHJvY2VkdXJlKScKY29kZSAiRmlyc3QgYW50aHJheCB2YWNjaW5hdGlvbiBjb2RlIjogJzE3MDMzODAwMCcgZnJvbSAiU05PTUVELUNUIiBkaXNwbGF5ICdGaXJzdCBhbnRocmF4IHZhY2NpbmF0aW9uIChwcm9jZWR1cmUpJwpjb2RlICJTZWNvbmQgYW50aHJheCB2YWNjaW5hdGlvbiBjb2RlIjogJzE3MDMzOTAwOCcgZnJvbSAiU05PTUVELUNUIiBkaXNwbGF5ICdTZWNvbmQgYW50aHJheCB2YWNjaW5hdGlvbiAocHJvY2VkdXJlKScKY29kZSAiVGhpcmQgYW50aHJheCB2YWNjaW5hdGlvbiBjb2RlIjogJzE3MDM0MDAwNScgZnJvbSAiU05PTUVELUNUIiBkaXNwbGF5ICdUaGlyZCBhbnRocmF4IHZhY2NpbmF0aW9uIChwcm9jZWR1cmUpJwpjb2RlICJGb3VydGggYW50aHJheCB2YWNjaW5hdGlvbiBjb2RlIjogJzE3MDM0MTAwOScgZnJvbSAiU05PTUVELUNUIiBkaXNwbGF5ICdGb3VydGggYW50aHJheCB2YWNjaW5hdGlvbiAocHJvY2VkdXJlKScKCi8vIFJlY29tbWVuZGVkIGFudGltaWNyb2JpYWxzIGVhY2ggcmVwcmVzZW50ZWQgYnkgYSBzaW5nbGUgUnhOb3JtIGNvZGUuCmNvZGUgIkNpcHJvZmxveGFjaW4gUnggY29kZSI6ICczMDkzMDknIGZyb20gIlJYTk9STSIgZGlzcGxheSAnQ2lwcm9mbG94YWNpbiA1MDAgTUcgT3JhbCBUYWJsZXQnCmNvZGUgIkRveHljeWNsaW5lIFJ4IGNvZGUiOiAnMTY1MDE0MycgZnJvbSAiUlhOT1JNIiBkaXNwbGF5ICdkb3h5Y3ljbGluZSBoeWNsYXRlIDEwMCBNRyBPcmFsIFRhYmxldCcKY29kZSAiTGV2b2Zsb3hhY2luIFJ4IGNvZGUiOiAnMzExMjk2JyBmcm9tICJSWE5PUk0iIGRpc3BsYXkgJ0xldm9mbG94YWNpbiA3NTAgTUcgT3JhbCBUYWJsZXQnCmNvZGUgIk1veGlmbG94YWNpbiBSeCBjb2RlIjogJzMxMTc4NycgZnJvbSAiUlhOT1JNIiBkaXNwbGF5ICdtb3hpZmxveGFjaW4gSENsIDQwMCBNRyBPcmFsIFRhYmxldCcKY29kZSAiQ2xpbmRhbXljaW4gUnggY29kZSI6ICcyODQyMTUnIGZyb20gIlJYTk9STSIgZGlzcGxheSAnY2xpbmRhbXljaW4gSENsIDMwMCBNRyBPcmFsIENhcHN1bGUnCgovLyBDb2RlcyBmb3Igc3Vic3RhbmNlcywgbmVlZGVkIHRvIGhlbHAgY2hlY2sgZm9yIGNlcnRhaW4gYWxsZXJnaWVzLgpjb2RlICJDaXByb2Zsb3hhY2luIHN1YnN0YW5jZSBjb2RlIjogJzI1NTEnIGZyb20gIlJYTk9STSIgZGlzcGxheSAnQ2lwcm9mbG94YWNpbiAoc3Vic3RhbmNlL2luZ3JlZGllbnQpJwpjb2RlICJEb3h5Y3ljbGluZSBzdWJzdGFuY2UgY29kZSI6ICczNjQwJyBmcm9tICJSWE5PUk0iIGRpc3BsYXkgJ0RveHljeWNsaW5lIChzdWJzdGFuY2UvaW5ncmVkaWVudCknCmNvZGUgIkxldm9mbG94YWNpbiBzdWJzdGFuY2UgY29kZSI6ICc4MjEyMicgZnJvbSAiUlhOT1JNIiBkaXNwbGF5ICdMZXZvZmxveGFjaW4gKHN1YnN0YW5jZS9pbmdyZWRpZW50KScKY29kZSAiTW94aWZsb3hhY2luIHN1YnN0YW5jZSBjb2RlIjogJzEzOTQ2MicgZnJvbSAiUlhOT1JNIiBkaXNwbGF5ICdNb3hpZmxveGFjaW4gKHN1YnN0YW5jZS9pbmdyZWRpZW50KScKY29kZSAiQ2xpbmRhbXljaW4gc3Vic3RhbmNlIGNvZGUiOiAnMjU4MicgZnJvbSAiUlhOT1JNIiBkaXNwbGF5ICdDbGluZGFteWNpbiAoc3Vic3RhbmNlL2luZ3JlZGllbnQpJwpjb2RlICJMYXRleCBzdWJzdGFuY2UgY29kZSI6ICcxMzE0ODkxJyBmcm9tICJSWE5PUk0iIGRpc3BsYXkgJ0xhdGV4IChzdWJzdGFuY2UvaW5ncmVkaWVudCknCmNvZGUgIkFudGhyYXggdmFjY2luZSBzdWJzdGFuY2UgY29kZSI6ICc0MDQ3NzQnIGZyb20gIlJYTk9STSIgZGlzcGxheSAnQW50aHJheCBWYWNjaW5lIEFic29yYmVkIChzdWJzdGFuY2UvaW5ncmVkaWVudCknCmNvZGUgIkFudGhyYXggdmFjY2luZSBDVlggY29kZSI6ICcyNCcgZnJvbSAiQ1ZYIiBkaXNwbGF5ICdBbnRocmF4IHZhY2NpbmUnCgovLyBBbGVydCBjb2Rlcwpjb2RlICJEZXZpY2UgY29kZSI6ICc3MDEwMDIwMDcnIGZyb20gIlNOT01FRC1DVCIgZGlzcGxheSAnQ2xpbmljYWwgZGF0YSBjb2xsZWN0aW9uL21hbmFnZW1lbnQgaW5mb3JtYXRpb24gc3lzdGVtIGFwcGxpY2F0aW9uIHNvZnR3YXJlIChwaHlzaWNhbCBvYmplY3QpJwpjb2RlICJEb2N1bWVudCBzaWducyBhbmQgc3ltcHRvbXMgY29kZSI6ICcyMjM0NDcwMDgnIGZyb20gIlNOT01FRC1DVCIgZGlzcGxheSAnUmVjb21tZW5kYXRpb24gdG8gZG9jdW1lbnQgc2lnbnMgYW5kIHN5bXB0b21zIChwcm9jZWR1cmUpJwpjb2RlICJNZWRpY2F0aW9uIHJldmlldyBjb2RlIjogJzMxNDUyOTAwNycgZnJvbSAiU05PTUVELUNUIiBkaXNwbGF5ICdNZWRpY2F0aW9uIHJldmlldyBkdWUgKHNpdHVhdGlvbiknCmNvZGUgIk5vdCBlcXVpdmFsZW50IGFsZXJ0IGNvZGUiOiAnTk9URVFVSVYnIGZyb20gIkFDVENPREUiIGRpc3BsYXkgJ05vdCBlcXVpdmFsZW50IGFsZXJ0Jwpjb2RlICJUaW1pbmcgZGV0ZWN0ZWQgaXNzdWUgY29kZSI6ICdUSU1FJyBmcm9tICJBQ1RDT0RFIiBkaXNwbGF5ICdUaW1pbmcgZGV0ZWN0ZWQgaXNzdWUnCmNvZGUgIlZlcmlmeSBhbGxlcmd5IHN0YXR1cyBjb2RlIjogJzM3MDg2MDAwNycgZnJvbSAiU05PTUVELUNUIiBkaXNwbGF5ICdWZXJpZmljYXRpb24gb2YgYWxsZXJneSBzdGF0dXMgKHByb2NlZHVyZSknCgovLyBPcmRlciBzZXQgY29kZXMKY29kZSAiRkhJUiBBY3Rpb25UeXBlIGNyZWF0ZSBjb2RlIjogJ2NyZWF0ZScgZnJvbSAiRkhJUi1BQ1RJT04tVFlQRSIgZGlzcGxheSAnQ3JlYXRlJwpjb2RlICJGSElSIFBsYW5EZWZpbml0aW9uIGVjYS1ydWxlIGNvZGUiOiAnZWNhLXJ1bGUnIGZyb20gIkZISVItUExBTkRFRklOSVRJT04tVFlQRSIgZGlzcGxheSAnRUNBIFJ1bGUnCmNvZGUgIkZISVIgUGxhbkRlZmluaXRpb24gb3JkZXItc2V0IGNvZGUiOiAnb3JkZXItc2V0JyBmcm9tICJGSElSLVBMQU5ERUZJTklUSU9OLVRZUEUiIGRpc3BsYXkgJ09yZGVyIFNldCcKY29kZSAiRkhJUiBhZ2UgcmFuZ2UgdXNhZ2UgY29udGV4dCBjb2RlIjogJ2FnZScgZnJvbSAiRkhJUi1VU0FHRS1DT05URVhULVRZUEUiIGRpc3BsYXkgJ0FnZSBSYW5nZScKY29kZSAiRkhJUiBjbGluaWNhbCBmb2N1cyB1c2FnZSBjb250ZXh0IGNvZGUiOiAnZm9jdXMnIGZyb20gIkZISVItVVNBR0UtQ09OVEVYVC1UWVBFIiBkaXNwbGF5ICdDbGluaWNhbCBGb2N1cycKY29kZSAiRkhJUiBjbGluaWNhbCB2ZW51ZSB1c2FnZSBjb250ZXh0IGNvZGUiOiAndmVudWUnIGZyb20gIkZISVItVVNBR0UtQ09OVEVYVC1UWVBFIiBkaXNwbGF5ICdDbGluaWNhbCBWZW51ZScKY29kZSAiU05PTUVEIG91dHBhdGllbnQgY29kZSI6ICc0NDA2NTUwMDAnIGZyb20gIlNOT01FRC1DVCIgZGlzcGxheSAnT3V0cGF0aWVudCBlbnZpcm9ubWVudCcKY29kZSAiVW5pdGVkIFN0YXRlcyBjb2RlIjogJ1VTJyBmcm9tICJJU08tMzE2Ni1DT1VOVFJZLUNPREVTIiBkaXNwbGF5ICdVbml0ZWQgU3RhdGVzIG9mIEFtZXJpY2EnCmNvZGUgIk9yYWwgcm91dGUgY29kZSI6ICcyNjY0MzAwNicgZnJvbSAiU05PTUVELUNUIiBkaXNwbGF5ICdPcmFsIFJvdXRlJwpjb2RlICJTd2FsbG93IGRvc2luZyBpbnN0cnVjdGlvbiBjb2RlIjogJzQyMTUyMTAwOScgZnJvbSAiU05PTUVELUNUIiBkaXNwbGF5ICdTd2FsbG93IC0gZG9zaW5nIGluc3RydWN0aW9uIGltcGVyYXRpdmUgKHF1YWxpZmllciB2YWx1ZSknCmNvZGUgIlN1YmN1dGFuZW91cyByb3V0ZSBjb2RlIjogJzM0MjA2MDA1JyBmcm9tICJTTk9NRUQtQ1QiIGRpc3BsYXkgJ1N1YmN1dGFuZW91cyByb3V0ZScKCi8vIC0tLS0tLS0tLS0tLS0gQ09OQ0VQVFMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIEV4cG9zdXJlIGlzIHJlcHJlc2VudGVkIGJ5IHR3byBjb2Rlcywgb25lIGZyb20gSUNEMTAgb25lIGZyb20gU05PTUVELUNULgpjb25jZXB0ICJBbnRocmF4IGV4cG9zdXJlIjogeyAiRXhwb3N1cmUgdG8gQW50aHJheCBjb2RlIiwgIkV4cG9zdXJlIHRvIEJhY2lsbHVzIGFudGhyYWNpcyAoZXZlbnQpIGNvZGUiIH0gZGlzcGxheSAnQW50aHJheCBleHBvc3VyZScKCi8vIEFzeW1wdG9tYXRpYyBpcyByZXByZXNlbnRlZCBieSBhIHNpbmdsZSBTTk9NRUQtQ1QgY29kZS4KY29uY2VwdCAiQXN5bXB0b21hdGljQ29uY2VwdCI6IHsgIkFzeW1wdG9tYXRpYyBjb2RlIiB9IGRpc3BsYXkgJ0FzeW1wdG9tYXRpYycKY29uY2VwdCAiQW50aHJheCB2YWNjaW5lIjogeyAiQW50aHJheCB2YWNjaW5lIHN1YnN0YW5jZSBjb2RlIiwgIkFudGhyYXggdmFjY2luZSBDVlggY29kZSJ9IGRpc3BsYXkgJ0FudGhyYXggdmFjY2luZScKCi8vIFByZWduYW5jeSBjYW4gYmUgcmVwcmVzZW50ZWQgYXMgYSBzdGF0dXMsIGFuIG9ic2VydmF0aW9uLCBvciBhIGNvbmRpdGlvbiAoc2VlIHZhbHVlc2V0IGFib3ZlKS4KY29uY2VwdCAiUHJlZ25hbmN5IHN0YXR1cyI6IHsgIlByZWduYW5jeSBzdGF0dXMgY29kZSIgfSBkaXNwbGF5ICdQcmVnbmFuY3kgc3RhdHVzJwpjb25jZXB0ICJQcmVnbmFudCI6IHsgIlByZWduYW50IGNvZGUiIH0gZGlzcGxheSAnUGF0aWVudCBjdXJyZW50bHkgcHJlZ25hbnQgKGZpbmRpbmcpJwoKLy8gLS0tLS0tLS0tLS0tLSBQQVJBTUVURVJTIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gTG9va2JhY2sgcGVyaW9kIGZvciBkZWZpbmluZyAicmVjZW50IiBleHBvc3VyZSAoZGVmYXVsdDogNjAgZGF5cykuCnBhcmFtZXRlciBFeHBvc3VyZV9Mb29rX0JhY2tfUGVyaW9kIGRlZmF1bHQgNjAgZGF5cwoKLy8gUmVjb21tZW5kZWQgc3BhY2luZyBiZXR3ZWVuIHZhY2NjaW5lIGRvc2VzCnBhcmFtZXRlciBTcGFjaW5nX0JldHdlZW5fVmFjY2luZV9Eb3NlcyBkZWZhdWx0IDIgd2Vla3MKCi8vIC0tLS0tLS0tLS0tLS0gUEFUSUVOVCBDT05URVhUIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmNvbnRleHQgUGF0aWVudAoKLy8gVmVyc2lvbiBvZiB0aGlzIENRTApkZWZpbmUgQ3FsVmVyc2lvbjogJzEuMS4wJwoKLy8gLS0tLS0tLS0tLS0tLSBJTkNMVVNJT05TICYgRVhDTFVTSU9OUyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gTXVzdCBiZSAxOCB5ZWFycyBvciBvbGRlci4KZGVmaW5lIElzMThvck9sZGVyOgogIEFnZUluWWVhcnMoKSA+PSAxOAoKLy8gLS0tLS0tLS0tLS0tLSBBTlRIUkFYIEVYUE9TVVJFIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLyogRXhwb3N1cmUgdG8gQW50aHJheCBjYW4gYmUgcmVwcmVzZW50ZWQgYXMgZWl0aGVyIGEgQ29uZGl0aW9uIG9yIGFuIE9ic2VydmF0aW9uCnJlc291cmNlLiBXZSBuZWVkIHRvIGxvb2sgZm9yIHJlY2VudCAoPD0gRXhwb3N1cmVfTG9va19CYWNrX1BlcmlvZCkgaW5kaWNhdGlvbnMKb2YgZXhwb3N1cmUgaW4gb3JkZXIgdG8gZGVjaWRlIGlmIHRoZSBwYXRpZW50IG5lZWRzIHRvIGJlIHRyZWF0ZWQgd2l0aCBQRVAuIFNlZQpBc3N1bXB0aW9uIDEuICovCgovLyBDb25maXJtZWQsIHJlY2VudCAoPD0gRXhwb3N1cmVfTG9va19CYWNrX1BlcmlvZCksIGFuZCBhY3RpdmUgb3IgcmVjdXJyaW5nIENvbmRpdGlvbnMuCmRlZmluZSBSZWNlbnRBbnRocmF4RXhwb3N1cmVDb25kaXRpb25zOgogIEMzRi5Db25maXJtZWQoQzNGLkNvbmRpdGlvbkxvb2tCYWNrKEMzRi5BY3RpdmVPclJlY3VycmluZyhbQ29uZGl0aW9uOiAiQW50aHJheCBleHBvc3VyZSJdKSwgRXhwb3N1cmVfTG9va19CYWNrX1BlcmlvZCkpCgovLyBUaGUgbW9zdCByZWNlbnQgZXhwb3N1cmUgQ29uZGl0aW9uIGZyb20gd2l0aGluIHRoZSBleHBvc3VyZSBsb29rYmFjayBwZXJpb2QuCmRlZmluZSBNb3N0UmVjZW50QW50aHJheEV4cG9zdXJlQ29uZGl0aW9uOgogIChDQ0wuTW9zdFJlY2VudENvbmRpdGlvbihSZWNlbnRBbnRocmF4RXhwb3N1cmVDb25kaXRpb25zKSkgQwogIHJldHVybiB7CiAgICBUeXBlOiAnQ29uZGl0aW9uJywKICAgIElkOiBDLmlkLnZhbHVlLAogICAgRGF0ZTogQ0NMLkZpbmRDb25kaXRpb25EYXRlKEMpCiAgfQoKLy8gVmVyaWZpZWQgYW5kIHJlY2VudCAoPD0gRXhwb3N1cmVfTG9va19CYWNrX1BlcmlvZCkgT2JzZXJ2YXRpb25zLgpkZWZpbmUgUmVjZW50QW50aHJheEV4cG9zdXJlT2JzZXJ2YXRpb25zOgogIEMzRi5WZXJpZmllZChDM0YuT2JzZXJ2YXRpb25Mb29rQmFjayhbT2JzZXJ2YXRpb246ICJBbnRocmF4IGV4cG9zdXJlIl0sIEV4cG9zdXJlX0xvb2tfQmFja19QZXJpb2QpKQoKLy8gVGhlIG1vc3QgcmVjZW50IGV4cG9zdXJlIE9ic2VydmF0aW9uLgpkZWZpbmUgTW9zdFJlY2VudEFudGhyYXhFeHBvc3VyZU9ic2VydmF0aW9uOgogIChDM0YuTW9zdFJlY2VudChSZWNlbnRBbnRocmF4RXhwb3N1cmVPYnNlcnZhdGlvbnMpKSBPCiAgcmV0dXJuIHsKICAgIFR5cGU6ICdPYnNlcnZhdGlvbicsCiAgICBJZDogTy5pZC52YWx1ZSwKICAgIERhdGU6IEMzRi5GaW5kRGF0ZShPKQogIH0KCi8vIEZvcm0gdGhlIHVuaW9uIG9mIGFsbCB0aGUgcmVzb3VyY2VzIHRoYXQgY291bGQgYmUgdXNlZCB0byBpbmRpY2F0ZSBleHBvc3VyZS4KZGVmaW5lIFJlY2VudEFudGhyYXhFeHBvc3VyZVJlc291cmNlczoKICAoIE1vc3RSZWNlbnRBbnRocmF4RXhwb3N1cmVDb25kaXRpb24gdW5pb24gTW9zdFJlY2VudEFudGhyYXhFeHBvc3VyZU9ic2VydmF0aW9uICkgTAogIHdoZXJlIEwuRGF0ZSBpcyBub3QgbnVsbAogIHNvcnQgYnkgRGF0ZSBkZXNjCgovLyBEZXRlcm1pbmUgaWYgdGhlcmUgaXMgYSByZWNlbnQgKDw9IEV4cG9zdXJlX0xvb2tfQmFja19QZXJpb2QpIGV4cG9zdXJlIHRvIEFudGhyYXguCmRlZmluZSBSZWNlbnRseUV4cG9zZWRUb0FudGhyYXg6CiAgZXhpc3RzKFJlY2VudEFudGhyYXhFeHBvc3VyZVJlc291cmNlcykKCi8vIFRoZSBtb3N0IHJlY2VudCAoPD0gRXhwb3N1cmVfTG9va19CYWNrX1BlcmlvZCkgZXhwb3N1cmUgcmVzb3VyY2UuCmRlZmluZSBNb3N0UmVjZW50QW50aHJheEV4cG9zdXJlUmVzb3VyY2U6CiAgQ29hbGVzY2UoUmVjZW50QW50aHJheEV4cG9zdXJlUmVzb3VyY2VzKQoKLy8gRGF0ZSBvZiBtb3N0IHJlY2VudCAoPD0gRXhwb3N1cmVfTG9va19CYWNrX1BlcmlvZCkgZXhwb3N1cmUuCmRlZmluZSBNb3N0UmVjZW50QW50aHJheEV4cG9zdXJlRGF0ZToKICBNb3N0UmVjZW50QW50aHJheEV4cG9zdXJlUmVzb3VyY2UuRGF0ZQoKLy8gLS0tLS0tLS0tLS0tLSBBU1lNUFRPTUFUSUMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLyogQXN5bXB0b21hdGljIG11c3QgYmUgcmVwcmVzZW50ZWQgYXMgYW4gT2JzZXJ2YXRpb24gcmVzb3VyY2UuIEluIG9yZGVyIGZvciBhIHBhdGllbnQKdG8gYmUgZGV0ZXJtaW5lZCB0byBiZSBhc3ltcHRvbWF0aWMsIHRoZSBhc3ltcHRvbWF0aWMgT2JzZXJ2YXRpb24gbXVzdCBvY2N1ciBvbgpvciBhZnRlciB0aGUgZGF0ZSBvZiBleHBvc3VyZS4gU2VlIEFzc3VtcHRpb24gMi4gKi8KCi8vIENoZWNrIGZvciByZWNlbnQgYW5kIHZlcmlmaWVkIE9ic2VydmF0aW9ucyB0aGF0IHBhdGllbnQgaXMgYXN5bXB0b21hdGljLgpkZWZpbmUgUmVjZW50QXN5bXB0b21hdGljT2JzZXJ2YXRpb25zOgogIEMzRi5WZXJpZmllZChDM0YuT2JzZXJ2YXRpb25Mb29rQmFjayhbT2JzZXJ2YXRpb246ICJBc3ltcHRvbWF0aWNDb25jZXB0Il0sIEV4cG9zdXJlX0xvb2tfQmFja19QZXJpb2QpKQoKLy8gTW9zdCByZWNlbnQgKDw9IEV4cG9zdXJlX0xvb2tfQmFja19QZXJpb2QpIGFzeW1wdG9tYXRpYyBPYnNlcnZhdGlvbi4KZGVmaW5lIE1vc3RSZWNlbnRBc3ltcHRvbWF0aWNPYnNlcnZhdGlvbjoKICBDM0YuTW9zdFJlY2VudChSZWNlbnRBc3ltcHRvbWF0aWNPYnNlcnZhdGlvbnMpCgovLyBEYXRlIG9mIHRoZSBtb3N0IHJlY2VudCAoPD0gRXhwb3N1cmVfTG9va19CYWNrX1BlcmlvZCkgYXN5bXB0b21hdGljIE9ic2VydmF0aW9uLgpkZWZpbmUgTW9zdFJlY2VudEFzeW1wdG9tYXRpY09ic2VydmF0aW9uRGF0ZToKICBDM0YuRmluZERhdGUoTW9zdFJlY2VudEFzeW1wdG9tYXRpY09ic2VydmF0aW9uKQoKLy8gRGV0ZXJtaW5lIGlmIHRoZSBwYXRpZW50IGlzIGFzeW1wdG9tYXRpYywgY2hlY2tpbmcgdG8gZW5zdXJlIGFzeW1wdG9tYXRpYyBvYnNlcnZhdGlvbgovLyBvY2N1cnMgKiphZnRlcioqIGV4cG9zdXJlLgpkZWZpbmUgQXN5bXB0b21hdGljOgogIE1vc3RSZWNlbnRBc3ltcHRvbWF0aWNPYnNlcnZhdGlvbkRhdGUgaXMgbm90IG51bGwgYW5kCiAgTW9zdFJlY2VudEFzeW1wdG9tYXRpY09ic2VydmF0aW9uRGF0ZSBzYW1lIGRheSBvciBhZnRlciBNb3N0UmVjZW50QW50aHJheEV4cG9zdXJlRGF0ZQoKLy8gLS0tLS0tLS0tLS0tLSBQUkVHTkFOQ1kgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLyogUHJlZ25hbmN5IGNhbiBiZSByZXByZXNlbnRlZCBhcyBhbiBPYnNlcnZhdGlvbiBvciBhIENvbmRpdGlvbi4gQm90aCB0eXBlcyBvZgpyZXNvdWNlcyBhcmUgZXhhbWluZWQgdG8gZGV0ZXJtaW5lIGlmIHRoZSBwYXRpZW50IGlzIHByZWduYW50LiAqLwoKLy8gQ29uZmlybWVkLCBhY3RpdmUgb3IgcmVjdXJyaW5nLCBDb25kaXRpb25zIGZyb20gdGhlIGxhc3QgNDIgd2Vla3MgaW5kaWNhdGluZyBwcmVnbmFuY3kuCmRlZmluZSBQcmVnbmFuY3lDb25kaXRpb25zOgogIEMzRi5Db25maXJtZWQoQzNGLkNvbmRpdGlvbkxvb2tCYWNrKEMzRi5BY3RpdmVPclJlY3VycmluZyhbQ29uZGl0aW9uOiAiUHJlZ25hbmN5Il0pLCA0MiB3ZWVrcykpCgovLyBWZXJpZmllZCBPYnNlcnZhdGlvbnMgb24gcHJlZ25hbmN5IHN0YXR1cyBmcm9tIHRoZSBsYXN0IDQyIHdlZWtzLgpkZWZpbmUgUHJlZ25hbmN5T2JzZXJ2YXRpb25zOgogIEMzRi5WZXJpZmllZChDM0YuT2JzZXJ2YXRpb25Mb29rQmFjayhbT2JzZXJ2YXRpb246ICJQcmVnbmFuY3kgc3RhdHVzIl0sIDQyIHdlZWtzKSkKCi8vIFRoZSBtb3N0IHJlY2VudCBwcmVnbmFuY3kgT2JzZXJ2YXRpb24gZnJvbSB0aGUgbGFzdCA0MiB3ZWVrcy4KZGVmaW5lIE1vc3RSZWNlbnRQcmVnbmFuY3lPYnNlcnZhdGlvbjoKICBDM0YuTW9zdFJlY2VudChQcmVnbmFuY3lPYnNlcnZhdGlvbnMpCgovLyBCb29sZWFuIGluZGljYXRpbmcgd2hldGhlciB0aGUgbW9zdCByZWNlbnQgcHJlZ25hbmN5IE9ic2VydmF0aW9uIGluIHRoZSBwYXN0Ci8vIDQyIHdlZWtzIGluZGljYXRlcyBhIHByZWduYW5jeS4KZGVmaW5lIE1vc3RSZWNlbnRQcmVnbmFuY3lPYnNlcnZhdGlvbklzUG9zaXRpdmU6CiAgQzNGLkNvbmNlcHRWYWx1ZShNb3N0UmVjZW50UHJlZ25hbmN5T2JzZXJ2YXRpb24pIH4gIlByZWduYW50IgoKLy8gUHJlZ25hbmN5IHN0YXR1cyBpcyBkZWZpbmVkIGJ5IGVpdGhlciBhIGNvbmZpcm1lZCwgYWN0aXZlIG9yIHJlY3VycmluZywgYW5kIHJlY2VudAovLyAoPCA0MiB3ZWVrcykgcHJlZ25hbmN5IENvbmRpdGlvbiwgb3IgYSB2ZXJpZmllZCBwcmVnbmFuY3kgT2JzZXJ2YXRpb24gd2l0aGluIHRoZQovLyB0aGUgcGFzdCA0MiB3ZWVrcyBpbmRpY2F0aW5nIGEgcHJlZ25hbmN5CmRlZmluZSBJc1ByZWduYW50OgogIGV4aXN0cyhQcmVnbmFuY3lDb25kaXRpb25zKQogIG9yIE1vc3RSZWNlbnRQcmVnbmFuY3lPYnNlcnZhdGlvbklzUG9zaXRpdmUKCi8vIC0tLS0tLS0tLS0tLS0gRVhJU1RJTkcgUEVQIFRSRUFUTUVOVFMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgovLyBDaGVjayBwYXRpZW50IHJlY29yZCBmb3IgY3VycmVudCBSeCBvZiBhbnkgb2YgdGhlIHJlY29tbWVuZGVkIGFudGltaWNyb2JpYWxzLgovLyBOZWVkIHRvIGV4bWFpbmUgYm90aCBNZWRpY2F0aW9uUmVxdWVzdCBhbmQgTWVkaWNhdGlvblN0YXRlbWVudCByZXNvdXJjZXMuCgovLyBBY3RpdmUgTWVkaWNhdGlvblJlcXVlc3RzIGZvciBhbnkgb2YgdGhlIHJlY29tbWVuZGVkIGFudGltaWNyb2JpYWxzLgpkZWZpbmUgQWN0aXZlQ2lwcm9mbG94YWNpblJlcXVlc3RzOgogIEMzRi5BY3RpdmVNZWRpY2F0aW9uUmVxdWVzdChbTWVkaWNhdGlvblJlcXVlc3Q6ICJDaXByb2Zsb3hhY2luIG1lZGljYXRpb25zIl0pCgpkZWZpbmUgQWN0aXZlRG94eWN5Y2xpbmVSZXF1ZXN0czoKICBDM0YuQWN0aXZlTWVkaWNhdGlvblJlcXVlc3QoW01lZGljYXRpb25SZXF1ZXN0OiAiRG94eWN5Y2xpbmUgbWVkaWNhdGlvbnMiXSkKCmRlZmluZSBBY3RpdmVMZXZvZmxveGFjaW5SZXF1ZXN0czoKICBDM0YuQWN0aXZlTWVkaWNhdGlvblJlcXVlc3QoW01lZGljYXRpb25SZXF1ZXN0OiAiTGV2b2Zsb3hhY2luIG1lZGljYXRpb25zIl0pCgpkZWZpbmUgQWN0aXZlTW94aWZsb3hhY2luUmVxdWVzdHM6CiAgQzNGLkFjdGl2ZU1lZGljYXRpb25SZXF1ZXN0KFtNZWRpY2F0aW9uUmVxdWVzdDogIk1veGlmbG94YWNpbiBtZWRpY2F0aW9ucyJdKQoKZGVmaW5lIEFjdGl2ZUNsaW5kYW15Y2luUmVxdWVzdHM6CiAgQzNGLkFjdGl2ZU1lZGljYXRpb25SZXF1ZXN0KFtNZWRpY2F0aW9uUmVxdWVzdDogIkNsaW5kYW15Y2luIG1lZGljYXRpb25zIl0pCgpkZWZpbmUgQWN0aXZlQW50aW1pY3JvYmlhbE1lZGljYXRpb25SZXF1ZXN0czoKICBBY3RpdmVDaXByb2Zsb3hhY2luUmVxdWVzdHMKICB1bmlvbiBBY3RpdmVEb3h5Y3ljbGluZVJlcXVlc3RzCiAgdW5pb24gQWN0aXZlTGV2b2Zsb3hhY2luUmVxdWVzdHMKICB1bmlvbiBBY3RpdmVNb3hpZmxveGFjaW5SZXF1ZXN0cwogIHVuaW9uIEFjdGl2ZUNsaW5kYW15Y2luUmVxdWVzdHMKCi8vIEFjdGl2ZSBNZWRpY2F0aW9uU3RhdGVtZW50cyBmb3IgYW55IG9mIHRoZSByZWNvbW1lbmRlZCBhbnRpbWljcm9iaWFscy4KZGVmaW5lIEFjdGl2ZUNpcHJvZmxveGFjaW5TdGF0ZW1lbnRzOgogIEMzRi5BY3RpdmVNZWRpY2F0aW9uU3RhdGVtZW50KFtNZWRpY2F0aW9uU3RhdGVtZW50OiAiQ2lwcm9mbG94YWNpbiBtZWRpY2F0aW9ucyJdKQoKZGVmaW5lIEFjdGl2ZURveHljeWNsaW5lU3RhdGVtZW50czoKICBDM0YuQWN0aXZlTWVkaWNhdGlvblN0YXRlbWVudChbTWVkaWNhdGlvblN0YXRlbWVudDogIkRveHljeWNsaW5lIG1lZGljYXRpb25zIl0pCgpkZWZpbmUgQWN0aXZlTGV2b2Zsb3hhY2luU3RhdGVtZW50czoKICBDM0YuQWN0aXZlTWVkaWNhdGlvblN0YXRlbWVudChbTWVkaWNhdGlvblN0YXRlbWVudDogIkxldm9mbG94YWNpbiBtZWRpY2F0aW9ucyJdKQoKZGVmaW5lIEFjdGl2ZU1veGlmbG94YWNpblN0YXRlbWVudHM6CiAgQzNGLkFjdGl2ZU1lZGljYXRpb25TdGF0ZW1lbnQoW01lZGljYXRpb25TdGF0ZW1lbnQ6ICJNb3hpZmxveGFjaW4gbWVkaWNhdGlvbnMiXSkKCmRlZmluZSBBY3RpdmVDbGluZGFteWNpblN0YXRlbWVudHM6CiAgQzNGLkFjdGl2ZU1lZGljYXRpb25TdGF0ZW1lbnQoW01lZGljYXRpb25TdGF0ZW1lbnQ6ICJDbGluZGFteWNpbiBtZWRpY2F0aW9ucyJdKQoKZGVmaW5lIEFjdGl2ZUFudGltaWNyb2JpYWxNZWRpY2F0aW9uU3RhdGVtZW50czoKICBBY3RpdmVDaXByb2Zsb3hhY2luU3RhdGVtZW50cwogIHVuaW9uIEFjdGl2ZURveHljeWNsaW5lU3RhdGVtZW50cwogIHVuaW9uIEFjdGl2ZUxldm9mbG94YWNpblN0YXRlbWVudHMKICB1bmlvbiBBY3RpdmVNb3hpZmxveGFjaW5TdGF0ZW1lbnRzCiAgdW5pb24gQWN0aXZlQ2xpbmRhbXljaW5TdGF0ZW1lbnRzCgovLyBOZWVkIHRvIGtlZXAgdHJhY2sgb2YgdGhlIHNwZWNpZmljcyBvZiB3aGljaCBvZiB0aGUgYW50aW1pY3JvYmlhbHMgaGF2ZSBhY3RpdmUgUnguCmRlZmluZSBIYXNDaXByb2Zsb3hhY2luUng6CiAgZXhpc3RzKEFjdGl2ZUNpcHJvZmxveGFjaW5SZXF1ZXN0cykgb3IgZXhpc3RzKEFjdGl2ZUNpcHJvZmxveGFjaW5TdGF0ZW1lbnRzKQoKZGVmaW5lIEhhc0RveHljeWNsaW5lUng6CiAgZXhpc3RzKEFjdGl2ZURveHljeWNsaW5lUmVxdWVzdHMpIG9yIGV4aXN0cyhBY3RpdmVEb3h5Y3ljbGluZVN0YXRlbWVudHMpCgpkZWZpbmUgSGFzTGV2b2Zsb3hhY2luUng6CiAgZXhpc3RzKEFjdGl2ZUxldm9mbG94YWNpblJlcXVlc3RzKSBvciBleGlzdHMoQWN0aXZlTGV2b2Zsb3hhY2luU3RhdGVtZW50cykKCmRlZmluZSBIYXNNb3hpZmxveGFjaW5SeDoKICBleGlzdHMoQWN0aXZlTW94aWZsb3hhY2luUmVxdWVzdHMpIG9yIGV4aXN0cyhBY3RpdmVNb3hpZmxveGFjaW5TdGF0ZW1lbnRzKQoKZGVmaW5lIEhhc0NsaW5kYW15Y2luUng6CiAgZXhpc3RzKEFjdGl2ZUNsaW5kYW15Y2luUmVxdWVzdHMpIG9yIGV4aXN0cyhBY3RpdmVDbGluZGFteWNpblN0YXRlbWVudHMpCgovLyBGb3JtYXQgYW5kIHNvcnQgdGhlIGFudGltaWNyb2JpYWwgTWVkaWNhdGlvblJlcXVlc3QgbGlzdC4KZGVmaW5lIEZvcm1hdHRlZEFudGltaWNyb2JpYWxNZWRpY2F0aW9uUmVxdWVzdHM6CiAgKEFjdGl2ZUFudGltaWNyb2JpYWxNZWRpY2F0aW9uUmVxdWVzdHMpIE8KICByZXR1cm4gewogICAgVHlwZTogICdNZWRpY2F0aW9uUmVxdWVzdCcsCiAgICBJZDogTy5pZC52YWx1ZSwKICAgIERhdGU6IENDTC5EYXRlVGltZVRleHQoTy5hdXRob3JlZE9uKQogIH0KICBzb3J0IGJ5IERhdGUgZGVzYwoKLy8gRm9ybWF0IGFuZCBzb3J0IHRoZSBhbnRpbWljcm9iaWFsIE1lZGljYXRpb25TdGF0ZW1lbnQgbGlzdC4KZGVmaW5lIEZvcm1hdHRlZEFudGltaWNyb2JpYWxNZWRpY2F0aW9uU3RhdGVtZW50czoKICAoQWN0aXZlQW50aW1pY3JvYmlhbE1lZGljYXRpb25TdGF0ZW1lbnRzKSBTCiAgcmV0dXJuIHsKICAgIFR5cGU6ICAnTWVkaWNhdGlvblN0YXRlbWVudCcsCiAgICBJZDogUy5pZC52YWx1ZSwKICAgIERhdGU6IENDTC5NZWRpY2F0aW9uU3RhdGVtZW50RGF0ZShTKQogIH0KICBzb3J0IGJ5IERhdGUgZGVzYwoKLy8gQ29tYmluZSB0aGUgZm9ybWF0dGVkIE1lZGljYXRpb25SZXF1ZXN0IGFuZCBNZWRpY2F0aW9uU3RhdGVtZW50IGxpc3RzLgpkZWZpbmUgRm9ybWF0dGVkQW50aW1pY3JvYmlhbE1lZGljYXRpb25SZXNvdXJjZXM6CiAgKEZvcm1hdHRlZEFudGltaWNyb2JpYWxNZWRpY2F0aW9uUmVxdWVzdHMKICAgIHVuaW9uIEZvcm1hdHRlZEFudGltaWNyb2JpYWxNZWRpY2F0aW9uU3RhdGVtZW50cykgTQogIHNvcnQgYnkgRGF0ZSBkZXNjCgovLyBCb29sZWFuIGluZGljYXRpbmcgd2hldGhlciBwYXRpZW50IGhhcyBhbiBleGlzaXRpbmcgYW50aW1pY3JvYmlhbCBSeC4KZGVmaW5lIEhhc0V4aXN0aW5nQW50aW1pY3JvYmlhbFJ4OgogIGV4aXN0cyhGb3JtYXR0ZWRBbnRpbWljcm9iaWFsTWVkaWNhdGlvblJlc291cmNlcykKCi8vIENoZWNrIHBhdGllbnQgcmVjb3JkIGZvciBhbnkgcmVjZW50IGRvc2VzIG9mIHRoZSB2YWNjaW5lLgovLyBFYWNoIGRvc2UgaW4gdGhlIHZhY2NpbmUgc2VxdWVuY2UgaGFzIGl0cyBvd24gU05PTUVELUNUIHByb2NlZHVyZSBjb2RlLgoKLy8gTG9vayBmb3IgY29tcGxldGVkIFByb2R1cmVzIGZvciBhZG1pbmlzdGVyaW5nIHRoZSBmaXJzdCBkb3NlLgpkZWZpbmUgUHJvY2VkdXJlc0ZvckZpcnN0VmFjY2luZURvc2U6CiAgQzNGLkNvbXBsZXRlZChbUHJvY2VkdXJlOiAiRmlyc3QgYW50aHJheCB2YWNjaW5hdGlvbiBjb2RlIl0pCgovLyBMb29rIGZvciBjb21wbGV0ZWQgUHJvZHVyZXMgZm9yIGFkbWluaXN0ZXJpbmcgdGhlIHNlY29uZCBkb3NlLgpkZWZpbmUgUHJvY2VkdXJlc0ZvclNlY29uZFZhY2NpbmVEb3NlOgogIEMzRi5Db21wbGV0ZWQoW1Byb2NlZHVyZTogIlNlY29uZCBhbnRocmF4IHZhY2NpbmF0aW9uIGNvZGUiXSkKCi8vIExvb2sgZm9yIGNvbXBsZXRlZCBQcm9kdXJlcyBmb3IgYWRtaW5pc3RlcmluZyB0aGUgdGhpcmQgZG9zZS4KZGVmaW5lIFByb2NlZHVyZXNGb3JUaGlyZFZhY2NpbmVEb3NlOgogIEMzRi5Db21wbGV0ZWQoW1Byb2NlZHVyZTogIlRoaXJkIGFudGhyYXggdmFjY2luYXRpb24gY29kZSJdKQoKLy8gTG9vayBmb3IgY29tcGxldGVkIFByb2R1cmVzIGZvciBhZG1pbmlzdGVyaW5nIHRoZSBmb3VydGggZG9zZS4KZGVmaW5lIFByb2NlZHVyZXNGb3JGb3VydGhWYWNjaW5lRG9zZToKICBDM0YuQ29tcGxldGVkKFtQcm9jZWR1cmU6ICJGb3VydGggYW50aHJheCB2YWNjaW5hdGlvbiBjb2RlIl0pCgovLyAtLS0tLS0tLS0tLS0tIFZBQ0NJTkUgTE9HSUMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovKiBIb3cgbWFueSBkb3NlcyBoYXMgdGhlIHBhdGllbnQgaGFkPyBDYXNlcyBvZiBpbnRlcmVzdCB0byB0aGUgbG9naWMgYXJlOgotIDAgZG9zZXMKLSAxLTIgZG9zZXMKLSA+PTMgZG9zZXMKKi8KCi8vIEhhcyB0aGUgcGF0aWVudCBoYWQgdGhlIGZpcnN0IGRvc2UgYWRtaW5pc3RlcmVkPwpkZWZpbmUgSGFzRmlyc3RWYWNjaW5lRG9zZToKICBleGlzdHMoUHJvY2VkdXJlc0ZvckZpcnN0VmFjY2luZURvc2UpCgovLyBIYXMgdGhlIHBhdGllbnQgaGFkIHRoZSBzZWNvbmQgZG9zZSBhZG1pbmlzdGVyZWQ/CmRlZmluZSBIYXNTZWNvbmRWYWNjaW5lRG9zZToKICBleGlzdHMoUHJvY2VkdXJlc0ZvclNlY29uZFZhY2NpbmVEb3NlKQoKLy8gSGFzIHRoZSBwYXRpZW50IGhhZCB0aGUgdGhpcmQgZG9zZSBhZG1pbmlzdGVyZWQ/CmRlZmluZSBIYXNUaGlyZFZhY2NpbmVEb3NlOgogIGV4aXN0cyhQcm9jZWR1cmVzRm9yVGhpcmRWYWNjaW5lRG9zZSkKCi8vIEhhcyB0aGUgcGF0aWVudCBoYWQgdGhlIGZvdXJ0aCBkb3NlIGFkbWluaXN0ZXJlZD8KZGVmaW5lIEhhc0ZvdXJ0aFZhY2NpbmVEb3NlOgogIGV4aXN0cyhQcm9jZWR1cmVzRm9yRm91cnRoVmFjY2luZURvc2UpCgovKiBXaGF0IGlzIHRoZSBuZXh0IGRvc2UgaW4gdGhlIHZhY2NpbmUgc2VxdWVuY2UgdGhhdCB0aGUgcGF0aWVudCBzaG91bGQgcmVjZWl2ZT8KTm90ZSB0aGF0IHRoaXMgbG9naWMgaXMgdmVyeSBzdHJpY3QsIGFuZCB3aWxsIG1pc3MgdGhpbmdzIGxpa2Ugbm9uLXNlcXVlbnRpYWwgZG9zaW5nLgpUaGlzIGFuZCBhbm90aGVyIGRhdGEgaW5jb25zaXN0ZW5jeSBpcyBkZXRlY3RlZCBiZWxvdyBhbmQgYWxlcnRlZCBvbiBsYXRlciBvbi4KKi8KZGVmaW5lIE5leHRWYWNjaW5lRG9zZU51bWJlcjoKICBjYXNlCiAgICB3aGVuIG5vdCBIYXNGaXJzdFZhY2NpbmVEb3NlIGFuZCBub3QgSGFzU2Vjb25kVmFjY2luZURvc2UgYW5kIG5vdCBIYXNUaGlyZFZhY2NpbmVEb3NlIGFuZCBub3QgSGFzRm91cnRoVmFjY2luZURvc2UKICAgICAgdGhlbiAxIC8vIFRoZSBuZXh0IGRvc2Ugd2lsbCBiZSB0aGUgZmlyc3QuCiAgICB3aGVuIEhhc0ZpcnN0VmFjY2luZURvc2UgYW5kIG5vdCBIYXNTZWNvbmRWYWNjaW5lRG9zZSBhbmQgbm90IEhhc1RoaXJkVmFjY2luZURvc2UgYW5kIG5vdCBIYXNGb3VydGhWYWNjaW5lRG9zZQogICAgICB0aGVuIDIgLy8gVGhlIG5leHQgZG9zZSB3aWxsIGJlIHRoZSBzZWNvbmQuCiAgICB3aGVuIEhhc0ZpcnN0VmFjY2luZURvc2UgYW5kIEhhc1NlY29uZFZhY2NpbmVEb3NlIGFuZCBub3QgSGFzVGhpcmRWYWNjaW5lRG9zZSBhbmQgbm90IEhhc0ZvdXJ0aFZhY2NpbmVEb3NlCiAgICAgIHRoZW4gMyAvLyBUaGUgbmV4dCBkb2VzIHdpbGwgYmUgdGhpcmQgKGxhc3QpLgogICAgZWxzZSBudWxsIC8vIFRoZXJlIGlzIG5vIGZvdXJ0aCBkb3NlIGZvciBQRVAuCiAgZW5kCgovLyBUaGUgbW9zdCByZWNlbnQgdmFjY2luZSBQcm9jZWR1cmUuCmRlZmluZSBNb3N0UmVjZW50VmFjY2luZVByb2NlZHVyZToKICBjYXNlCiAgICB3aGVuIEhhc0ZvdXJ0aFZhY2NpbmVEb3NlIC8vIFRoZXkgaGF2ZSB0aGVpciBmb3VydGggZG9zZS4KICAgICAgdGhlbiBDQ0wuTW9zdFJlY2VudFByb2NlZHVyZShQcm9jZWR1cmVzRm9yRm91cnRoVmFjY2luZURvc2UpCiAgICB3aGVuIEhhc1RoaXJkVmFjY2luZURvc2UgLy8gVGhleSBoYXZlIHRoZWlyIHRoaXJkIGRvc2UuCiAgICAgIHRoZW4gQ0NMLk1vc3RSZWNlbnRQcm9jZWR1cmUoUHJvY2VkdXJlc0ZvclRoaXJkVmFjY2luZURvc2UpCiAgICB3aGVuIEhhc1NlY29uZFZhY2NpbmVEb3NlIC8vIFRoZXkgaGF2ZSB0aGVpciBzZWNvbmQgZG9zZS4KICAgICAgdGhlbiBDQ0wuTW9zdFJlY2VudFByb2NlZHVyZShQcm9jZWR1cmVzRm9yU2Vjb25kVmFjY2luZURvc2UpCiAgICB3aGVuIEhhc0ZpcnN0VmFjY2luZURvc2UgLy8gVGhleSBoYXZlIGZpcnN0IGRvc2UuCiAgICAgIHRoZW4gQ0NMLk1vc3RSZWNlbnRQcm9jZWR1cmUoUHJvY2VkdXJlc0ZvckZpcnN0VmFjY2luZURvc2UpCiAgICBlbHNlIG51bGwgLy8gUGF0aWVudCBoYXMgbm90IGhhZCBhIHByZXZpb3VzIGRvc2UuCiAgZW5kCgovLyBXaGVuIHdhcyB0aGUgbGFzdCB2YWNjaW5lIFByb2NlZHVyZT8KZGVmaW5lIERhdGVPZkxhc3RWYWNjaW5lRG9zZToKICBDQ0wuRmluZFByb2NlZHVyZURhdGUoTW9zdFJlY2VudFZhY2NpbmVQcm9jZWR1cmUpCgovKiBIYXMgZW5vdWdoIHRpbWUgZWxhc3BlZCBzaW5jZSB0aGUgbGFzdCB2YWNjaW5lIGRvc2UgdGhhdCB0aGUgbmV4dCBvbmUgY2FuIGJlCmFwcGxpZWQ/ICovCmRlZmluZSBSZWFkeUZvck5leHRWYWNjaW5lRG9zZToKICBpZiAoRGF0ZU9mTGFzdFZhY2NpbmVEb3NlIGlzIG5vdCBudWxsKSB0aGVuCiAgICBpZiAoTmV4dFZhY2NpbmVEb3NlTnVtYmVyIGlzIG5vdCBudWxsKSB0aGVuCiAgICAgIGlmIChTcGFjaW5nX0JldHdlZW5fVmFjY2luZV9Eb3NlcyBpcyBub3QgbnVsbCkgdGhlbgogICAgICAgIGlmIChOZXh0VmFjY2luZURvc2VOdW1iZXIgaW4gezIsM30KICAgICAgICAgIGFuZCAoRGF0ZU9mTGFzdFZhY2NpbmVEb3NlIHNhbWUgZGF5IG9yIGJlZm9yZSAoVG9kYXkoKSAtIFNwYWNpbmdfQmV0d2Vlbl9WYWNjaW5lX0Rvc2VzKSkpIHRoZW4gdHJ1ZQogICAgICAgIGVsc2UgZmFsc2UKICAgICAgZWxzZSBmYWxzZQogICAgZWxzZSBmYWxzZQogIGVsc2UKICAgIGlmIChOZXh0VmFjY2luZURvc2VOdW1iZXIgaXMgbm90IG51bGwpIHRoZW4KICAgICAgaWYgKE5leHRWYWNjaW5lRG9zZU51bWJlciA9IDEpIHRoZW4gdHJ1ZSAvLyBOZWVkIHRoZWlyIGZpcnN0IGRvc2UuCiAgICAgIGVsc2UgZmFsc2UKICAgIGVsc2UgZmFsc2UKCi8qIExvZ2ljIHRvIGRldGVjdCB3aGV0aGVyIG9yIG5vdCB0aGUgbGFzdCB2YWNjaW5lIFByb2NlZHVyZSBpcyBtaXNzaW5nIGEgZGF0ZS4KSWYgdGhpcyBpcyB0aGUgY2FzZSwgdGhlbiB0aGUgYWJvdmUgbG9naWMgd2lsbCBmYWlsLiBTbyBhbiBhbGVydCBpcyBnZW5lcmF0ZWQKbGF0ZXIgb24gdG8gbm90aWZ5IHRoZSBwcm92aWRlciBvZiB0aGlzIHBvdGVudGlhbCBpc3N1ZS4KKi8KZGVmaW5lIExhc3RWYWNjaW5lUHJvY2VkdXJlTWlzc2luZ0RhdGU6CiAgaWYgKE5leHRWYWNjaW5lRG9zZU51bWJlciBpcyBub3QgbnVsbCBhbmQgRGF0ZU9mTGFzdFZhY2NpbmVEb3NlIGlzIG51bGwpIHRoZW4KICAgIGlmIChOZXh0VmFjY2luZURvc2VOdW1iZXIgPSAxKSB0aGVuIGZhbHNlCiAgICBlbHNlIHRydWUKICBlbHNlIGZhbHNlCgovKiBMb2dpYyB0byBkZXRlY3QgbWlzc2luZyBWYWNjaW5lIGRvc2VzLiBBbiBleGFtcGxlIHdvdWxkIGJlIGlmIHRoZSBwYXRpZW50IHJlY29yZApzaG93cyB0aGUgcGF0aWVudCByZWNlaXZpbmcgdGhlIHNlY29uZCB2YWNjaW5lIGRvc2UgYnV0IG5vdCB0aGUgZmlyc3QuIElmIHRoaXMgaXMKdGhlIGNhc2UsIHRoZW4gdGhlIGFib3ZlIGxvZ2ljIHdpbGwgZmFpbC4gU28gYW4gYWxlcnQgaXMgZ2VuZXJhdGVkIGxhdGVyIG9uIHRvIG5vdGlmeQp0aGUgcHJvdmlkZXIgb2YgdGhpcyBwb3RlbnRpYWwgaXNzdWUuCiovCmRlZmluZSBNaXNzaW5nVmFjY2luZURvc2U6CiAgaWYgKE5leHRWYWNjaW5lRG9zZU51bWJlciBpcyBudWxsKSB0aGVuCiAgICBpZiAoSGFzRmlyc3RWYWNjaW5lRG9zZSBhbmQgSGFzU2Vjb25kVmFjY2luZURvc2UgYW5kIEhhc1RoaXJkVmFjY2luZURvc2UpIHRoZW4gZmFsc2UKICAgIGVsc2UgdHJ1ZQogIGVsc2UgZmFsc2UKCi8vIC0tLS0tLS0tLS0tLS0gQUxMRVJHSUVTIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8qIENoZWNrIHBhdGllbnQgcmVjb3JkIGZvciBhbGxlcmdpZXMgdG8gYW55IG9mIHRoZSByZWNvbW1lbmRlZCBQRVAgdHJlYXRtZW50cywgcGx1cwovLyBsYXRleC4gUGF0aWVudCBhbGxlcmdpZXMgYXJlIGRpc2NvdmVyZWQgYnkgcXVlcnlpbmcgQWxsZXJneUludG9sZXJhbmNlIHJlc291cmNlcy4gKi8KCi8vIEFjdGl2ZSBvciBjb25maXJtZWQgQWxsZXJneUludG9sZXJhbmNlIGZvciBDaXByb2Zsb3hhY2luLgpkZWZpbmUgQ2lwcm9mbG94YWNpbkFsbGVyZ3lJbnRvbGVyYW5jZXM6CiAgQzNGLkNvbmZpcm1lZEFsbGVyZ3lJbnRvbGVyYW5jZShbQWxsZXJneUludG9sZXJhbmNlOiAiQ2lwcm9mbG94YWNpbiBzdWJzdGFuY2UgY29kZSJdKQoKLy8gQWN0aXZlIG9yIGNvbmZpcm1lZCBBbGxlcmd5SW50b2xlcmFuY2UgZm9yIERveHljeWNsaW5lLgpkZWZpbmUgRG94eWN5Y2xpbmVBbGxlcmd5SW50b2xlcmFuY2VzOgogIEMzRi5Db25maXJtZWRBbGxlcmd5SW50b2xlcmFuY2UoW0FsbGVyZ3lJbnRvbGVyYW5jZTogIkRveHljeWNsaW5lIHN1YnN0YW5jZSBjb2RlIl0pCgovLyBBY3RpdmUgb3IgY29uZmlybWVkIEFsbGVyZ3lJbnRvbGVyYW5jZSBmb3IgTGV2b2Zsb3hhY2luLgpkZWZpbmUgTGV2b2Zsb3hhY2luQWxsZXJneUludG9sZXJhbmNlczoKICBDM0YuQ29uZmlybWVkQWxsZXJneUludG9sZXJhbmNlKFtBbGxlcmd5SW50b2xlcmFuY2U6ICJMZXZvZmxveGFjaW4gc3Vic3RhbmNlIGNvZGUiXSkKCi8vIEFjdGl2ZSBvciBjb25maXJtZWQgQWxsZXJneUludG9sZXJhbmNlIGZvciBNb3hpZmxveGFjaW4uCmRlZmluZSBNb3hpZmxveGFjaW5BbGxlcmd5SW50b2xlcmFuY2VzOgogIEMzRi5Db25maXJtZWRBbGxlcmd5SW50b2xlcmFuY2UoW0FsbGVyZ3lJbnRvbGVyYW5jZTogIk1veGlmbG94YWNpbiBzdWJzdGFuY2UgY29kZSJdKQoKLy8gQWN0aXZlIG9yIGNvbmZpcm1lZCBBbGxlcmd5SW50b2xlcmFuY2UgZm9yIENsaW5kYW15Y2luLgpkZWZpbmUgQ2xpbmRhbXljaW5BbGxlcmd5SW50b2xlcmFuY2VzOgogIEMzRi5Db25maXJtZWRBbGxlcmd5SW50b2xlcmFuY2UoW0FsbGVyZ3lJbnRvbGVyYW5jZTogIkNsaW5kYW15Y2luIHN1YnN0YW5jZSBjb2RlIl0pCgovLyBBY3RpdmUgb3IgY29uZmlybWVkIEFsbGVyZ3lJbnRvbGVyYW5jZSBmb3IgQmlvVGhyYXguCmRlZmluZSBWYWNjaW5lQWxsZXJneUludG9sZXJhbmNlczoKICBDM0YuQ29uZmlybWVkQWxsZXJneUludG9sZXJhbmNlKFtBbGxlcmd5SW50b2xlcmFuY2U6ICJBbnRocmF4IHZhY2NpbmUiXSkKCi8vIEFjdGl2ZSBvciBjb25maXJtZWQgQWxsZXJneUludG9sZXJhbmNlIGZvciBMYXRleC4KZGVmaW5lIExhdGV4QWxsZXJneUludG9sZXJhbmNlczoKICBDM0YuQ29uZmlybWVkQWxsZXJneUludG9sZXJhbmNlKFtBbGxlcmd5SW50b2xlcmFuY2U6ICJMYXRleCBzdWJzdGFuY2UgY29kZSJdCiAgICB1bmlvbiBbQWxsZXJneUludG9sZXJhbmNlOiAiTGF0ZXgiXSkKCi8vIENyZWF0ZSBhIGZvcm1hdHRlZCBsaXN0IG9mIGFsbCB0aGUgYW50aW1pY3JvYmlhbCBBbGxlcmd5SW50b2xlcmFuY2UgcmVzb3VyY2VzLgpkZWZpbmUgQW50aW1pY3JvYmlhbEFsbGVyZ3lMaXN0OgogIChDaXByb2Zsb3hhY2luQWxsZXJneUludG9sZXJhbmNlcwogICAgdW5pb24gRG94eWN5Y2xpbmVBbGxlcmd5SW50b2xlcmFuY2VzCiAgICB1bmlvbiBMZXZvZmxveGFjaW5BbGxlcmd5SW50b2xlcmFuY2VzCiAgICB1bmlvbiBNb3hpZmxveGFjaW5BbGxlcmd5SW50b2xlcmFuY2VzCiAgICB1bmlvbiBDbGluZGFteWNpbkFsbGVyZ3lJbnRvbGVyYW5jZXMpIEEKICByZXR1cm4gewogICAgVHlwZTogJ0FsbGVyZ3lJbnRvbGVyYW5jZScsCiAgICBJZDogQS5pZC52YWx1ZSwKICAgIERhdGVSZWNvcmRlZDogQ0NMLkRhdGVUaW1lVGV4dChBLnJlY29yZGVkRGF0ZSkKICB9CiAgc29ydCBieSBEYXRlUmVjb3JkZWQgZGVzYwoKLy8gQ3JlYXRlIGEgZm9ybWF0dGVkIGxpc3Qgb2YgYWxsIHRoZSB2YWNjaW5lIEFsbGVyZ3lJbnRvbGVyYW5jZSByZXNvdXJjZXMuCmRlZmluZSBWYWNjaW5lQWxsZXJneUxpc3Q6CiAgKFZhY2NpbmVBbGxlcmd5SW50b2xlcmFuY2VzKSBBCiAgcmV0dXJuIHsKICAgIFR5cGU6ICdBbGxlcmd5SW50b2xlcmFuY2UnLAogICAgSWQ6IEEuaWQudmFsdWUsCiAgICBEYXRlUmVjb3JkZWQ6IENDTC5EYXRlVGltZVRleHQoQS5yZWNvcmRlZERhdGUpCiAgfQogIHNvcnQgYnkgRGF0ZVJlY29yZGVkIGRlc2MKCi8vIENyZWF0ZSBhIGZvcm1hdHRlZCBsaXN0IG9mIGFsbCB0aGUgbGF0ZXggQWxsZXJneUludG9sZXJhbmNlIHJlc291cmNlcy4KZGVmaW5lIExhdGV4QWxsZXJneUxpc3Q6CiAgKExhdGV4QWxsZXJneUludG9sZXJhbmNlcykgQQogIHJldHVybiB7CiAgICBUeXBlOiAnQWxsZXJneUludG9sZXJhbmNlJywKICAgIElkOiBBLmlkLnZhbHVlLAogICAgRGF0ZVJlY29yZGVkOiBDQ0wuRGF0ZVRpbWVUZXh0KEEucmVjb3JkZWREYXRlKQogIH0KICBzb3J0IGJ5IERhdGVSZWNvcmRlZCBkZXNjCgovLyBBbnkgYWxsZXJnaWVzIHRvIGFueSBvZiB0aGUgYW50aW1pY3JvYmlhbHM/CmRlZmluZSBIYXNBbnRpbWljcm9iaWFsQWxsZXJneToKICBleGlzdHMoQW50aW1pY3JvYmlhbEFsbGVyZ3lMaXN0KQoKLy8gQW55IGFsbGVyZ2llcyB0byB0aGUgdmFjY2luZT8KZGVmaW5lIEhhc1ZhY2NpbmVBbGxlcmd5OgogIGV4aXN0cyhWYWNjaW5lQWxsZXJneUxpc3QpCgovLyBBbnkgYWxsZXJnaWVzIHRvIGxhdGV4PwpkZWZpbmUgSGFzTGF0ZXhBbGxlcmd5OgogIGV4aXN0cyhMYXRleEFsbGVyZ3lMaXN0KQoKLy8gLS0tLS0tLS0tLS0tLSBBTEVSVFMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLyogVGhlcmUgYXJlIGN1cnJlbnRseSBmaXZlIGFsZXJ0cyB0aGF0IGNhbiBwb3RlbnRpYWxseSBiZSBnZW5lcmF0ZWQgYnkgdGhpcyBDRFM6CjEuIEV4cG9zZWQgYnV0IG5vdCBhc3ltcHRvbWF0aWMuCjIuIEV4aXN0aW5nIGFudGltaWNyb2JpYWwgUnguCjMuIFBvdGVudGlhbCBhbnRpbWljcm9iaWFsIGFsbGVyZ3kuCjQuIFBvdGVudGlhbCB2YWNjaW5lIGFsbGVyZ3kuCjUuIFBvdGVudGlhbCBsYXRleCBhbGxlcmd5Lgo2LiBJbmNvbnNpc3RlbmNpZXMgaW4gcGF0aWVudCBCaW9UaHJheCBkb3NpbmcgaGlzdG9yeS4KClRoZXNlIGFsZXJ0cyBhcmUgcmVwcmVzZW50ZWQgdXNpbmcgZWl0aGVyIGEgRGV0ZWN0ZWRJc3N1ZSBvciBGbGFnIEZISVIgUjQgcmVzb3VyY2UuClRoZXkgZWFjaCBtYWtlIHJlZmVyZW5jZSB0byBGSElSIHJlc291cmNlcyB0aGF0IGhhdmUgYmVlbiBkaXNjb3ZlcmVkIGJ5IHF1ZXJ5aW5nIHRoZQpwYXRpZW50IHJlY29yZCAoZS5nLiwgYW4gQWxsZXJneUludG9sZXJhbmNlIHJlc291cmNlIGluZGljYXRpbmcgYSBwYXRpZW50IGFsbGVyZ3kgdG8KdGhlIHZhY2NpbmUpLgoqLwoKLy8gRGVmaW5lIGEgRGV2aWNlIHJlc291cmNlIGZvciByZWZlcnJpbmcgdG8gdGhpcyBDUUwgd2l0aGluIHRoZSBhbGVydCByZXNvdXJjZXMuCmRlZmluZSBEZXZpY2U6IHsKICByZXNvdXJjZVR5cGU6ICdEZXZpY2UnLAogIGlkOiAnMScsCiAgdHlwZTogewogICAgY29kaW5nOiB7IENDTC5Gb3JtYXRDb2RlKCJEZXZpY2UgY29kZSIpIH0KICB9LAogIGlkZW50aWZpZXI6IHsKICAgIHsKICAgICAgdmFsdWU6ICdBbnRocmF4X1Bvc3RfRXhwb3N1cmVfUHJvcGh5bGF4aXNfRkhJUnY0MDAuY3FsJwogICAgfQogIH0sCiAgbWFudWZhY3R1cmVyOiAnQ2VudGVycyBmb3IgRGlzZWFzZSBDb250cm9sIGFuZCBQcmV2ZW50aW9uJywKICB2ZXJzaW9uOiB7IHsKICAgIHZhbHVlOiBDcWxWZXJzaW9uCiAgfSB9Cn0KCi8qIEFsZXJ0IDE6IFBhdGllbnQgaXMgZXhwb3NlZCB0byBhbnRocmF4IGJ1dCBkb2VzIG5vdCBoYXZlIGFuIGFzeW1wdG9tYXRpYyBPYnNlcnZhdGlvbi4KSWYgdGhpcyBpcyB0aGUgY2FzZSwgYSBGbGFnIHJlc291cmNlIHdpbGwgYmUgZ2VuZXJhdGVkIGJlbG93IHRvIGhpZ2hsaWdodCB0aGlzIGlzc3VlCnNpbmNlIHBvc3QgZXhwb3N1cmUgcHJvcGh5bGF4aXMgaXMgb25seSByZWNvbW1lbmRlZCBmb3IgYXN5bXB0b21hdGljIHBhdGllbnRzLiBBCmZsYWctZGV0YWlsIGV4dGVuc2lvbiByZWZlcmVuY2UgdG8gdGhlIHJlc291cmNlIGluZGljYXRpbmcgZXhwb3N1cmUgYW5kIGEgY29kZSBmb3IKZG9jdW1lbnRpbmcgc2lnbnMgYW5kIHN5bXB0b21zIGFyZSBhbHNvIGluY2x1ZGVkLiBJZiBwYXRpZW50IGlzIGJvdGggZXhwb3NlZCBhbmQgYXN5bXB0b21hdGljLAp0aGVuIHRoaXMgRmxhZyByZXNvdXJjZSB3aWxsIGJlIGVtcHR5IChudWxsKS4gKi8KZGVmaW5lIEZsYWdOb0FzeW1wdG9tYXRpY09ic2VydmF0aW9uOgogIGlmIChSZWNlbnRseUV4cG9zZWRUb0FudGhyYXggYW5kIElzMThvck9sZGVyIGFuZCBub3QgQXN5bXB0b21hdGljKSB0aGVuIHsKICAgIHJlc291cmNlVHlwZTogJ0ZsYWcnLAogICAgaWQ6ICcyJywKICAgIHRleHQ6IHsKICAgICAgc3RhdHVzOiAnZ2VuZXJhdGVkJywKICAgICAgImRpdiI6ICc8ZGl2IHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbFwiPklmIHBhdGllbnQgaGFzIHNpZ25zIG9yIHN5bXB0b21zIGNvbnNpc3RlbnQgd2l0aCBhbnRocmF4LCBjb25kdWN0IGEgZnVsbCBkaWFnbm9zdGljIGV2YWx1YXRpb24gZm9yIGFudGhyYXguIFNpZ25zIGFuZCBzeW1wdG9tcyBvZiBhbnRocmF4IGluY2x1ZGUgZmV2ZXIsIGNoaWxscywgaGVhZGFjaGUsIG1hbGFpc2UsIG5hdXNlYSwgdm9taXRpbmcsIGRpYXJyaGVhLCBhYmRvbWluYWwgcGFpbiwgZGlhcGhvcmVzaXMsIGFub3JleGlhLCBub25wcm9kdWN0aXZlIGNvdWdoLCBkaWZmaWN1bHR5IGJyZWF0aGluZywgZHlzcG5lYSwgc3RyaWRvciwgaHlwb3hlbWlhLCBoeXBvdGVuc2lvbiwgc2hvY2ssIGN5YW5vc2lzLCBjaGVzdCBwYWluLCBseW1waGFkZW5vcGF0aHksIGN1dGFuZW91cyB1bGNlciBhbmQgYmxhY2sgZXNjaGFyLiBJZiBwYXRpZW50IGhhcyBOTyBzaWducyBvciBzeW1wdG9tcyBjb25zaXN0ZW50IHdpdGggYW50aHJheCwgZG9jdW1lbnQg4oCcYXN5bXB0b21hdGljIFNOT01FRENUIDg0Mzg3MDAwLjwvZGl2PicKICAgIH0sCiAgICBzdWJqZWN0OiB7CiAgICAgIHJlZmVyZW5jZTogJ1BhdGllbnQvJyArIFBhdGllbnQuaWQudmFsdWUKICAgIH0sCiAgICBhdXRob3I6IHsKICAgICAgcmVmZXJlbmNlOiBDQ0wuR2VuZXJhdGVMb2NhbFJlZmVyZW5jZSgnRGV2aWNlJywgRGV2aWNlLmlkKQogICAgfSwKICAgIHN0YXR1czogJ2FjdGl2ZScsCiAgICBjb2RlOiB7CiAgICAgIGNvZGluZzogeyBDQ0wuRm9ybWF0Q29kZSgiRG9jdW1lbnQgc2lnbnMgYW5kIHN5bXB0b21zIGNvZGUiKSB9CiAgICB9LAogICAgZXh0ZW5zaW9uOiB7CiAgICAgIHsgLy8gZmxhZy1kZXRhaWwgZXh0ZW5zaW9uIHRoYXQgcmVmZXJlbmNlcyB0aGUgZXhwb3N1cmUgcmVzb3VyY2UuCiAgICAgICAgdXJsOiAnaHR0cDovL2hsNy5vcmcvZmhpci9TdHJ1Y3R1cmVEZWZpbml0aW9uL2ZsYWctZGV0YWlsJywKICAgICAgICB2YWx1ZVJlZmVyZW5jZTogewogICAgICAgICAgcmVmZXJlbmNlOiBDQ0wuR2VuZXJhdGVMb2NhbFJlZmVyZW5jZSgKICAgICAgICAgIE1vc3RSZWNlbnRBbnRocmF4RXhwb3N1cmVSZXNvdXJjZS5UeXBlLAogICAgICAgICAgTW9zdFJlY2VudEFudGhyYXhFeHBvc3VyZVJlc291cmNlLklkKQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICBlbHNlIG51bGwKCi8vIExpc3Qgb2YgcmVmZXJlbmNlcyBuZWVkZWQgZm9yIEFsZXJ0IDIgKERldGVjdGVkSXNzdWVFeGlzdGluZ0FudGltaWNyb2JpYWxSeCkuCmRlZmluZSBJbXBsaWNhdGVkRXhpc3RpbmdNZWRpY2F0aW9uUmVzb3VyY2VzOgogIChGb3JtYXR0ZWRBbnRpbWljcm9iaWFsTWVkaWNhdGlvblJlc291cmNlcykgTAogIHJldHVybiB7CiAgICByZWZlcmVuY2U6IENDTC5HZW5lcmF0ZUxvY2FsUmVmZXJlbmNlKEwuVHlwZSwgTC5JZCkKICB9CgovLyBTdHJpbmdzIG5lZWRlZCB0byBidWlsZCBtZXNzYWdlIGZvciBBbGVydCAyIChEZXRlY3RlZElzc3VlRXhpc3RpbmdBbnRpbWljcm9iaWFsUngpLgpkZWZpbmUgQ2lwcm9mbG94YWNpblJ4VGV4dDoKICBpZiAoSGFzQ2lwcm9mbG94YWNpblJ4KSB0aGVuIHsKICAgIG5hbWU6ICdDaXByb2Zsb3hhY2luJywKICAgIHJ4OiAnQ2lwcm9mbG94YWNpbiA1MDAgbWcgYnkgbW91dGggZXZlcnkgMTIgaG91cnMgZm9yIDYwIGRheXMnIH0gZWxzZSBudWxsCgpkZWZpbmUgRG94eWN5Y2xpbmVSeFRleHQ6CiAgaWYgKEhhc0RveHljeWNsaW5lUngpIHRoZW4gewogICAgbmFtZTogJ0RveHljeWNsaW5lJywKICAgIHJ4OiAnRG94eWN5Y2xpbmUgMTAwIG1nIGJ5IG1vdXRoIGV2ZXJ5IDEyIGhvdXJzIGZvciA2MCBkYXlzJyB9IGVsc2UgbnVsbAoKZGVmaW5lIExldm9mbG94YWNpblJ4VGV4dDoKICBpZiAoSGFzTGV2b2Zsb3hhY2luUngpIHRoZW4gewogICAgbmFtZTogJ0xldm9mbG94YWNpbicsCiAgICByeDogJ0xldm9mbG94YWNpbiA3NTAgbWcgYnkgbW91dGggb25jZSBkYWlseSBmb3IgNjAgZGF5cycgfSBlbHNlIG51bGwKCmRlZmluZSBNb3hpZmxveGFjaW5SeFRleHQ6CiAgaWYgKEhhc01veGlmbG94YWNpblJ4KSB0aGVuIHsKICAgIG5hbWU6ICdNb3hpZmxveGFjaW4nLAogICAgcng6ICdNb3hpZmxveGFjaW4gNDAwIG1nIGJ5IG1vdXRoIG9uY2UgZGFpbHkgZm9yIDYwIGRheXMnIH0gZWxzZSBudWxsCgpkZWZpbmUgQ2xpbmRhbXljaW5SeFRleHQ6CiAgaWYgKEhhc0NsaW5kYW15Y2luUngpIHRoZW4gewogICAgbmFtZTogJ0NsaW5kYW15Y2luJywKICAgIHJ4OiAnQ2xpbmRhbXljaW4gNjAwIG1nIGJ5IG1vdXRoIGV2ZXJ5IDggaG91cnMgZm9yIDYwIGRheXNdJyB9IGVsc2UgbnVsbAoKLy8gVGV4dCBzdHJpbmcgdG8gYmUgZGlzcGxheWVkIGluIEFsZXJ0IDIgKERldGVjdGVkSXNzdWVFeGlzdGluZ0FudGltaWNyb2JpYWxSeCkuCmRlZmluZSBFeGlzdGluZ0FudGltaWNyb2JpYWxUZXh0OgogIENvbWJpbmUoewogICAgJ1RoZSBwYXRpZW50IGhhcyBhbiBhY3RpdmUgcHJlc2NyaXB0aW9uIGZvciBbJywKICAgIENvbWJpbmUoCiAgICAgIENDTC5DdWxsTnVsbFN0cmluZ3MoewogICAgICAgIENpcHJvZmxveGFjaW5SeFRleHQubmFtZSwKICAgICAgICBEb3h5Y3ljbGluZVJ4VGV4dC5uYW1lLAogICAgICAgIExldm9mbG94YWNpblJ4VGV4dC5uYW1lLAogICAgICAgIE1veGlmbG94YWNpblJ4VGV4dC5uYW1lLAogICAgICAgIENsaW5kYW15Y2luUnhUZXh0Lm5hbWV9KSwgJyAsICcpLAogICAgJ10uIEV2YWx1YXRlIHRoZSBkb3NhZ2UgYW5kIGR1cmF0aW9uIHRvIGVuc3VyZSBhIDYwLWRheSByZWdpbWVuIG9mIGFwcHJvcHJpYXRlIGFudGliaW90aWMgcG9zdC1hbnRocmF4IGV4cG9zdXJlOiBbJywKICAgIENvbWJpbmUoCiAgICAgIENDTC5DdWxsTnVsbFN0cmluZ3MoewogICAgICAgIENpcHJvZmxveGFjaW5SeFRleHQucngsCiAgICAgICAgRG94eWN5Y2xpbmVSeFRleHQucngsCiAgICAgICAgTGV2b2Zsb3hhY2luUnhUZXh0LnJ4LAogICAgICAgIE1veGlmbG94YWNpblJ4VGV4dC5yeCwKICAgICAgICBDbGluZGFteWNpblJ4VGV4dC5yeH0pLCAnICwgJyksCiAgICAnXS4nfSkKCi8qIEFsZXJ0IDI6IFBhdGllbnQgaGFzIGF0IGxlYXN0IG9uZSBleGlzdGluZyBwcmVzY3JpcHRpb24gdG8gb25lIG9mIHRoZSByZWNvbW1lbmRlZAphbnRpbWljcm9iaWFscy4gSWYgdGhlIHBhdGllbnQgaXMgZXhwb3NlZCwgYXN5bXB0b21hdGljLCBhbmQgaGFzIGFuIGFjdGl2ZSBSeCBmb3IKYSBwZXJ0aW5lbnQgYW50aW1pY3JvYmlhbCwgYSBEZXRlY3RlZElzc3VlIHJlc291cmNlIHdpbGwgYmUgZ2VuZXJhdGVkIHdoaWNoIHdpbGwKcmVmZXJlbmNlIHRoZSBtb3N0IHJlY2VudCBNZWRpY2F0aW9uIHJlc291cmNlIGZvciBvbmUgb2YgdGhlIGFudGltaWNyb2JpYWxzLiBUaGUKc3VnZ2VzdGVkIG1pdGlnYXRpb24gd2lsbCBiZSB0byByZXZpZXcgdGhlIHBhdGllbnQncyBtZWRpY2F0aW9uIHRvIGVuc3VyZSBpdCBhcHByb3ByaWF0ZWx5Cm1lZXRzIENEQyByZWNvbW1lbmRlZCBkb3NhZ2UgYW5kIGR1cmF0aW9uLiBJZiB0aGUgcGF0aWVudCBkb2VzIG5vdCBoYXZlIGFuIGV4aXN0aW5nClJ4LCB0aGVuIHRoaXMgRGV0ZWN0ZWRJc3N1ZSByZXNvdXJjZSB3aWxsIGJlIGVtcHR5IChudWxsKS4gKi8KZGVmaW5lIERldGVjdGVkSXNzdWVFeGlzdGluZ0FudGltaWNyb2JpYWxSeDoKICBpZiAoUmVjZW50bHlFeHBvc2VkVG9BbnRocmF4IGFuZCBJczE4b3JPbGRlciBhbmQgQXN5bXB0b21hdGljIGFuZCBIYXNFeGlzdGluZ0FudGltaWNyb2JpYWxSeCkgdGhlbiB7CiAgICByZXNvdXJjZVR5cGU6ICdEZXRlY3RlZElzc3VlJywKICAgIGlkOiAnMycsCiAgICBkZXRhaWw6IEV4aXN0aW5nQW50aW1pY3JvYmlhbFRleHQsCiAgICBhdXRob3I6IHsKICAgICAgcmVmZXJlbmNlOiBDQ0wuR2VuZXJhdGVMb2NhbFJlZmVyZW5jZSgnRGV2aWNlJywgRGV2aWNlLmlkKQogICAgfSwKICAgIGNvZGU6IHsKICAgICAgY29kaW5nOiB7IENDTC5Gb3JtYXRDb2RlKCJOb3QgZXF1aXZhbGVudCBhbGVydCBjb2RlIikgfQogICAgfSwKICAgIGltcGxpY2F0ZWQ6IEltcGxpY2F0ZWRFeGlzdGluZ01lZGljYXRpb25SZXNvdXJjZXMsCiAgICBtaXRpZ2F0aW9uOiB7IHsKICAgICAgYWN0aW9uOiB7CiAgICAgICAgY29kaW5nOiB7IENDTC5Gb3JtYXRDb2RlKCJNZWRpY2F0aW9uIHJldmlldyBjb2RlIikgfQogICAgICB9CiAgICB9IH0sCiAgICBzdGF0dXM6ICdwcmVsaW1pbmFyeScKICB9CiAgZWxzZSBudWxsCgovLyBMaXN0IG9mIHJlZmVyZW5jZXMgbmVlZGVkIGZvciBBbGVydCAzIChGbGFnQW50aW1pY3JvYmlhbE1lZGljYXRpb25BbGxlcmdpZXMpLgpkZWZpbmUgQW50aW1pY3JvYmlhbEFsbGVyZ3lFeHRlbnNpb25SZWZlcmVuY2VzOgogIChBbnRpbWljcm9iaWFsQWxsZXJneUxpc3QpIEwKICByZXR1cm4gewogICAgdXJsOiAnaHR0cDovL2hsNy5vcmcvZmhpci9TdHJ1Y3R1cmVEZWZpbml0aW9uL2ZsYWctZGV0YWlsJywKICAgIHZhbHVlUmVmZXJlbmNlOiB7CiAgICAgIHJlZmVyZW5jZTogQ0NMLkdlbmVyYXRlTG9jYWxSZWZlcmVuY2UoTC5UeXBlLCBMLklkKQogICAgfQogIH0KCi8vIFN0cmluZ3MgbmVlZGVkIHRvIGJ1aWxkIG1lc3NhZ2UgZm9yIEFsZXJ0IDMgKEZsYWdBbnRpbWljcm9iaWFsTWVkaWNhdGlvbkFsbGVyZ2llcykuCmRlZmluZSBDaXByb2Zsb3hhY2luQWxsZXJneVRleHQ6CiAgaWYgKGV4aXN0cyhDaXByb2Zsb3hhY2luQWxsZXJneUludG9sZXJhbmNlcykpIHRoZW4gJ0NpcHJvZmxveGFjaW4nIGVsc2UgbnVsbAoKZGVmaW5lIERveHljeWNsaW5lQWxsZXJneVRleHQ6CiAgaWYgKGV4aXN0cyhEb3h5Y3ljbGluZUFsbGVyZ3lJbnRvbGVyYW5jZXMpKSB0aGVuICdEb3h5Y3ljbGluZScgZWxzZSBudWxsCgpkZWZpbmUgTGV2b2Zsb3hhY2luQWxsZXJneVRleHQ6CiAgaWYgKGV4aXN0cyhMZXZvZmxveGFjaW5BbGxlcmd5SW50b2xlcmFuY2VzKSkgdGhlbiAnTGV2b2Zsb3hhY2luJyBlbHNlIG51bGwKCmRlZmluZSBNb3hpZmxveGFjaW5BbGxlcmd5VGV4dDoKICBpZiAoZXhpc3RzKE1veGlmbG94YWNpbkFsbGVyZ3lJbnRvbGVyYW5jZXMpKSB0aGVuICdNb3hpZmxveGFjaW4nIGVsc2UgbnVsbAoKZGVmaW5lIENsaW5kYW15Y2luQWxsZXJneVRleHQ6CiAgaWYgKGV4aXN0cyhDbGluZGFteWNpbkFsbGVyZ3lJbnRvbGVyYW5jZXMpKSB0aGVuICdDbGluZGFteWNpbicgZWxzZSBudWxsCgovLyBUZXh0IHN0cmluZyB0byBiZSBkaXNwbGF5ZWQgaW4gQWxlcnQgMyAoRmxhZ0FudGltaWNyb2JpYWxNZWRpY2F0aW9uQWxsZXJnaWVzKS4KZGVmaW5lIEFsbGVyZ3lBbGVydFRleHQ6CiAgQ29tYmluZSh7CiAgICAnPGRpdiB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWxcIj5Qb3RlbnRpYWwgcGF0aWVudCBhbGxlcmd5IHRvIFsnLAogICAgQ29tYmluZSgKICAgICAgQ0NMLkN1bGxOdWxsU3RyaW5ncyh7CiAgICAgICAgQ2lwcm9mbG94YWNpbkFsbGVyZ3lUZXh0LAogICAgICAgIERveHljeWNsaW5lQWxsZXJneVRleHQsCiAgICAgICAgTGV2b2Zsb3hhY2luQWxsZXJneVRleHQsCiAgICAgICAgTW94aWZsb3hhY2luQWxsZXJneVRleHQsCiAgICAgICAgQ2xpbmRhbXljaW5BbGxlcmd5VGV4dH0pLCAnICwgJyksCiAgICAnXS4gQ29uZmlybSBhbGxlcmd5IHN0YXR1cy48L2Rpdj4nfSkKCi8qIEFsZXJ0IDM6IFBhdGllbnQgcG90ZW50aWFsbHkgaGFzIGFuIGFsbGVyZ3kgdG8gb25lIG9mIHRoZSBhbnRpbWljcm9iaWFscy4gSWYgdGhlCnBhdGllbnQgaXMgZXhwb3NlZCwgYXN5bXB0b21hdGljLCBhbmQgaGFzIGFuIEFsbGVyZ3lJbnRvbGVyYW5jZSByZXNvdXJjZSBmb3Igb25lCm9mIHRoZSByZWNvbW1lbmRlZCBhbnRpbWljcm9iaWFscywgYSBGbGFnIHJlc291cmNlIHdpbGwgYmUgZ2VuZXJhdGVkIHRvIGFsZXJ0IG9uCnRoaXMuIFRoZSBsaXN0IG9mIHBvdGVudGlhbCBhbGxlcmdpZXMgYXJlIGluY2x1ZGVkIGluIHRoZSBmbGFnLWRldGFpbCBleHRlbnNpb24KZmllbGQuIElmIHRoZSBwYXRpZW50IGhhcyBubyBhbGxlcmdpZXMsIHRoZW4gdGhpcyBGbGFnIHJlc291cmNlIHdpbGwgYmUgZW1wdHkgKG51bGwpLiAqLwpkZWZpbmUgRmxhZ0FudGltaWNyb2JpYWxNZWRpY2F0aW9uQWxsZXJnaWVzOgogIGlmIChSZWNlbnRseUV4cG9zZWRUb0FudGhyYXggYW5kIElzMThvck9sZGVyIGFuZCBBc3ltcHRvbWF0aWMgYW5kIEhhc0FudGltaWNyb2JpYWxBbGxlcmd5KSB0aGVuIHsKICAgIHJlc291cmNlVHlwZTogJ0ZsYWcnLAogICAgaWQ6ICc0JywKICAgIHRleHQ6IHsKICAgICAgc3RhdHVzOiAnZ2VuZXJhdGVkJywKICAgICAgImRpdiI6IEFsbGVyZ3lBbGVydFRleHQKICAgIH0sCiAgICBzdWJqZWN0OiB7CiAgICAgIHJlZmVyZW5jZTogJ1BhdGllbnQvJyArIFBhdGllbnQuaWQudmFsdWUKICAgIH0sCiAgICBhdXRob3I6IHsKICAgICAgcmVmZXJlbmNlOiBDQ0wuR2VuZXJhdGVMb2NhbFJlZmVyZW5jZSgnRGV2aWNlJywgRGV2aWNlLmlkKQogICAgfSwKICAgIHN0YXR1czogJ2FjdGl2ZScsCiAgICBjb2RlOiB7CiAgICAgIGNvZGluZzogeyBDQ0wuRm9ybWF0Q29kZSgiVmVyaWZ5IGFsbGVyZ3kgc3RhdHVzIGNvZGUiKSB9CiAgICB9LAogICAgZXh0ZW5zaW9uOiAgQW50aW1pY3JvYmlhbEFsbGVyZ3lFeHRlbnNpb25SZWZlcmVuY2VzCiAgfQogIGVsc2UgbnVsbAoKLy8gTGlzdCBvZiByZWZlcmVuY2VzIG5lZWRlZCBmb3IgQWxlcnQgNCAoRmxhZ0Jpb1RocmF4QWxsZXJneSkuCmRlZmluZSBWYWNjaW5lQWxsZXJneUV4dGVuc2lvblJlZmVyZW5jZXM6CiAgKFZhY2NpbmVBbGxlcmd5TGlzdCkgTAogIHJldHVybiB7CiAgICB1cmw6ICdodHRwOi8vaGw3Lm9yZy9maGlyL1N0cnVjdHVyZURlZmluaXRpb24vZmxhZy1kZXRhaWwnLAogICAgdmFsdWVSZWZlcmVuY2U6IHsKICAgICAgcmVmZXJlbmNlOiBDQ0wuR2VuZXJhdGVMb2NhbFJlZmVyZW5jZShMLlR5cGUsIEwuSWQpCiAgICB9CiAgfQoKLyogQWxlcnQgNDogUGF0aWVudCBwb3RlbnRpYWxseSBoYXMgYW4gYWxsZXJneSB0byB0aGUgYW50aHJheCB2YWNjaW5lLiBJZiB0aGUKcGF0aWVudCBpcyBleHBvc2VkLCBhc3ltcHRvbWF0aWMsIGFuZCBoYXMgYW4gQWxsZXJneUludG9sZXJhbmNlIHJlc291cmNlIGZvciB0aGUKYW50aHJheCB2YWNjaW5lLCBhIEZsYWcgcmVzb3VyY2Ugd2lsbCBiZSBnZW5lcmF0ZWQgdG8gYWxlcnQgb24gdGhpcy4gVGhlIGxpc3Qgb2YKcG90ZW50aWFsIEFsbGVyZ3lJbnRvbGVyYW5jZSByZXNvdXJjZXMgYXJlIGluY2x1ZGVkIGluIHRoZSBmbGFnLWRldGFpbCBleHRlbnNpb24KZmllbGQgb2YgdGhlIEZsYWcuIElmIHRoZSBwYXRpZW50IGhhcyBubyBhbGxlcmdpZXMgdG8gdGhlIHZhY2NpbmUsIHRoZW4gdGhpcyBGbGFnCnJlc291cmNlIHdpbGwgYmUgZW1wdHkgKG51bGwpLiAqLwpkZWZpbmUgRmxhZ0Jpb1RocmF4QWxsZXJneToKICBpZiAoUmVjZW50bHlFeHBvc2VkVG9BbnRocmF4IGFuZCBJczE4b3JPbGRlciBhbmQgQXN5bXB0b21hdGljIGFuZCBIYXNWYWNjaW5lQWxsZXJneSkgdGhlbiB7CiAgICByZXNvdXJjZVR5cGU6ICdGbGFnJywKICAgIGlkOiAnNScsCiAgICB0ZXh0OiB7CiAgICAgIHN0YXR1czogJ2dlbmVyYXRlZCcsCiAgICAgICJkaXYiOiAnPGRpdiB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWxcIj5Qb3RlbnRpYWwgcGF0aWVudCBhbGxlcmd5IHRvIEJpb1RocmF4LiBDb25maXJtIGFsbGVyZ3kgc3RhdHVzLjwvZGl2PicKICAgIH0sCiAgICBzdWJqZWN0OiB7CiAgICAgIHJlZmVyZW5jZTogJ1BhdGllbnQvJyArIFBhdGllbnQuaWQudmFsdWUKICAgIH0sCiAgICBhdXRob3I6IHsKICAgICAgcmVmZXJlbmNlOiBDQ0wuR2VuZXJhdGVMb2NhbFJlZmVyZW5jZSgnRGV2aWNlJywgRGV2aWNlLmlkKQogICAgfSwKICAgIHN0YXR1czogJ2FjdGl2ZScsCiAgICBjb2RlOiB7CiAgICAgIGNvZGluZzogeyBDQ0wuRm9ybWF0Q29kZSgiVmVyaWZ5IGFsbGVyZ3kgc3RhdHVzIGNvZGUiKSB9CiAgICB9LAogICAgZXh0ZW5zaW9uOiBWYWNjaW5lQWxsZXJneUV4dGVuc2lvblJlZmVyZW5jZXMKICB9CiAgZWxzZSBudWxsCgovLyBMaXN0IG9mIHJlZmVyZW5jZXMgbmVlZGVkIGZvciBBbGVydCA1IChGbGFnTGF0ZXhBbGxlcmd5KS4KZGVmaW5lIExhdGV4QWxsZXJneUV4dGVuc2lvblJlZmVyZW5jZXM6CiAgKExhdGV4QWxsZXJneUxpc3QpIEwKICByZXR1cm4gewogICAgdXJsOiAnaHR0cDovL2hsNy5vcmcvZmhpci9TdHJ1Y3R1cmVEZWZpbml0aW9uL2ZsYWctZGV0YWlsJywKICAgIHZhbHVlUmVmZXJlbmNlOiB7CiAgICAgIHJlZmVyZW5jZTogQ0NMLkdlbmVyYXRlTG9jYWxSZWZlcmVuY2UoTC5UeXBlLCBMLklkKQogICAgfQogIH0KCi8qIEFsZXJ0IDU6IFBhdGllbnQgcG90ZW50aWFsbHkgaGFzIGFuIGFsbGVyZ3kgdG8gbGF0ZXguIElmIHRoZSBwYXRpZW50IGlzIGV4cG9zZWQsCmFzeW1wdG9tYXRpYywgYW5kIGhhcyByZXNvdXJjZXMgaW5kaWNhdGluZyBhbiBhbGxlcmd5IHRvIGxhdGV4LCBhIEZsYWcgcmVzb3VyY2UKd2lsbCBiZSBnZW5lcmF0ZWQgdG8gYWxlcnQgb24gdGhpcy4gVGhlIGxpc3Qgb2YgcG90ZW50aWFsIHJlc291cmNlcyBpbmRpY2F0aW5nIGEKbGF0ZXggYWxsZXJneSBhcmUgaW5jbHVkZWQgaW4gdGhlIGZsYWctZGV0YWlsIGV4dGVuc2lvbiBmaWVsZCBvZiB0aGUgRmxhZy4gSWYgdGhlCnBhdGllbnQgaGFzIG5vIGFsbGVyZ2llcyB0byBsYXRleCwgdGhlbiB0aGlzIEZsYWcgcmVzb3VyY2Ugd2lsbCBiZSBlbXB0eSAobnVsbCkuICovCmRlZmluZSBGbGFnTGF0ZXhBbGxlcmd5OgogIGlmIChSZWNlbnRseUV4cG9zZWRUb0FudGhyYXggYW5kIElzMThvck9sZGVyIGFuZCBBc3ltcHRvbWF0aWMgYW5kIEhhc0xhdGV4QWxsZXJneSkgdGhlbiB7CiAgICByZXNvdXJjZVR5cGU6ICdGbGFnJywKICAgIGlkOiAnNicsCiAgICB0ZXh0OiB7CiAgICAgIHN0YXR1czogJ2dlbmVyYXRlZCcsCiAgICAgICJkaXYiOiAnPGRpdiB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWxcIj5Qb3RlbnRpYWwgcGF0aWVudCBhbGxlcmd5IHRvIGxhdGV4LiBUaGUgc3RvcHBlciBvZiBCaW9UaHJheCAoYW50aHJheCB2YWNjaW5lKSB2aWFsIGNvbnRhaW5zIGxhdGV4LiBDb25maXJtIGFsbGVyZ3kgc3RhdHVzLjwvZGl2PicKICAgIH0sCiAgICBzdWJqZWN0OiB7CiAgICAgIHJlZmVyZW5jZTogJ1BhdGllbnQvJyArIFBhdGllbnQuaWQudmFsdWUKICAgIH0sCiAgICBhdXRob3I6IHsKICAgICAgcmVmZXJlbmNlOiBDQ0wuR2VuZXJhdGVMb2NhbFJlZmVyZW5jZSgnRGV2aWNlJywgRGV2aWNlLmlkKQogICAgfSwKICAgIHN0YXR1czogJ2FjdGl2ZScsCiAgICBjb2RlOiB7CiAgICAgIGNvZGluZzogeyBDQ0wuRm9ybWF0Q29kZSgiVmVyaWZ5IGFsbGVyZ3kgc3RhdHVzIGNvZGUiKSB9CiAgICB9LAogICAgZXh0ZW5zaW9uOiBMYXRleEFsbGVyZ3lFeHRlbnNpb25SZWZlcmVuY2VzCiAgfQogIGVsc2UgbnVsbAoKLy8gTGlzdCBvZiByZWZlcmVuY2VzIG5lZWRlZCBmb3IgQWxlcnQgNiAoRGV0ZWN0ZWRJc3N1ZUJpb1RocmF4SGlzdG9yeUluY29uc2lzdGVuY2llcykuCmRlZmluZSBJbXBsaWNhdGVkVmFjY2luZVByb2NlZHVyZToKICB7CiAgICByZWZlcmVuY2U6IENDTC5HZW5lcmF0ZUxvY2FsUmVmZXJlbmNlKCdQcm9jZWR1cmUnLCBNb3N0UmVjZW50VmFjY2luZVByb2NlZHVyZS5pZC52YWx1ZSkKICB9CgovKiBBbGVydCA2OiBQYXRpZW50IEJpb1RocmF4IGRvc2luZyBoaXN0b3J5IGhhcyBkYXRhIGNvbnNpc3RlbmN5IGlzc3Vlcy4gRWl0aGVyCnRoZXJlIGlzIGFuIGluZGljYXRpb24gdGhhdCB0aGUgcmVjb21tZW5kZWQgZG9zaW5nIHNlcXVlbmNlIHdhcyBub3QgZm9sbG93ZWQgKGkuZS4sCnRoZXJlIGlzIGEgbWlzc2luZyBkb3NlKSwgb3IgdGhlIGxhc3QgdmFjY2luZSBQcm9jZWR1cmUgaXMgbWlzc2luZyBhIGRhdGUuIFVuZGVyCnRoZXNlIGNvbmRpdGlvbnMgdGhpcyBDRFMgY2Fubm90IHJlbGlhYmx5IHByb3ZpZGUgdGhlIGNvcnJlY3QgUEVQIHRyZWF0bWVudApyZWNvbW1lbmRhdGlvbnMuIElmIHRoZXJlIGlzIGEgbWlzc2luZyBkb3NlIGluIHRoZSB2YWNjaW5lIHNlcXVlbmNlLCBvciBpZiB0aGUKbGFzdCB2YWNjaW5lIFByb2NlZHVyZSBpcyBtaXNzaW5nIGEgZGF0ZSwgdGhlbiBhIERldGVjdGVkSXNzdWUgcmVzb3VyY2Ugd2lsbCBiZQpnZW5lcmF0ZWQgd2hpY2ggd2lsbCByZWZlcmVuY2UgdGhlIG1vc3QgcmVjZW50IHZhY2NpbmUgUHJvY2VkdXJlIHJlc291cmNlLiBUaGUKc3VnZ2VzdGVkIG1pdGlnYXRpb24gd2lsbCBiZSB0byByZXZpZXcgdGhlIHBhdGllbnQncyBtZWRpY2F0aW9uIHRvIGVuc3VyZSBpdCBhcHByb3ByaWF0ZWx5Cm1lZXRzIENEQyBndWlkZWxpbmVzLiBJZiBubyBpbmNvbnNpc3RlbmNpZXMgYXJlIGZvdW5kLCB0aGVuIHRoaXMgRGV0ZWN0ZWRJc3N1ZSByZXNvdXJjZQp3aWxsIGJlIGVtcHR5IChudWxsKS4gKi8KZGVmaW5lIERldGVjdGVkSXNzdWVCaW9UaHJheEhpc3RvcnlJbmNvbnNpc3RlbmNpZXM6CiAgaWYgKCBSZWNlbnRseUV4cG9zZWRUb0FudGhyYXggYW5kIElzMThvck9sZGVyIGFuZCBBc3ltcHRvbWF0aWMgYW5kCiAgICAoTGFzdFZhY2NpbmVQcm9jZWR1cmVNaXNzaW5nRGF0ZSBvciBNaXNzaW5nVmFjY2luZURvc2UpICkgdGhlbiB7CiAgICByZXNvdXJjZVR5cGU6ICdEZXRlY3RlZElzc3VlJywKICAgIGlkOiAnNycsCiAgICBkZXRhaWw6ICdQb3RlbnRpYWwgQmlvVGhyYXggdmFjY2luZSBzZXJpZXMgcHJvYmxlbShzKSBpZGVudGlmaWVkLiBBIHZhY2NpbmUgaW4gdGhlIHJlY29tbWVuZGVkIHNlcmllcyBtaWdodCBiZSBtaXNzaW5nIG9yIGEgdmFjY2luYXRpb24gZGF0ZSBtaWdodCBiZSBtaXNzaW5nLiBSZXZpZXcgQmlvVGhyYXggdmFjY2luZSBzZXJpZXMgaGlzdG9yeS4nLAogICAgYXV0aG9yOiB7CiAgICAgIHJlZmVyZW5jZTogQ0NMLkdlbmVyYXRlTG9jYWxSZWZlcmVuY2UoJ0RldmljZScsIERldmljZS5pZCkKICAgIH0sCiAgICBjb2RlOiB7CiAgICAgIGNvZGluZzogeyBDQ0wuRm9ybWF0Q29kZSgiVGltaW5nIGRldGVjdGVkIGlzc3VlIGNvZGUiKSB9CiAgICB9LAogICAgaW1wbGljYXRlZDogeyBJbXBsaWNhdGVkVmFjY2luZVByb2NlZHVyZSB9LAogICAgbWl0aWdhdGlvbjogeyB7CiAgICAgIGFjdGlvbjogewogICAgICAgIGNvZGluZzogeyBDQ0wuRm9ybWF0Q29kZSgiTWVkaWNhdGlvbiByZXZpZXcgY29kZSIpIH0KICAgICAgfQogICAgfSB9LAogICAgc3RhdHVzOiAncHJlbGltaW5hcnknCiAgfQogIGVsc2UgbnVsbAoKLy8gLS0tLS0tLS0tLS0tLSBPUkRFUiBTRVQgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovKiBUaGUgbWFpbiBvdXRwdXQgb2YgdGhpcyBDRFMgaXMgYW4gb3JkZXIgc2V0IHdoaWNoIHNwZWNpZmllcyB0aGUgcmVjb21tZW5kZWQKdHJlYXRtZW50IGZvciBBbnRocmF4IFBFUC4gVGhpcyB0cmVhdG1lbnQgY291bGQgaW5jbHVkZSBhIGRvc2Ugb2YgdGhlIEFudGhyYXgKdmFjY2luZSwgYSBwcmVzY3JpcHRpb24gZm9yIGEgcmVjb21tZW5kZWQgYW50aW1pY3JvYmlhbCwgYm90aCwgb3IgbmVpdGhlci4KKi8KCi8qIFRoZSBhcHByb3ByaWF0ZSBQcm9jZWR1cmUgY29kZXMgZm9yIHRoZSBuZXh0IGRvc2Ugb2YgdGhlIEFudGhyYXggdmFjY2luZS4gSWYgdGhlCnBhdGllbnQgaXMgbm90IGdldHRpbmcgYW5vdGhlciBkb3NlIGF0IHRoaXMgdGltZSwgdGhlbiB0aGlzIHdpbGwgYmUgZW1wdHkuCiovCmRlZmluZSBWYWNjaW5lQ29kaW5nOgogIGNhc2UKICAgIHdoZW4gTmV4dFZhY2NpbmVEb3NlTnVtYmVyID0gMSB0aGVuIHsKICAgICAgY29kaW5nOiB7CiAgICAgICAgQ0NMLkZvcm1hdENvZGUoIkFudGhyYXggdmFjY2luYXRpb24gY29kZSIpLAogICAgICAgIENDTC5Gb3JtYXRDb2RlKCJGaXJzdCBhbnRocmF4IHZhY2NpbmF0aW9uIGNvZGUiKQogICAgICB9CiAgICB9CiAgICB3aGVuIE5leHRWYWNjaW5lRG9zZU51bWJlciA9IDIgdGhlbiB7CiAgICAgIGNvZGluZzogewogICAgICAgIENDTC5Gb3JtYXRDb2RlKCJBbnRocmF4IHZhY2NpbmF0aW9uIGNvZGUiKSwKICAgICAgICBDQ0wuRm9ybWF0Q29kZSgiU2Vjb25kIGFudGhyYXggdmFjY2luYXRpb24gY29kZSIpCiAgICAgIH0KICAgIH0KICAgIHdoZW4gTmV4dFZhY2NpbmVEb3NlTnVtYmVyID0gMyB0aGVuIHsKICAgICAgY29kaW5nOiB7CiAgICAgICAgQ0NMLkZvcm1hdENvZGUoIkFudGhyYXggdmFjY2luYXRpb24gY29kZSIpLAogICAgICAgIENDTC5Gb3JtYXRDb2RlKCJUaGlyZCBhbnRocmF4IHZhY2NpbmF0aW9uIGNvZGUiKQogICAgICB9CiAgICB9CiAgICBlbHNlIG51bGwKICAgIGVuZAoKLy8gQWRkaXRpb25hbCBpbnN0cnVjdGlvbnMgZm9yIHRoZSBWYWNjaW5lUmVxdWVzdC4KZGVmaW5lIFZhY2NpbmVBZGRpdGlvbmFsSW5zdHJ1Y3Rpb25zOgogIGlmIChJc1ByZWduYW50KSB0aGVuIHsKICAgIHsKICAgICAgdGV4dDogJ1ByZWduYW50IHdvbWVuIGF0IHJpc2sgZm9yIGluaGFsYXRpb24gYW50aHJheCBzaG91bGQgcmVjZWl2ZSB0aGUgYW50aHJheCB2YWNjaW5lIHJlZ2FyZGxlc3Mgb2YgcHJlZ25hbmN5IHRyaW1lc3Rlci4nCiAgICB9LAogICAgewogICAgICB0ZXh0OiAnRXBpbmVwaHJpbmUgc29sdXRpb24gKDE6MTAwMCkgc2hvdWxkIGJlIGF2YWlsYWJsZSBmb3IgaW1tZWRpYXRlIHVzZSBpbiB0aGUgZXZlbnQgdGhhdCBhbiBhbmFwaHlsYWN0aWMgcmVhY3Rpb24gb2NjdXJzLicKICAgIH0KICB9CiAgZWxzZSB7CiAgICAgIHRleHQ6ICdFcGluZXBocmluZSBzb2x1dGlvbiAoMToxMDAwKSBzaG91bGQgYmUgYXZhaWxhYmxlIGZvciBpbW1lZGlhdGUgdXNlIGluIHRoZSBldmVudCB0aGF0IGFuIGFuYXBoeWxhY3RpYyByZWFjdGlvbiBvY2N1cnMuJwogIH0KCi8vIERlc2NyaXB0aW9uIHRvIGJlIHVzZWQgaW4gYWxsIEFjdGl2aXR5RGVmaW50aW9uIHJlc291cmNlcyBnZW5lcmF0ZWQgYnkgdGhpcyBsaWJyYXJ5CmRlZmluZSBBY3Rpdml0eURlZmluaXRpb25EZXNjcmlwdGlvbjoKICAnSW4gMjAwOSwgdGhlIFVTIEFkdmlzb3J5IENvbW1pdHRlZSBvbiBJbW11bml6YXRpb24gUHJhY3RpY2VzIHJlY29tbWVuZGVkIGluIGFkZGl0aW9uIHRvIGFudGltaWNyb2JpYWwgdGhlcmFweSwgYSAzLWRvc2Ugc2VyaWVzIG9mIEFudGhyYXggVmFjY2luZSBBZHNvcmJlZCAoQVZBKSBCaW9UaHJheCAoRW1lcmdlbnQgQmlvU29sdXRpb25zIEluYy4sIFJvY2t2aWxsZSwgTUQsIFVTQSkgZm9yIGxvbmctdGVybSBwcm90ZWN0aW9uIGFmdGVyIGV4cG9zdXJlIHRvIGFudGhyYXggIGluIGluZGl2aWR1YWxzIHdpdGhvdXQgYW55IHByZXZpb3VzIHZhY2NpbmUuIEFmdGVyIGV4cG9zdXJlIHRvIGFlcm9zb2xpemVkIEIuIGFudGhyYWNpcyBzcG9yZXMsIGFudGltaWNyb2JpYWwgdGhlcmFweSBzaG91bGQgYmUgaW5pdGlhdGVkIGFzIHNvb24gYXMgcG9zc2libGUuIElkZWFsbHksIHRoZSBmaXJzdCBkb3NlIG9mIHZhY2NpbmUgc2hvdWxkIGJlIGFkbWluaXN0ZXJlZCB3aXRoaW4gMTAgZGF5cy4gQUNJUCByZWNvbW1lbmRzIGEgcG9zdCBleHBvc3VyZSByZWdpbWVuIG9mIDYwIGRheXMgb2YgYXBwcm9wcmlhdGUgYW50aW1pY3JvYmlhbCBwcm9waHlsYXhpcyAoY292ZXJlZCBwcmV2aW91c2x5KSBjb21iaW5lZCB3aXRoIDMgc3ViY3V0YW5lb3VzIGRvc2VzIG9mIEFWQSAoYWRtaW5pc3RlcmVkIGF0IDAsIDIsIGFuZCA0IHdlZWtzIHBvc3QgZXhwb3N1cmUpIGFzIHRoZSBtb3N0IGVmZmVjdGl2ZSBwcm90ZWN0aW9uIGFnYWluc3QgaW5oYWxhdGlvbiBhbnRocmF4IGZvciBwcmV2aW91c2x5IHVudmFjY2luYXRlZCBwZXJzb25zIGFnZWQg4omlMTggeWVhcnMgd2hvIGhhdmUgYmVlbiBleHBvc2VkIHRvIGFlcm9zb2xpemVkIEIuIGFudGhyYWNpcyBzcG9yZXMuIEluIGdlbmVyYWwsIHRoZSBwZWFrIHNlcm9sb2dpYyByZXNwb25zZSB0byBhbnRocmF4IHZhY2NpbmUgb2NjdXJzIDEw4oCTMTQgZGF5cyBhZnRlciB0aGUgdGhpcmQgZG9zZS4gKFdyaWdodCwgSi5HIGV0IGFsLiwgTW9yYmlkaXR5IGFuZCBNb3J0YWxpdHkgV2Vla2x5IFJlcG9ydCwgSnVseSAyMywgMjAxMCAvIDU5KFJSMDYpOyAxLTMwKS4gQWRkaXRpb25hbGx5LCB0aGUgQWR2aXNvcnkgQ29tbWl0dGVlIG9uIEltbXVuaXphdGlvbiBQcmFjdGljZXMgc3Vic2VxdWVudGx5IHJldmlld2VkIGFsbCBzYWZldHkgZGF0YSBhdmFpbGFibGUgYXMgb2YgTWFyY2ggMjAwOCwgaW5jbHVkaW5nIHRoZSBmaW5hbCByZXN1bHRzIG9mIGEgcmV0cm9zcGVjdGl2ZSBzdHVkeSwgYW5kIGNvbmNsdWRlZCB0aGF0IEFWQSBpcyBzYWZlIHRvIGFkbWluaXN0ZXIgdG8gYW50aHJheC1leHBvc2VkIHdvbWVuIGR1cmluZyBwcmVnbmFuY3kuIEluIHRoZSBzZXR0aW5nIG9mIGFuIGFudGhyYXggZXZlbnQgdGhhdCBwb3NlcyBhIGhpZ2ggcmlzayBmb3IgZXhwb3N1cmUgdG8gYWVyb3NvbGl6ZWQgQi4gYW50aHJhY2lzIHNwb3JlcywgcHJlZ25hbmN5IGlzIG5laXRoZXIgYSBwcmVjYXV0aW9uIG5vciBhIGNvbnRyYWluZGljYXRpb24gdG8gdmFjY2luYXRpb24uIFByZWduYW50IHdvbWVuIGF0IHJpc2sgZm9yIGluaGFsYXRpb24gYW50aHJheCBzaG91bGQgcmVjZWl2ZSBBVkEgYW5kIGFudGltaWNyb2JpYWwgZHJ1ZyB0aGVyYXB5IHJlZ2FyZGxlc3Mgb2YgcHJlZ25hbmN5IHRyaW1lc3RlciAoTWVhbnllLURlbG1hbiBEIGV0IGFsLiwgRW1lcmcgSW5mZWN0IERpcywgMjAoMiksIDIwMTQpLicKCi8vIFB1cnBvc2UgdG8gYmUgdXNlZCBpbiBhbGwgQWN0aXZpdHlEZWZpbnRpb24gcmVzb3VyY2VzIGdlbmVyYXRlZCBieSB0aGlzIGxpYnJhcnkKZGVmaW5lIEFjdGl2aXR5RGVmaW5pdGlvblB1cnBvc2U6CiAgJ1Byb3ZpZGVzIGNsaW5pY2lhbnMgd2l0aCBpbmZvcm1hdGlvbiBmb3IgcXVpY2tseSBhc3Nlc3NpbmcgaW5kaXZpZHVhbHMgZXhwb3NlZCB0byBhbnRocmF4IHVucmVsYXRlZCB0byBvY2N1cGF0aW9uYWwgZXhwb3N1cmUsIGZvciBleGFtcGxlIGluIGJpb3RlcnJvcmlzbSBldmVudHMsIGFuZCBwcm92aWRlcyB0aGUgcmVjb21tZW5kZWQgcG9zdC1leHBvc3VyZSBwcm9waHlsYXhpcyAoUEVQKSByZWdpbWVuIGZvciBhc3ltcHRvbWF0aWMgcGF0aWVudHMuIEluY2x1ZGVzIGltbWVkaWF0ZSB0cmVhdG1lbnQgd2l0aCBhbnRpbWljcm9iaWFscyBhbmQgdmFjY2luZSBhbmQgZm9sbG93LXVwIGFkbWluaXN0cmF0aW9uIG9mIHN1YnNlcXVlbnQgdmFjY2luZXMgdG8gY29tcGxldGUgdGhlIHJlY29tbWVuZGVkIDMtZG9zZSB2YWNjaW5hdGlvbiBzZXJpZXMuJwoKLy8gVXNhZ2UgdG8gYmUgdXNlZCBpbiBhbGwgQWN0aXZpdHlEZWZpbnRpb24gcmVzb3VyY2VzIGdlbmVyYXRlZCBieSB0aGlzIGxpYnJhcnkKZGVmaW5lIEFjdGl2aXR5RGVmaW5pdGlvblVzYWdlOgogICdJbnRlbmRlZCBmb3IgdXNlIGJ5IGNsaW5pY2lhbnMgY2FyaW5nIGZvciBpbmRpdmlkdWFscyDiiaUxOCB5ZWFycyBvZiBhZ2UgaW4gYW4gb3V0cGF0aWVudCBzZXR0aW5nLicKCi8vIFVzYWdlQ29udGV4dCB0byBiZSB1c2VkIGluIGFsbCBBY3Rpdml0eURlZmluaXRpb24gYW5kIFBsYW5EZWZpbml0aW9uIHJlc291cmNlcyBnZW5lcmF0ZWQgYnkgdGhpcyBsaWJyYXJ5CmRlZmluZSBUcmVhdG1lbnRVc2VDb250ZXh0OgogIHsKICAgIHsKICAgICAgY29kZTogQ0NMLkZvcm1hdENvZGUoIkZISVIgYWdlIHJhbmdlIHVzYWdlIGNvbnRleHQgY29kZSIpLAogICAgICB2YWx1ZVJhbmdlOiB7CiAgICAgICAgbG93OiB7CiAgICAgICAgICB2YWx1ZTogMTgKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICB7CiAgICAgIGNvZGU6IENDTC5Gb3JtYXRDb2RlKCJGSElSIGNsaW5pY2FsIHZlbnVlIHVzYWdlIGNvbnRleHQgY29kZSIpLAogICAgICB2YWx1ZUNvZGVhYmxlQ29uY2VwdDogewogICAgICAgIGNvZGluZzogeyBDQ0wuRm9ybWF0Q29kZSgiU05PTUVEIG91dHBhdGllbnQgY29kZSIpIH0KICAgICAgfQogICAgfSwKICAgIHsKICAgICAgY29kZTogQ0NMLkZvcm1hdENvZGUoIkZISVIgY2xpbmljYWwgZm9jdXMgdXNhZ2UgY29udGV4dCBjb2RlIiksCiAgICAgIHZhbHVlQ29kZWFibGVDb25jZXB0OiB7CiAgICAgICAgY29kaW5nOiB7IENDTC5Gb3JtYXRDb2RlKCJFeHBvc3VyZSB0byBBbnRocmF4IGNvZGUiKSB9CiAgICAgIH0KICAgIH0sCiAgICB7CiAgICAgIGNvZGU6IENDTC5Gb3JtYXRDb2RlKCJGSElSIGNsaW5pY2FsIGZvY3VzIHVzYWdlIGNvbnRleHQgY29kZSIpLAogICAgICB2YWx1ZUNvZGVhYmxlQ29uY2VwdDogewogICAgICAgIGNvZGluZzogeyBDQ0wuRm9ybWF0Q29kZSgiRXhwb3N1cmUgdG8gQmFjaWxsdXMgYW50aHJhY2lzIChldmVudCkgY29kZSIpIH0KICAgICAgfQogICAgfSwKICAgIHsKICAgICAgY29kZTogQ0NMLkZvcm1hdENvZGUoIkZISVIgY2xpbmljYWwgZm9jdXMgdXNhZ2UgY29udGV4dCBjb2RlIiksCiAgICAgIHZhbHVlQ29kZWFibGVDb25jZXB0OiB7CiAgICAgICAgY29kaW5nOiB7IENDTC5Gb3JtYXRDb2RlKCJBc3ltcHRvbWF0aWMgY29kZSIpIH0KICAgICAgfQogICAgfQogIH0KCi8vIFRvcGljcyBmb3IgdGhpcyBsaWJyYXJ5ICh1c2VkIGluIGFsbCBnZW5lcmF0ZWQgQWN0aXZpdHlEZWZpbml0aW9uIGFuZCBQbGFuRGVmaW5pdGlvbiByZXNvdXJjZXMpCmRlZmluZSBUb3BpY3M6CiAgewogICAgewogICAgICB0ZXh0OiAnQW50aHJheCcKICAgIH0sCiAgICB7CiAgICAgIHRleHQ6ICdFbWVyZ2VuY3kgTWVkaWNpbmUnCiAgICB9LAogICAgewogICAgICB0ZXh0OiAnUG9zdC1FeHBvc3VyZSBQcm9waHlsYXhpcycKICAgIH0KICB9CgovLyBDb250cmlidXRvcnMgZm9yIHRoaXMgbGlicmFyeSAodXNlZCBpbiBhbGwgZ2VuZXJhdGVkIEFjdGl2aXR5RGVmaW5pdGlvbiBhbmQgUGxhbkRlZmluaXRpb24gcmVzb3VyY2VzKQpkZWZpbmUgQXV0aG9yOgogIHsKICAgbmFtZTogJ0FsbGlhbmNlIHRvIE1vZGVybml6ZSBIZWFsdGhjYXJlIEZGUkRDJwogIH0KCmRlZmluZSBFbmRvcnNlcjoKICB7CiAgICBuYW1lOiAnQ2VudGVycyBmb3IgRGlzZWFzZSBDb250cm9sIGFuZCBQcmV2ZW50aW9uJwogIH0KLy8gQ29udGFjdCBpbmZvcm1hdGlvbiBmb3IgdGhpcyBsaWJyYXJ5ICh1c2VkIGluIGFsbCBnZW5lcmF0ZWQgQWN0aXZpdHlEZWZpbml0aW9uIGFuZCBQbGFuRGVmaW5pdGlvbiByZXNvdXJjZXMpCmRlZmluZSBDb250YWN0SW5mbzoKICB7CiAgICB7CiAgICAgIHRlbGVjb206IHsKICAgICAgICB7CiAgICAgICAgICBzeXN0ZW06ICd1cmwnLAogICAgICAgICAgdmFsdWU6ICdodHRwczovL2Nkcy5haHJxLmdvdi9jZHNjb25uZWN0L2FydGlmYWN0L2FudGhyYXgtcG9zdC1leHBvc3VyZS1wcm9waHlsYXhpcycsCiAgICAgICAgICB1c2U6ICd3b3JrJwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCi8vIENvcHlyaWdodCBzdGF0ZW1lbnQgZm9yIHRoaXMgbGlicmFyeSAodXNlZCBpbiBhbGwgZ2VuZXJhdGVkIEFjdGl2aXR5RGVmaW5pdGlvbiBhbmQgUGxhbkRlZmluaXRpb24gcmVzb3VyY2VzKQpkZWZpbmUgQ29weXJpZ2h0U3RhdGVtZW50OgogICcoQykgMjAxOCBUaGUgTUlUUkUgQ29ycG9yYXRpb24uIEFsbCBSaWdodHMgUmVzZXJ2ZWQuJwoKLy8gQW4gQWN0aXZpdHlEZWZpbml0aW9uIHJlc291cmNlIHJlcHJlc2VudGluZyBhbiBJbW11bml6YXRpb25SZWNvbW1lbmRhdGlvbi4KZGVmaW5lIFZhY2NpbmVSZXF1ZXN0OgogIHsKICAgIHJlc291cmNlVHlwZTogJ0FjdGl2aXR5RGVmaW5pdGlvbicsCiAgICBpZDogJ1ZhY2NpbmVSZXF1ZXN0JywKICAgIHVybDogJ2h0dHBzOi8vY2RzLmFocnEuZ292L2Nkc2Nvbm5lY3QvYXJ0aWZhY3QvYW50aHJheC1wb3N0LWV4cG9zdXJlLXByb3BoeWxheGlzJywKICAgIGlkZW50aWZpZXI6IHsKICAgICAgewogICAgICAgIHZhbHVlOiAnQW50aHJheF9Qb3N0X0V4cG9zdXJlX1Byb3BoeWxheGlzX0ZISVJ2NDAwX0NRTF92MTEwL1ZhY2NpbmVSZXF1ZXN0JwogICAgICB9CiAgICB9LAogICAgdmVyc2lvbjogQ3FsVmVyc2lvbiwKICAgIG5hbWU6ICdBbnRocmF4X1Bvc3RfRXhwb3N1cmVfUHJvcGh5bGF4aXNfQWR1bHRzX1ZhY2NpbmVfUmVxdWVzdCcsCiAgICB0aXRsZTogJ0FudGhyYXggUG9zdCBFeHBvc3VyZSBQcm9waHlsYXhpcyAoUEVQKSBmb3IgQWR1bHRzOiBWYWNjaW5lIFJlcXVlc3QnLAogICAgc3RhdHVzOiAnZHJhZnQnLAogICAgZXhwZXJpbWVudGFsOiB0cnVlLAogICAgZGF0ZTogJzIwMTktMDYtMDcnLAogICAgcHVibGlzaGVyOiAnQ2VudGVycyBmb3IgRGlzZWFzZSBDb250cm9sIGFuZCBQcmV2ZW50aW9uJywKICAgIGRlc2NyaXB0aW9uOiBBY3Rpdml0eURlZmluaXRpb25EZXNjcmlwdGlvbiwKICAgIHB1cnBvc2U6IEFjdGl2aXR5RGVmaW5pdGlvblB1cnBvc2UsCiAgICB1c2FnZTogQWN0aXZpdHlEZWZpbml0aW9uVXNhZ2UsCiAgICBhcHByb3ZhbERhdGU6ICcyMDE5LTA2LTA3JywKICAgIGxhc3RSZXZpZXdEYXRlOiAnMjAxOS0wNi0wNycsCiAgICBlZmZlY3RpdmVQZXJpb2Q6IHsKICAgICAgc3RhcnQ6ICcyMDE5LTA2LTA3JwogICAgfSwKICAgIHVzZUNvbnRleHQ6IFRyZWF0bWVudFVzZUNvbnRleHQsCiAgICB0b3BpYzogVG9waWNzLAogICAgYXV0aG9yOiB7QXV0aG9yfSwKICAgIGVuZG9yc2VyOiB7RW5kb3JzZXJ9LAogICAgY29udGFjdDogQ29udGFjdEluZm8sCiAgICBjb3B5cmlnaHQ6IENvcHlyaWdodFN0YXRlbWVudCwKICAgIGtpbmQ6ICdJbW11bml6YXRpb25SZWNvbW1lbmRhdGlvbicsCiAgICBjb2RlOiBWYWNjaW5lQ29kaW5nLAogICAgcHJvZHVjdENvZGVhYmxlQ29uY2VwdDogewogICAgICBjb2Rpbmc6IHsgQ0NMLkZvcm1hdENvZGUoIkFudGhyYXggdmFjY2luZSBDVlggY29kZSIpIH0KICAgIH0sCiAgICBkb3NhZ2U6IHsKICAgICAgewogICAgICAgIHRleHQ6ICcwLjVtTCcsCiAgICAgICAgYWRkaXRpb25hbEluc3RydWN0aW9uOiBWYWNjaW5lQWRkaXRpb25hbEluc3RydWN0aW9ucywKICAgICAgICBkb3NlQW5kUmF0ZTogeyB7CiAgICAgICAgICBkb3NlUXVhbnRpdHk6IHsKICAgICAgICAgICAgdmFsdWU6IDAuNSwKICAgICAgICAgICAgdW5pdDogJ21MJywKICAgICAgICAgICAgc3lzdGVtOiAnaHR0cDovL3VuaXRzb2ZtZWFzdXJlLm9yZycsCiAgICAgICAgICAgIGNvZGU6ICdtTCcKICAgICAgICAgIH0KICAgICAgICB9IH0sCiAgICAgICAgcm91dGU6IHsKICAgICAgICAgIGNvZGluZzogeyBDQ0wuRm9ybWF0Q29kZSgiU3ViY3V0YW5lb3VzIHJvdXRlIGNvZGUiKSB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKLy8gVGhlIHRpdGxlIFZhY2NpbmVBY3Rpb24gZGVwZW5kcyBvbiB3aGF0IGRvc2UgdGhlIHBhdGllbnQgaXMgZ2V0dGluZy4KZGVmaW5lIFZhY2NpbmVBY3Rpb25UaXRsZToKICBjYXNlCiAgICB3aGVuIE5leHRWYWNjaW5lRG9zZU51bWJlciA9IDEgdGhlbiAnQW50aHJheCBWYWNjaW5hdGlvbiAtIDFzdCBkb3NlJwogICAgd2hlbiBOZXh0VmFjY2luZURvc2VOdW1iZXIgPSAyIHRoZW4gJ0FudGhyYXggVmFjY2luYXRpb24gLSAybmQgZG9zZScKICAgIHdoZW4gTmV4dFZhY2NpbmVEb3NlTnVtYmVyID0gMyB0aGVuICdBbnRocmF4IFZhY2NpbmF0aW9uIC0gM3JkIGRvc2UnCiAgICBlbHNlICcnCiAgZW5kCgovKiBUaGUgdmFjY2luZSBBY3Rpb24gdG8gYXBwZWFyIGluIHRoZSBvcmRlciBzZXQuIFJlZmVyZW5jZXMgVmFjY2luZVJlcXVlc3QgcmVzb3VyY2UuCklmIHRoZSBwYXRpZW50IGRvZXNuJ3QgbWVldCB0aGUgaW5jbHVzaW9uIGNyaXRlcmlhIGFuZCBpc24ndCByZWFkeSBmb3IgdGhlIG5leHQgZG9zZSwKdGhlbiB0aGlzIHdpbGwgYmUgZW1wdHkuCiovCmRlZmluZSBWYWNjaW5lQWN0aW9uOgogIGlmIChSZWNlbnRseUV4cG9zZWRUb0FudGhyYXggYW5kIElzMThvck9sZGVyIGFuZCBBc3ltcHRvbWF0aWMgYW5kIFJlYWR5Rm9yTmV4dFZhY2NpbmVEb3NlKSB0aGVuIHsKICAgIHRpdGxlOiBWYWNjaW5lQWN0aW9uVGl0bGUsCiAgICB0eXBlOiB7CiAgICAgIGNvZGluZzogeyBDQ0wuRm9ybWF0Q29kZSgiRkhJUiBBY3Rpb25UeXBlIGNyZWF0ZSBjb2RlIikgfQogICAgfSwKICAgIGRlZmluaXRpb25DYW5vbmljYWw6ICcjJyArIFZhY2NpbmVSZXF1ZXN0LmlkCiAgfSBlbHNlIG51bGwKCi8vIElmIHRoZSBwYXRpZW50IGlzIHByZWduYW50LCBhZGRpdGlvbmFsIHRleHQgd2lsbCBiZSBhZGRlZCB0byB0aGUgQ2lwcm9mbG94YWNpblJlcXVlc3QuCmRlZmluZSBQcmVnbmFuY3lQcmlvcml0eUNpcHJvZmxveGFjaW46CiAgaWYgKElzUHJlZ25hbnQpIHRoZW4gJ0ZJUlNUIENIT0lDRTogJwogIGVsc2UgJycKCi8qIEFkZGl0aW9uYWwgaW5zdHJ1Y3Rpb25zIGZvciB0aGUgYW50aW1pY3JvYmlhbHMsIHdoaWNoIGlzIG9ubHkgZGlzcGxheWVkIGZvciBwYXRpZW50cyB3aG8KYXJlIHByZWduYW50LgoqLwpkZWZpbmUgQW50aW1pY3JvYmlhbFByZWduYW5jeUluc3RydWN0aW9uczoKIGlmIChJc1ByZWduYW50KSB0aGVuCiB7CiAgIHRleHQ6ICdQcmVnbmFudCB3b21lbiBhdCByaXNrIGZvciBpbmhhbGF0aW9uIGFudGhyYXggc2hvdWxkIHJlY2VpdmUgYW50aW1pY3JvYmlhbCBkcnVnIHRoZXJhcHkgcmVnYXJkbGVzcyBvZiBwcmVnbmFuY3kgdHJpbWVzdGVyLicKIH0KIGVsc2UgbnVsbAoKLyogQWRkaXRpb25hbCBpbnN0cnVjdGlvbnMgZm9yIHRoZSBDaXByb2Zsb3hhY2luUmVxdWVzdCwgaW5jbHVkaW5nIGEgbWVzc2FnZSBkaXNwbGF5ZWQgb25seQpmb3IgcHJlZ25hbnQgcGF0aWVudHMuCiovCmRlZmluZSBDaXByb2Zsb3hhY2luQWRkaXRpb25hbEluc3RydWN0aW9uczoKICBBbnRpbWljcm9iaWFsUHJlZ25hbmN5SW5zdHJ1Y3Rpb25zIHVuaW9uCiAgewogICAgewogICAgICB0ZXh0OiAnQ09OVFJBSU5ESUNBVElPTlM6IERpYWdub3NpcyBvZiBteWFzdGhlbmlhIGdyYXZpcyBhbmQgdGFraW5nIHRpemFuaWRpbmUuJwogICAgfSwKICAgIHsKICAgICAgdGV4dDogJ0NBVVRJT05TOiBJZiBwYXRpZW50IGlzIHRha2luZyAgYmxvb2QgdGhpbm5lcnMsIG9yYWwgYW50aWRpYWJldGljIGRydWdzLCBzZWl6dXJlIGRydWdzLCB0aGVvcGh5bGxpbmUsIGRydWdzIHRoYXQgcHJvbG9uZyBRVCBpbnRlcnZhbCwgZHVsb3hldGluZSAoQ3ltYmFsdGEpLCB6b2xwaWRlbSAoQW1iaWVuKSwgY2xvemFwaW5lIG9yIGFueSBvdGhlciBkcnVnIHRoYXQgbWF5IGludGVyYWN0IGFuZCBjYXVzZSBzZXJpb3VzIHNpZGUgZWZmZWN0cywgY29uc2lkZXIgYW5vdGhlciBhbnRpYmlvdGljIHJlZ2ltZW4uJwogICAgfSwKICAgIHsKICAgICAgdGV4dDogJ1Byb3ZpZGUgcGF0aWVudCBlZHVjYXRpb24gb24gbWVkaWNhdGlvbnMuJwogICAgfQogIH0KCi8vIEFuIEFjdGl2aXR5RGVmaW5pdGlvbiByZXNvdXJjZSByZXByZXNlbnRpbmcgYSBNZWRpY2F0aW9uUmVxdWVzdCBmb3IgQ2lwcm9mbG94YWNpbi4KZGVmaW5lIENpcHJvZmxveGFjaW5SZXF1ZXN0OgogIHsKICAgIHJlc291cmNlVHlwZTogJ0FjdGl2aXR5RGVmaW5pdGlvbicsCiAgICBpZDogJ0NpcHJvZmxveGFjaW5SZXF1ZXN0JywKICAgIHVybDogJ2h0dHBzOi8vY2RzLmFocnEuZ292L2Nkc2Nvbm5lY3QvYXJ0aWZhY3QvYW50aHJheC1wb3N0LWV4cG9zdXJlLXByb3BoeWxheGlzJywKICAgIGlkZW50aWZpZXI6IHsKICAgICAgewogICAgICAgIHZhbHVlOiAnQW50aHJheF9Qb3N0X0V4cG9zdXJlX1Byb3BoeWxheGlzX0ZISVJ2NDAwX0NRTF92MTEwL0NpcHJvZmxveGFjaW5SZXF1ZXN0JwogICAgICB9CiAgICB9LAogICAgdmVyc2lvbjogQ3FsVmVyc2lvbiwKICAgIG5hbWU6ICdBbnRocmF4X1Bvc3RfRXhwb3N1cmVfUHJvcGh5bGF4aXNfQWR1bHRzX0NpcHJvZmxveGFjaW5fUmVxdWVzdCcsCiAgICB0aXRsZTogJ0FudGhyYXggUG9zdCBFeHBvc3VyZSBQcm9waHlsYXhpcyAoUEVQKSBmb3IgQWR1bHRzOiBDaXByb2Zsb3hhY2luIFJlcXVlc3QnLAogICAgc3RhdHVzOiAnZHJhZnQnLAogICAgZXhwZXJpbWVudGFsOiB0cnVlLAogICAgZGF0ZTogJzIwMTktMDYtMDcnLAogICAgcHVibGlzaGVyOiAnQ2VudGVycyBmb3IgRGlzZWFzZSBDb250cm9sIGFuZCBQcmV2ZW50aW9uJywKICAgIGRlc2NyaXB0aW9uOiBBY3Rpdml0eURlZmluaXRpb25EZXNjcmlwdGlvbiwKICAgIHB1cnBvc2U6IEFjdGl2aXR5RGVmaW5pdGlvblB1cnBvc2UsCiAgICB1c2FnZTogQWN0aXZpdHlEZWZpbml0aW9uVXNhZ2UsCiAgICBhcHByb3ZhbERhdGU6ICcyMDE5LTA2LTA3JywKICAgIGxhc3RSZXZpZXdEYXRlOiAnMjAxOS0wNi0wNycsCiAgICBlZmZlY3RpdmVQZXJpb2Q6IHsKICAgICAgc3RhcnQ6ICcyMDE5LTA2LTA3JwogICAgfSwKICAgIHVzZUNvbnRleHQ6IFRyZWF0bWVudFVzZUNvbnRleHQsCiAgICB0b3BpYzogVG9waWNzLAogICAgYXV0aG9yOiB7QXV0aG9yfSwKICAgIGVuZG9yc2VyOiB7RW5kb3JzZXJ9LAogICAgY29udGFjdDogQ29udGFjdEluZm8sCiAgICBjb3B5cmlnaHQ6IENvcHlyaWdodFN0YXRlbWVudCwKICAgIGtpbmQ6ICdNZWRpY2F0aW9uUmVxdWVzdCcsCiAgICBwcm9kdWN0Q29kZWFibGVDb25jZXB0OiB7CiAgICAgIGNvZGluZzogeyBDQ0wuRm9ybWF0Q29kZSgiQ2lwcm9mbG94YWNpbiBSeCBjb2RlIikgfSwKICAgICAgdGV4dDogUHJlZ25hbmN5UHJpb3JpdHlDaXByb2Zsb3hhY2luICsgIkNpcHJvZmxveGFjaW4gUnggY29kZSIuZGlzcGxheQogICAgfSwKICAgIHF1YW50aXR5OiB7CiAgICAgIHZhbHVlOiAxMjAsCiAgICAgIHN5c3RlbTogJ2h0dHA6Ly9obDcub3JnL2ZoaXIvdjMvb3JkZXJhYmxlRHJ1Z0Zvcm0nLAogICAgICBjb2RlOiAnT1JUQUInCiAgICB9LAogICAgZG9zYWdlOiB7CiAgICAgIHsKICAgICAgICB0ZXh0OiAnT25lIGV2ZXJ5IDEyIGhvdXJzIGZvciA2MCBkYXlzJywKICAgICAgICBhZGRpdGlvbmFsSW5zdHJ1Y3Rpb246IENpcHJvZmxveGFjaW5BZGRpdGlvbmFsSW5zdHJ1Y3Rpb25zLAogICAgICAgIHBhdGllbnRJbnN0cnVjdGlvbjogJ1Rha2Ugd2l0aCBmdWxsIGdsYXNzIG9mIHdhdGVyJywKICAgICAgICB0aW1pbmc6IHsKICAgICAgICAgIHJlcGVhdDogewogICAgICAgICAgICBmcmVxdWVuY3k6IDEsCiAgICAgICAgICAgIHBlcmlvZDogMTIsCiAgICAgICAgICAgIHBlcmlvZFVuaXQ6ICdoJwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcm91dGU6IHsKICAgICAgICAgIGNvZGluZzogeyBDQ0wuRm9ybWF0Q29kZSgiT3JhbCByb3V0ZSBjb2RlIikgfQogICAgICAgIH0sCiAgICAgICAgbWV0aG9kOiB7CiAgICAgICAgICBjb2Rpbmc6IHsgQ0NMLkZvcm1hdENvZGUoIlN3YWxsb3cgZG9zaW5nIGluc3RydWN0aW9uIGNvZGUiKSB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKLy8gSWYgdGhlIHBhdGllbnQgaXMgcHJlZ25hbnQsIGFkZGl0aW9uYWwgdGV4dCB3aWxsIGJlIGFkZGVkIHRvIHRoZSBEb3h5Y3ljbGluZVJlcXVlc3QuCmRlZmluZSBQcmVnbmFuY3lQcmlvcml0eURveHljeWNsaW5lOgogIGlmIChJc1ByZWduYW50KSB0aGVuICdTRUNPTkQgQ0hPSUNFOiAnCiAgZWxzZSAnJwoKLyogQWRkaXRpb25hbCBpbnN0cnVjdGlvbnMgZm9yIHRoZSBEb3h5Y3ljbGluZVJlcXVlc3QsIGluY2x1ZGluZyBhIG1lc3NhZ2UgZGlzcGxheWVkIG9ubHkKZm9yIHByZWduYW50IHBhdGllbnRzLgoqLwpkZWZpbmUgRG94eWN5Y2xpbmVBZGRpdGlvbmFsSW5zdHJ1Y3Rpb25zOgogIEFudGltaWNyb2JpYWxQcmVnbmFuY3lJbnN0cnVjdGlvbnMgdW5pb24KICB7CiAgICB7CiAgICAgIHRleHQ6ICdDQVVUSU9OUzogSWYgcGF0aWVudCBpcyB0YWtpbmcgIGJsb29kIHRoaW5uZXJzLCBvcmFsIGFudGlkaWFiZXRpYyBkcnVncywgc2VpenVyZSBkcnVncywgb3IgYW55IG90aGVyIGRydWcgdGhhdCBtYXkgaW50ZXJhY3QgYW5kIGNhdXNlIHNlcmlvdXMgc2lkZSBlZmZlY3RzLCBjb25zaWRlciBhbm90aGVyIGFudGliaW90aWMgcmVnaW1lbi4nCiAgICB9LAogICAgewogICAgICB0ZXh0OiAnUHJvdmlkZSBwYXRpZW50IGVkdWNhdGlvbiBvbiBtZWRpY2F0aW9ucy4nCiAgICB9CiAgfQoKLy8gQW4gQWN0aXZpdHlEZWZpbml0aW9uIHJlc291cmNlIHJlcHJlc2VudGluZyBhIE1lZGljYXRpb25SZXF1ZXN0IGZvciBEb3h5Y3ljbGluZS4KZGVmaW5lIERveHljeWNsaW5lUmVxdWVzdDoKICB7CiAgICByZXNvdXJjZVR5cGU6ICdBY3Rpdml0eURlZmluaXRpb24nLAogICAgaWQ6ICdEb3h5Y3ljbGluZVJlcXVlc3QnLAogICAgdXJsOiAnaHR0cHM6Ly9jZHMuYWhycS5nb3YvY2RzY29ubmVjdC9hcnRpZmFjdC9hbnRocmF4LXBvc3QtZXhwb3N1cmUtcHJvcGh5bGF4aXMnLAogICAgaWRlbnRpZmllcjogewogICAgICB7CiAgICAgICAgdmFsdWU6ICdBbnRocmF4X1Bvc3RfRXhwb3N1cmVfUHJvcGh5bGF4aXNfRkhJUnY0MDBfQ1FMX3YxMTAvRG94eWN5Y2xpbmVSZXF1ZXN0JwogICAgICB9CiAgICB9LAogICAgdmVyc2lvbjogQ3FsVmVyc2lvbiwKICAgIG5hbWU6ICdBbnRocmF4X1Bvc3RfRXhwb3N1cmVfUHJvcGh5bGF4aXNfQWR1bHRzX0RveHljeWNsaW5lX1JlcXVlc3QnLAogICAgdGl0bGU6ICdBbnRocmF4IFBvc3QgRXhwb3N1cmUgUHJvcGh5bGF4aXMgKFBFUCkgZm9yIEFkdWx0czogRG94eWN5Y2xpbmUgUmVxdWVzdCcsCiAgICBzdGF0dXM6ICdkcmFmdCcsCiAgICBleHBlcmltZW50YWw6IHRydWUsCiAgICBkYXRlOiAnMjAxOS0wNi0wNycsCiAgICBwdWJsaXNoZXI6ICdDZW50ZXJzIGZvciBEaXNlYXNlIENvbnRyb2wgYW5kIFByZXZlbnRpb24nLAogICAgZGVzY3JpcHRpb246IEFjdGl2aXR5RGVmaW5pdGlvbkRlc2NyaXB0aW9uLAogICAgcHVycG9zZTogQWN0aXZpdHlEZWZpbml0aW9uUHVycG9zZSwKICAgIHVzYWdlOiBBY3Rpdml0eURlZmluaXRpb25Vc2FnZSwKICAgIGFwcHJvdmFsRGF0ZTogJzIwMTktMDYtMDcnLAogICAgbGFzdFJldmlld0RhdGU6ICcyMDE5LTA2LTA3JywKICAgIGVmZmVjdGl2ZVBlcmlvZDogewogICAgICBzdGFydDogJzIwMTktMDYtMDcnCiAgICB9LAogICAgdXNlQ29udGV4dDogVHJlYXRtZW50VXNlQ29udGV4dCwKICAgIHRvcGljOiBUb3BpY3MsCiAgICBhdXRob3I6IHtBdXRob3J9LAogICAgZW5kb3JzZXI6IHtFbmRvcnNlcn0sCiAgICBjb250YWN0OiBDb250YWN0SW5mbywKICAgIGNvcHlyaWdodDogQ29weXJpZ2h0U3RhdGVtZW50LAogICAga2luZDogJ01lZGljYXRpb25SZXF1ZXN0JywKICAgIHByb2R1Y3RDb2RlYWJsZUNvbmNlcHQ6IHsKICAgICAgY29kaW5nOiB7IENDTC5Gb3JtYXRDb2RlKCJEb3h5Y3ljbGluZSBSeCBjb2RlIikgfSwKICAgICAgdGV4dDogUHJlZ25hbmN5UHJpb3JpdHlEb3h5Y3ljbGluZSArICJEb3h5Y3ljbGluZSBSeCBjb2RlIi5kaXNwbGF5CiAgICB9LAogICAgcXVhbnRpdHk6IHsKICAgICAgdmFsdWU6IDEyMCwKICAgICAgc3lzdGVtOiAnaHR0cDovL2hsNy5vcmcvZmhpci92My9vcmRlcmFibGVEcnVnRm9ybScsCiAgICAgIGNvZGU6ICdPUlRBQicKICAgIH0sCiAgICBkb3NhZ2U6IHsKICAgICAgewogICAgICAgIHRleHQ6ICdPbmUgZXZlcnkgMTIgaG91cnMgZm9yIDYwIGRheXMnLAogICAgICAgIGFkZGl0aW9uYWxJbnN0cnVjdGlvbjogRG94eWN5Y2xpbmVBZGRpdGlvbmFsSW5zdHJ1Y3Rpb25zLAogICAgICAgIHBhdGllbnRJbnN0cnVjdGlvbjogJ1Rha2Ugd2l0aCBmdWxsIGdsYXNzIG9mIHdhdGVyJywKICAgICAgICB0aW1pbmc6IHsKICAgICAgICAgIHJlcGVhdDogewogICAgICAgICAgICBmcmVxdWVuY3k6IDEsCiAgICAgICAgICAgIHBlcmlvZDogMTIsCiAgICAgICAgICAgIHBlcmlvZFVuaXQ6ICdoJwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcm91dGU6IHsKICAgICAgICAgIGNvZGluZzogeyBDQ0wuRm9ybWF0Q29kZSgiT3JhbCByb3V0ZSBjb2RlIikgfQogICAgICAgIH0sCiAgICAgICAgbWV0aG9kOiB7CiAgICAgICAgICBjb2Rpbmc6IHsgQ0NMLkZvcm1hdENvZGUoIlN3YWxsb3cgZG9zaW5nIGluc3RydWN0aW9uIGNvZGUiKSB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKLyogQWRkaXRpb25hbCBpbnN0cnVjdGlvbnMgZm9yIHRoZSBMZXZvZmxveGFjaW5SZXF1ZXN0LCBpbmNsdWRpbmcgYSBtZXNzYWdlIGRpc3BsYXllZCBvbmx5CmZvciBwcmVnbmFudCBwYXRpZW50cy4KKi8KZGVmaW5lIExldm9mbG94YWNpbkFkZGl0aW9uYWxJbnN0cnVjdGlvbnM6CiAgaWYgKElzUHJlZ25hbnQpIHRoZW4geyBBbnRpbWljcm9iaWFsUHJlZ25hbmN5SW5zdHJ1Y3Rpb25zIH0KICBlbHNlIHsgeyB0ZXh0OiAnbm9uZSd9IH0KCi8vIEFuIEFjdGl2aXR5RGVmaW5pdGlvbiByZXNvdXJjZSByZXByZXNlbnRpbmcgYSBNZWRpY2F0aW9uUmVxdWVzdCBmb3IgTGV2b2Zsb3hhY2luLgpkZWZpbmUgTGV2b2Zsb3hhY2luUmVxdWVzdDoKICB7CiAgICByZXNvdXJjZVR5cGU6ICdBY3Rpdml0eURlZmluaXRpb24nLAogICAgaWQ6ICdMZXZvZmxveGFjaW5SZXF1ZXN0JywKICAgIHVybDogJ2h0dHBzOi8vY2RzLmFocnEuZ292L2Nkc2Nvbm5lY3QvYXJ0aWZhY3QvYW50aHJheC1wb3N0LWV4cG9zdXJlLXByb3BoeWxheGlzJywKICAgIGlkZW50aWZpZXI6IHsKICAgICAgewogICAgICAgIHZhbHVlOiAnQW50aHJheF9Qb3N0X0V4cG9zdXJlX1Byb3BoeWxheGlzX0ZISVJ2NDAwX0NRTF92MTEwL0xldm9mbG94YWNpblJlcXVlc3QnCiAgICAgIH0KICAgIH0sCiAgICB2ZXJzaW9uOiBDcWxWZXJzaW9uLAogICAgbmFtZTogJ0FudGhyYXhfUG9zdF9FeHBvc3VyZV9Qcm9waHlsYXhpc19BZHVsdHNfTGV2b2Zsb3hhY2luX1JlcXVlc3QnLAogICAgdGl0bGU6ICdBbnRocmF4IFBvc3QgRXhwb3N1cmUgUHJvcGh5bGF4aXMgKFBFUCkgZm9yIEFkdWx0czogTGV2b2Zsb3hhY2luIFJlcXVlc3QnLAogICAgc3RhdHVzOiAnZHJhZnQnLAogICAgZXhwZXJpbWVudGFsOiB0cnVlLAogICAgZGF0ZTogJzIwMTktMDYtMDcnLAogICAgcHVibGlzaGVyOiAnQ2VudGVycyBmb3IgRGlzZWFzZSBDb250cm9sIGFuZCBQcmV2ZW50aW9uJywKICAgIGRlc2NyaXB0aW9uOiBBY3Rpdml0eURlZmluaXRpb25EZXNjcmlwdGlvbiwKICAgIHB1cnBvc2U6IEFjdGl2aXR5RGVmaW5pdGlvblB1cnBvc2UsCiAgICB1c2FnZTogQWN0aXZpdHlEZWZpbml0aW9uVXNhZ2UsCiAgICBhcHByb3ZhbERhdGU6ICcyMDE5LTA2LTA3JywKICAgIGxhc3RSZXZpZXdEYXRlOiAnMjAxOS0wNi0wNycsCiAgICBlZmZlY3RpdmVQZXJpb2Q6IHsKICAgICAgc3RhcnQ6ICcyMDE5LTA2LTA3JwogICAgfSwKICAgIHVzZUNvbnRleHQ6IFRyZWF0bWVudFVzZUNvbnRleHQsCiAgICB0b3BpYzogVG9waWNzLAogICAgYXV0aG9yOiB7QXV0aG9yfSwKICAgIGVuZG9yc2VyOiB7RW5kb3JzZXJ9LAogICAgY29udGFjdDogQ29udGFjdEluZm8sCiAgICBjb3B5cmlnaHQ6IENvcHlyaWdodFN0YXRlbWVudCwKICAgIGtpbmQ6ICdNZWRpY2F0aW9uUmVxdWVzdCcsCiAgICBwcm9kdWN0Q29kZWFibGVDb25jZXB0OiB7CiAgICAgIGNvZGluZzogeyBDQ0wuRm9ybWF0Q29kZSgiTGV2b2Zsb3hhY2luIFJ4IGNvZGUiKSB9LAogICAgICB0ZXh0OiAiTGV2b2Zsb3hhY2luIFJ4IGNvZGUiLmRpc3BsYXkKICAgIH0sCiAgICBxdWFudGl0eTogewogICAgICB2YWx1ZTogNjAsCiAgICAgIHN5c3RlbTogJ2h0dHA6Ly9obDcub3JnL2ZoaXIvdjMvb3JkZXJhYmxlRHJ1Z0Zvcm0nLAogICAgICBjb2RlOiAnT1JUQUInCiAgICB9LAogICAgZG9zYWdlOiB7CiAgICAgIHsKICAgICAgICB0ZXh0OiAnT25lIGV2ZXJ5IGRheSBmb3IgNjAgZGF5cycsCiAgICAgICAgYWRkaXRpb25hbEluc3RydWN0aW9uOiBMZXZvZmxveGFjaW5BZGRpdGlvbmFsSW5zdHJ1Y3Rpb25zLAogICAgICAgIHRpbWluZzogewogICAgICAgICAgcmVwZWF0OiB7CiAgICAgICAgICAgIGZyZXF1ZW5jeTogMSwKICAgICAgICAgICAgcGVyaW9kOiAxLAogICAgICAgICAgICBwZXJpb2RVbml0OiAnZCcKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHJvdXRlOiB7CiAgICAgICAgICBjb2Rpbmc6IHsgQ0NMLkZvcm1hdENvZGUoIk9yYWwgcm91dGUgY29kZSIpIH0KICAgICAgICB9LAogICAgICAgIG1ldGhvZDogewogICAgICAgICAgY29kaW5nOiB7IENDTC5Gb3JtYXRDb2RlKCJTd2FsbG93IGRvc2luZyBpbnN0cnVjdGlvbiBjb2RlIikgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCi8qIEFkZGl0aW9uYWwgaW5zdHJ1Y3Rpb25zIGZvciB0aGUgTW94aWZsb3hhY2luUmVxdWVzdCwgaW5jbHVkaW5nIGEgbWVzc2FnZSBkaXNwbGF5ZWQgb25seQpmb3IgcHJlZ25hbnQgcGF0aWVudHMuCiovCmRlZmluZSBNb3hpZmxveGFjaW5BZGRpdGlvbmFsSW5zdHJ1Y3Rpb25zOgogIGlmIChJc1ByZWduYW50KSB0aGVuIHsgQW50aW1pY3JvYmlhbFByZWduYW5jeUluc3RydWN0aW9ucyB9CiAgZWxzZSB7IHsgdGV4dDogJ25vbmUnfSB9CgovLyBBbiBBY3Rpdml0eURlZmluaXRpb24gcmVzb3VyY2UgcmVwcmVzZW50aW5nIGEgTWVkaWNhdGlvblJlcXVlc3QgZm9yIE1veGlmbG94YWNpbi4KZGVmaW5lIE1veGlmbG94YWNpblJlcXVlc3Q6CiAgewogICAgcmVzb3VyY2VUeXBlOiAnQWN0aXZpdHlEZWZpbml0aW9uJywKICAgIGlkOiAnTW94aWZsb3hhY2luUmVxdWVzdCcsCiAgICB1cmw6ICdodHRwczovL2Nkcy5haHJxLmdvdi9jZHNjb25uZWN0L2FydGlmYWN0L2FudGhyYXgtcG9zdC1leHBvc3VyZS1wcm9waHlsYXhpcycsCiAgICBpZGVudGlmaWVyOiB7CiAgICAgIHsKICAgICAgICB2YWx1ZTogJ0FudGhyYXhfUG9zdF9FeHBvc3VyZV9Qcm9waHlsYXhpc19GSElSdjQwMF9DUUxfdjExMC9Nb3hpZmxveGFjaW5SZXF1ZXN0JwogICAgICB9CiAgICB9LAogICAgdmVyc2lvbjogQ3FsVmVyc2lvbiwKICAgIG5hbWU6ICdBbnRocmF4X1Bvc3RfRXhwb3N1cmVfUHJvcGh5bGF4aXNfQWR1bHRzX01veGlmbG94YWNpbl9SZXF1ZXN0JywKICAgIHRpdGxlOiAnQW50aHJheCBQb3N0IEV4cG9zdXJlIFByb3BoeWxheGlzIChQRVApIGZvciBBZHVsdHM6IE1veGlmbG94YWNpbiBSZXF1ZXN0JywKICAgIHN0YXR1czogJ2RyYWZ0JywKICAgIGV4cGVyaW1lbnRhbDogdHJ1ZSwKICAgIGRhdGU6ICcyMDE5LTA2LTA3JywKICAgIHB1Ymxpc2hlcjogJ0NlbnRlcnMgZm9yIERpc2Vhc2UgQ29udHJvbCBhbmQgUHJldmVudGlvbicsCiAgICBkZXNjcmlwdGlvbjogQWN0aXZpdHlEZWZpbml0aW9uRGVzY3JpcHRpb24sCiAgICBwdXJwb3NlOiBBY3Rpdml0eURlZmluaXRpb25QdXJwb3NlLAogICAgdXNhZ2U6IEFjdGl2aXR5RGVmaW5pdGlvblVzYWdlLAogICAgYXBwcm92YWxEYXRlOiAnMjAxOS0wNi0wNycsCiAgICBsYXN0UmV2aWV3RGF0ZTogJzIwMTktMDYtMDcnLAogICAgZWZmZWN0aXZlUGVyaW9kOiB7CiAgICAgIHN0YXJ0OiAnMjAxOS0wNi0wNycKICAgIH0sCiAgICB1c2VDb250ZXh0OiBUcmVhdG1lbnRVc2VDb250ZXh0LAogICAgdG9waWM6IFRvcGljcywKICAgIGF1dGhvcjoge0F1dGhvcn0sCiAgICBlbmRvcnNlcjoge0VuZG9yc2VyfSwKICAgIGNvbnRhY3Q6IENvbnRhY3RJbmZvLAogICAgY29weXJpZ2h0OiBDb3B5cmlnaHRTdGF0ZW1lbnQsCiAgICBraW5kOiAnTWVkaWNhdGlvblJlcXVlc3QnLAogICAgcHJvZHVjdENvZGVhYmxlQ29uY2VwdDogewogICAgICBjb2Rpbmc6IHsgQ0NMLkZvcm1hdENvZGUoIk1veGlmbG94YWNpbiBSeCBjb2RlIikgfSwKICAgICAgdGV4dDogIk1veGlmbG94YWNpbiBSeCBjb2RlIi5kaXNwbGF5CiAgICB9LAogICAgcXVhbnRpdHk6IHsKICAgICAgdmFsdWU6IDYwLAogICAgICBzeXN0ZW06ICdodHRwOi8vaGw3Lm9yZy9maGlyL3YzL29yZGVyYWJsZURydWdGb3JtJywKICAgICAgY29kZTogJ09SVEFCJwogICAgfSwKICAgIGRvc2FnZTogewogICAgICB7CiAgICAgICAgdGV4dDogJ09uZSBldmVyeSBkYXkgZm9yIDYwIGRheXMnLAogICAgICAgIGFkZGl0aW9uYWxJbnN0cnVjdGlvbjogTW94aWZsb3hhY2luQWRkaXRpb25hbEluc3RydWN0aW9ucywKICAgICAgICB0aW1pbmc6IHsKICAgICAgICAgIHJlcGVhdDogewogICAgICAgICAgICBmcmVxdWVuY3k6IDEsCiAgICAgICAgICAgIHBlcmlvZDogMSwKICAgICAgICAgICAgcGVyaW9kVW5pdDogJ2QnCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICByb3V0ZTogewogICAgICAgICAgY29kaW5nOiB7IENDTC5Gb3JtYXRDb2RlKCJPcmFsIHJvdXRlIGNvZGUiKSB9CiAgICAgICAgfSwKICAgICAgICBtZXRob2Q6IHsKICAgICAgICAgIGNvZGluZzogeyBDQ0wuRm9ybWF0Q29kZSgiU3dhbGxvdyBkb3NpbmcgaW5zdHJ1Y3Rpb24gY29kZSIpIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgovKiBBZGRpdGlvbmFsIGluc3RydWN0aW9ucyBmb3IgdGhlIENsaW5kYW15Y2luUmVxdWVzdCwgaW5jbHVkaW5nIGEgbWVzc2FnZSBkaXNwbGF5ZWQgb25seQpmb3IgcHJlZ25hbnQgcGF0aWVudHMuCiovCmRlZmluZSBDbGluZGFteWNpbkFkZGl0aW9uYWxJbnN0cnVjdGlvbnM6CiAgaWYgKElzUHJlZ25hbnQpIHRoZW4geyBBbnRpbWljcm9iaWFsUHJlZ25hbmN5SW5zdHJ1Y3Rpb25zIH0KICBlbHNlIHsgeyB0ZXh0OiAnbm9uZSd9IH0KCi8vIEFuIEFjdGl2aXR5RGVmaW5pdGlvbiByZXNvdXJjZSByZXByZXNlbnRpbmcgYSBNZWRpY2F0aW9uUmVxdWVzdCBmb3IgQ2xpbmRhbXljaW4uCmRlZmluZSBDbGluZGFteWNpblJlcXVlc3Q6CiAgewogICAgcmVzb3VyY2VUeXBlOiAnQWN0aXZpdHlEZWZpbml0aW9uJywKICAgIGlkOiAnQ2xpbmRhbXljaW5SZXF1ZXN0JywKICAgIHVybDogJ2h0dHBzOi8vY2RzLmFocnEuZ292L2Nkc2Nvbm5lY3QvYXJ0aWZhY3QvYW50aHJheC1wb3N0LWV4cG9zdXJlLXByb3BoeWxheGlzJywKICAgIGlkZW50aWZpZXI6IHsKICAgICAgewogICAgICAgIHZhbHVlOiAnQW50aHJheF9Qb3N0X0V4cG9zdXJlX1Byb3BoeWxheGlzX0ZISVJ2NDAwX0NRTF92MTEwL0NsaW5kYW15Y2luUmVxdWVzdCcKICAgICAgfQogICAgfSwKICAgIHZlcnNpb246IENxbFZlcnNpb24sCiAgICBuYW1lOiAnQW50aHJheF9Qb3N0X0V4cG9zdXJlX1Byb3BoeWxheGlzX0FkdWx0c19DbGluZGFteWNpbl9SZXF1ZXN0JywKICAgIHRpdGxlOiAnQW50aHJheCBQb3N0IEV4cG9zdXJlIFByb3BoeWxheGlzIChQRVApIGZvciBBZHVsdHM6IENsaW5kYW15Y2luIFJlcXVlc3QnLAogICAgc3RhdHVzOiAnZHJhZnQnLAogICAgZXhwZXJpbWVudGFsOiB0cnVlLAogICAgZGF0ZTogJzIwMTktMDYtMDcnLAogICAgcHVibGlzaGVyOiAnQ2VudGVycyBmb3IgRGlzZWFzZSBDb250cm9sIGFuZCBQcmV2ZW50aW9uJywKICAgIGRlc2NyaXB0aW9uOiBBY3Rpdml0eURlZmluaXRpb25EZXNjcmlwdGlvbiwKICAgIHB1cnBvc2U6IEFjdGl2aXR5RGVmaW5pdGlvblB1cnBvc2UsCiAgICB1c2FnZTogQWN0aXZpdHlEZWZpbml0aW9uVXNhZ2UsCiAgICBhcHByb3ZhbERhdGU6ICcyMDE5LTA2LTA3JywKICAgIGxhc3RSZXZpZXdEYXRlOiAnMjAxOS0wNi0wNycsCiAgICBlZmZlY3RpdmVQZXJpb2Q6IHsKICAgICAgc3RhcnQ6ICcyMDE5LTA2LTA3JwogICAgfSwKICAgIHVzZUNvbnRleHQ6IFRyZWF0bWVudFVzZUNvbnRleHQsCiAgICB0b3BpYzogVG9waWNzLAogICAgYXV0aG9yOiB7QXV0aG9yfSwKICAgIGVuZG9yc2VyOiB7RW5kb3JzZXJ9LAogICAgY29udGFjdDogQ29udGFjdEluZm8sCiAgICBjb3B5cmlnaHQ6IENvcHlyaWdodFN0YXRlbWVudCwKICAgIGtpbmQ6ICdNZWRpY2F0aW9uUmVxdWVzdCcsCiAgICBwcm9kdWN0Q29kZWFibGVDb25jZXB0OiB7CiAgICAgIGNvZGluZzogeyBDQ0wuRm9ybWF0Q29kZSgiQ2xpbmRhbXljaW4gUnggY29kZSIpIH0sCiAgICAgIHRleHQ6ICJDbGluZGFteWNpbiBSeCBjb2RlIi5kaXNwbGF5CiAgICB9LAogICAgcXVhbnRpdHk6IHsKICAgICAgdmFsdWU6IDM2MCwKICAgICAgc3lzdGVtOiAnaHR0cDovL2hsNy5vcmcvZmhpci92My9vcmRlcmFibGVEcnVnRm9ybScsCiAgICAgIGNvZGU6ICdPUlRBQicKICAgIH0sCiAgICBkb3NhZ2U6IHsKICAgICAgewogICAgICAgIHRleHQ6ICdUd28gdGFibGV0cyBldmVyeSA4IGhvdXJzIGZvciA2MCBkYXlzJywKICAgICAgICBhZGRpdGlvbmFsSW5zdHJ1Y3Rpb246IENsaW5kYW15Y2luQWRkaXRpb25hbEluc3RydWN0aW9ucywKICAgICAgICB0aW1pbmc6IHsKICAgICAgICAgIHJlcGVhdDogewogICAgICAgICAgICBmcmVxdWVuY3k6IDIsCiAgICAgICAgICAgIHBlcmlvZDogOCwKICAgICAgICAgICAgcGVyaW9kVW5pdDogJ2gnCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICByb3V0ZTogewogICAgICAgICAgY29kaW5nOiB7IENDTC5Gb3JtYXRDb2RlKCJPcmFsIHJvdXRlIGNvZGUiKSB9CiAgICAgICAgfSwKICAgICAgICBtZXRob2Q6IHsKICAgICAgICAgIGNvZGluZzogeyBDQ0wuRm9ybWF0Q29kZSgiU3dhbGxvdyBkb3NpbmcgaW5zdHJ1Y3Rpb24gY29kZSIpIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgovKiBUaGUgYW50aW1pY3JvYmlhbCBBY3Rpb24gdG8gYXBwZWFyIGluIHRoZSBvcmRlciBzZXQuIFJlZmVyZW5jZXMgdGhlIGZpdmUgcHJlY2VlZGluZwphbnRpbWljcm9iaWFsIE1lZGljYXRpb25SZXF1ZXN0IHJlc291cmNlcy4gSWYgdGhlIHBhdGllbnQgZG9lc24ndCBtZWV0IHRoZSBpbmNsdXNpb24KY3JpdGVyaWEgYW5kIGFscmVhZHkgaGFzIGFuIGV4aXN0aW5nIHByZXNjcmlwdGlvbiwgdGhlbiB0aGlzIHdpbGwgYmUgZW1wdHkuCiovCmRlZmluZSBBbnRpbWljcm9iaWFsQWN0aW9uOgogIGlmIChSZWNlbnRseUV4cG9zZWRUb0FudGhyYXggYW5kIElzMThvck9sZGVyIGFuZCBBc3ltcHRvbWF0aWMpIHRoZW4gewogICAgdGl0bGU6ICdBbnRpbWljcm9iaWFsIG1lZGljYXRpb25zIGZvciBhbnRocmF4IHBvc3QtZXhwb3N1cmUgcHJvcGh5bGF4aXMnLAogICAgZ3JvdXBpbmdCZWhhdmlvcjogJ3Zpc3VhbC1ncm91cCcsCiAgICBzZWxlY3Rpb25CZWhhdmlvcjogJ2F0LW1vc3Qtb25lJywKICAgIGFjdGlvbjogewogICAgewogICAgICB0aXRsZTogJ0ZpcnN0IGxpbmUgYW50aW1pY3JvYmlhbCBtZWRpY2F0aW9ucyBmb3IgYW50aHJheCBwb3N0LWV4cG9zdXJlIHByb3BoeWxheGlzJywKICAgICAgZ3JvdXBpbmdCZWhhdmlvcjogJ3Zpc3VhbC1ncm91cCcsCiAgICAgIHNlbGVjdGlvbkJlaGF2aW9yOiAnYXQtbW9zdC1vbmUnLAogICAgICBhY3Rpb246IHsKICAgICAgICB7CiAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIGNvZGluZzogeyBDQ0wuRm9ybWF0Q29kZSgiRkhJUiBBY3Rpb25UeXBlIGNyZWF0ZSBjb2RlIikgfQogICAgICAgICAgfSwKICAgICAgICAgIGRlZmluaXRpb25DYW5vbmljYWw6ICcjJyArIENpcHJvZmxveGFjaW5SZXF1ZXN0LmlkCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIGNvZGluZzogeyBDQ0wuRm9ybWF0Q29kZSgiRkhJUiBBY3Rpb25UeXBlIGNyZWF0ZSBjb2RlIikgfQogICAgICAgICAgfSwKICAgICAgICAgIGRlZmluaXRpb25DYW5vbmljYWw6ICcjJyArIERveHljeWNsaW5lUmVxdWVzdC5pZAogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHsKICAgICAgdGl0bGU6ICdTZWNvbmQgbGluZSBhbnRpbWljcm9iaWFsIG1lZGljYXRpb25zIGZvciBhbnRocmF4IHBvc3QtZXhwb3N1cmUgcHJvcGh5bGF4aXMnLAogICAgICBncm91cGluZ0JlaGF2aW9yOiAndmlzdWFsLWdyb3VwJywKICAgICAgc2VsZWN0aW9uQmVoYXZpb3I6ICdhdC1tb3N0LW9uZScsCiAgICAgIGFjdGlvbjogewogICAgICAgIHsKICAgICAgICAgIHR5cGU6IHsKICAgICAgICAgICAgY29kaW5nOiB7IENDTC5Gb3JtYXRDb2RlKCJGSElSIEFjdGlvblR5cGUgY3JlYXRlIGNvZGUiKSB9CiAgICAgICAgICB9LAogICAgICAgICAgZGVmaW5pdGlvbkNhbm9uaWNhbDogJyMnICsgTGV2b2Zsb3hhY2luUmVxdWVzdC5pZAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdHlwZTogewogICAgICAgICAgICBjb2Rpbmc6IHsgQ0NMLkZvcm1hdENvZGUoIkZISVIgQWN0aW9uVHlwZSBjcmVhdGUgY29kZSIpIH0KICAgICAgICAgIH0sCiAgICAgICAgICBkZWZpbml0aW9uQ2Fub25pY2FsOiAnIycgKyBNb3hpZmxveGFjaW5SZXF1ZXN0LmlkCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgIGNvZGluZzogeyBDQ0wuRm9ybWF0Q29kZSgiRkhJUiBBY3Rpb25UeXBlIGNyZWF0ZSBjb2RlIikgfQogICAgICAgICAgfSwKICAgICAgICAgIGRlZmluaXRpb25DYW5vbmljYWw6ICcjJyArIENsaW5kYW15Y2luUmVxdWVzdC5pZAogICAgICAgIH0KICAgICAgfQogICAgfX0KICB9IGVsc2UgbnVsbAoKLyogVGhlIGxpc3Qgb2YgYWN0aW9ucyBmb3IgdGhlIFBsYW5EZWZpbml0aW9uIG9yZGVyIHNldC4gSXQgY2FuIGNvbnNpc3Qgb2YgQW50aW1pY3JvYmlhbEFjdGlvbiwKVmFjY2luZUFjdGlvbiwgYm90aCwgb3IgbmVpdGhlci4KKi8KZGVmaW5lIEFjdGlvbkxpc3Q6CiAgaWYgKFZhY2NpbmVBY3Rpb24gaXMgbm90IG51bGwpIHRoZW4KICAgIGlmIChBbnRpbWljcm9iaWFsQWN0aW9uIGlzIG5vdCBudWxsKSB0aGVuIHsKICAgICAgQW50aW1pY3JvYmlhbEFjdGlvbiwKICAgICAgVmFjY2luZUFjdGlvbgogICAgfQogICAgZWxzZSB7CiAgICAgIFZhY2NpbmVBY3Rpb24KICAgIH0KICBlbHNlCiAgICBpZiAoQW50aW1pY3JvYmlhbEFjdGlvbiBpcyBub3QgbnVsbCkgdGhlbiB7CiAgICAgIEFudGltaWNyb2JpYWxBY3Rpb24KICAgIH0KICAgIGVsc2UgbnVsbAoKLyogVG8gbWFrZSBwYWNrYWdpbmcgdGhlIG9yZGVyIHNldCBlYXNpZXIsIHdlIGVtYmVkIGFsbCB0aGUgQWN0aW9ucyBpbnRvIHRoZSBvcmRlciBzZXQKdXNpbmcgRkhJUiBjb250YWluZWQgcmVzb3VyY2VzLiBUaGlzIGxpc3Qgb2YgY29udGFpbmVkIHJlc291cmNlcyBjYW4gY29udGFpbiB0aGUKQWN0aXZpdHlEZWZpbml0aW9ucyBmb3IgdGhlIGFudGltaWNyb2JpYWwsIHRoZSB2YWNjaW5lLCBib3RoLCBvciBuZWl0aGVyLgoqLwpkZWZpbmUgQ29udGFpbmVkUmVzb3VyY2VzTGlzdDoKICBpZiAoVmFjY2luZUFjdGlvbiBpcyBub3QgbnVsbCkgdGhlbgogICAgaWYgKEFudGltaWNyb2JpYWxBY3Rpb24gaXMgbm90IG51bGwpIHRoZW4gewogICAgICBDaXByb2Zsb3hhY2luUmVxdWVzdCwKICAgICAgRG94eWN5Y2xpbmVSZXF1ZXN0LAogICAgICBMZXZvZmxveGFjaW5SZXF1ZXN0LAogICAgICBNb3hpZmxveGFjaW5SZXF1ZXN0LAogICAgICBDbGluZGFteWNpblJlcXVlc3QsCiAgICAgIFZhY2NpbmVSZXF1ZXN0CiAgICB9CiAgICBlbHNlIHsKICAgICAgVmFjY2luZVJlcXVlc3QKICAgIH0KICBlbHNlCiAgICBpZiAoQW50aW1pY3JvYmlhbEFjdGlvbiBpcyBub3QgbnVsbCkgdGhlbiB7CiAgICAgIENpcHJvZmxveGFjaW5SZXF1ZXN0LAogICAgICBEb3h5Y3ljbGluZVJlcXVlc3QsCiAgICAgIExldm9mbG94YWNpblJlcXVlc3QsCiAgICAgIE1veGlmbG94YWNpblJlcXVlc3QsCiAgICAgIENsaW5kYW15Y2luUmVxdWVzdAogICAgfQogICAgZWxzZSBudWxsCgpkZWZpbmUgR2VuZXJhdGVPcmRlclNldDoKICBSZWNlbnRseUV4cG9zZWRUb0FudGhyYXggYW5kIElzMThvck9sZGVyIGFuZCBBc3ltcHRvbWF0aWMKCi8qIFRoZSBvcmRlciBzZXQgY29udGFpbmluZyB0aGUgcmVjb21tZW5kZWQgdHJlYXRtZW50IGZvciBBbnRocmF4IFBFUC4gSXQgcmVmZXJlbmNlcyB0aGUKQWN0aW9uTGlzdCBhbmQgdGhlIENvbnRhaW5lZFJlc291cmNlc0xpc3QuIElmIHRyZWF0bWVudCBpcyBub3QgcmVjb21tZW5kZWQsIHRoZW4gdGhpcwpyZXNvdXJjZSB3aWxsIGJlIGVtcHR5LgoqLwpkZWZpbmUgT3JkZXJTZXQ6CiAgaWYgKEdlbmVyYXRlT3JkZXJTZXQpIHRoZW4gewogICAgcmVzb3VyY2VUeXBlOiAnUGxhbkRlZmluaXRpb24nLAogICAgdXJsOiAnaHR0cHM6Ly9jZHMuYWhycS5nb3YvY2RzY29ubmVjdC9hcnRpZmFjdC9hbnRocmF4LXBvc3QtZXhwb3N1cmUtcHJvcGh5bGF4aXMnLAogICAgaWRlbnRpZmllcjogewogICAgICB7CiAgICAgICAgdmFsdWU6ICdBbnRocmF4X1Bvc3RfRXhwb3N1cmVfUHJvcGh5bGF4aXNfRkhJUnY0MDBfQ1FMX3YxMTAvT3JkZXJTZXQnCiAgICAgIH0KICAgIH0sCiAgICB2ZXJzaW9uOiBDcWxWZXJzaW9uLAogICAgbmFtZTogJ0FudGhyYXhfUG9zdF9FeHBvc3VyZV9Qcm9waHlsYXhpc19BZHVsdHMnLAogICAgdGl0bGU6ICdBbnRocmF4IFBvc3QgRXhwb3N1cmUgUHJvcGh5bGF4aXMgKFBFUCkgZm9yIEFkdWx0cycsCiAgICBzdGF0dXM6ICdkcmFmdCcsCiAgICBleHBlcmltZW50YWw6IHRydWUsCiAgICB0eXBlOiB7CiAgICAgIGNvZGluZzogewogICAgICAgIENDTC5Gb3JtYXRDb2RlKCJGSElSIFBsYW5EZWZpbml0aW9uIGVjYS1ydWxlIGNvZGUiKSwKICAgICAgICBDQ0wuRm9ybWF0Q29kZSgiRkhJUiBQbGFuRGVmaW5pdGlvbiBvcmRlci1zZXQgY29kZSIpCiAgICAgIH0KICAgIH0sCiAgICBkYXRlOiAnMjAxOS0wNi0wNycsCiAgICBwdWJsaXNoZXI6ICdDZW50ZXJzIGZvciBEaXNlYXNlIENvbnRyb2wgYW5kIFByZXZlbnRpb24nLAogICAgZGVzY3JpcHRpb246ICdQcm92aWRlcyBpbmZvcm1hdGlvbiBmb3IgdHJlYXRpbmcgcGF0aWVudHMgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIDE4IHllYXJzIG9sZCBleHBvc2VkIHRvIGFudGhyYXggd2l0aGluIHRoZSBwYXN0IDYwIGRheXMsIHdobyBkbyBub3QgaGF2ZSBhbnRocmF4LiBJdCBpcyBkaXZpZGVkIGludG8gdHdvIHBhcnRzOiBcXG4tIFBhcnQgIzE6IEZvciBwYXRpZW50cyB0aGF0IG1heSBiZSBzeW1wdG9tYXRpYyB0byBmbGFnIHRoZSBuZWVkIHRvIGNvbmR1Y3QgYSBmdWxsIGRpYWdub3N0aWMgZXZhbHVhdGlvbiB0byBydWxlIG91dCBhbnRocmF4IGJlZm9yZSBwcm9jZWVkaW5nIHdpdGggcG9zdC1leHBvc3VyZSBwcm9waHlsYXhpcyAoUEVQKSBcXG4tIFBhcnQgIzI6IEZvciBwYXRpZW50cyAgd2hvIGFyZSAgYXN5bXB0b21hdGljIChub3QgZGlzcGxheWluZyBzaWducyBhbmQgc3ltcHRvbXMgb2YgYW50aHJheCksIGl0IHByb3ZpZGVzIHJlY29tbWVuZGVkIFBFUCByZWdpbWVuJywKICAgIHB1cnBvc2U6ICdQcm92aWRlcyBjbGluaWNpYW5zIHdpdGggaW5mb3JtYXRpb24gZm9yIHF1aWNrbHkgYXNzZXNzaW5nIGluZGl2aWR1YWxzIGV4cG9zZWQgdG8gYW50aHJheCB1bnJlbGF0ZWQgdG8gb2NjdXBhdGlvbmFsIGV4cG9zdXJlLCBmb3IgZXhhbXBsZSBpbiBiaW90ZXJyb3Jpc20gZXZlbnRzLCBhbmQgcHJvdmlkZXMgdGhlIHJlY29tbWVuZGVkIHBvc3QtZXhwb3N1cmUgcHJvcGh5bGF4aXMgKFBFUCkgcmVnaW1lbiBmb3IgYXN5bXB0b21hdGljIHBhdGllbnRzLiBJbmNsdWRlcyBpbW1lZGlhdGUgdHJlYXRtZW50IHdpdGggYW50aW1pY3JvYmlhbHMgYW5kIHZhY2NpbmUgYW5kIGZvbGxvdy11cCBhZG1pbmlzdHJhdGlvbiBvZiBzdWJzZXF1ZW50IHZhY2NpbmVzIHRvIGNvbXBsZXRlIHRoZSByZWNvbW1lbmRlZCAzLWRvc2UgdmFjY2luYXRpb24gc2VyaWVzLicsCiAgICB1c2FnZTogJ0ludGVuZGVkIGZvciB1c2UgYnkgY2xpbmljaWFucyBjYXJpbmcgZm9yIGluZGl2aWR1YWxzIOKJpTE4IHllYXJzIG9mIGFnZSBpbiBhbiBvdXRwYXRpZW50IHNldHRpbmcuJywKICAgIGFwcHJvdmFsRGF0ZTogJzIwMTktMDYtMDcnLAogICAgbGFzdFJldmlld0RhdGU6ICcyMDE5LTA2LTA3JywKICAgIGVmZmVjdGl2ZVBlcmlvZDogewogICAgICBzdGFydDogJzIwMTktMDYtMDcnCiAgICB9LAogICAgdXNlQ29udGV4dDogVHJlYXRtZW50VXNlQ29udGV4dCwKICAgIGp1cmlzZGljdGlvbjogeyB7ICJjb2RpbmciOiB7IENDTC5Gb3JtYXRDb2RlKCJVbml0ZWQgU3RhdGVzIGNvZGUiKSB9IH0gfSwKICAgIHRvcGljOiBUb3BpY3MsCiAgICBhdXRob3I6IHtBdXRob3J9LAogICAgZW5kb3JzZXI6IHtFbmRvcnNlcn0sCiAgICBjb250YWN0OiBDb250YWN0SW5mbywKICAgIGNvcHlyaWdodDogQ29weXJpZ2h0U3RhdGVtZW50LAogICAgImxpYnJhcnkiOiB7CiAgICAgICdMaWJyYXJ5L0FudGhyYXhfUG9zdF9FeHBvc3VyZV9Qcm9waHlsYXhpc19GSElSdjQwMF9MaWJyYXJ5JwogICAgfSwKICAgIGFjdGlvbjogeyB7CiAgICAgIHRpdGxlOiAnQW50aHJheCBQb3N0IEV4cG9zdXJlIFByb3BoeWxheGlzJywKICAgICAgZ3JvdXBpbmdCZWhhdmlvcjogJ2xvZ2ljYWwtZ3JvdXAnLAogICAgICBzZWxlY3Rpb25CZWhhdmlvcjogJ2FueScsCiAgICAgIHRyaWdnZXI6IHsKICAgICAgICB7CiAgICAgICAgICB0eXBlOiAnZGF0YS1hZGRlZCcsCiAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICB0eXBlOiAnQ29uZGl0aW9uJywKICAgICAgICAgICAgICBjb2RlRmlsdGVyOiB7CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIHBhdGg6ICdjb2RlJywKICAgICAgICAgICAgICAgICAgY29kZTogewogICAgICAgICAgICAgICAgICAgIENDTC5Gb3JtYXRDb2RlKCJFeHBvc3VyZSB0byBBbnRocmF4IGNvZGUiKSwKICAgICAgICAgICAgICAgICAgICBDQ0wuRm9ybWF0Q29kZSgiRXhwb3N1cmUgdG8gQmFjaWxsdXMgYW50aHJhY2lzIChldmVudCkgY29kZSIpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIHR5cGU6ICdkYXRhLWFkZGVkJywKICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgewogICAgICAgICAgICAgIHR5cGU6ICdPYnNlcnZhdGlvbicsCiAgICAgICAgICAgICAgY29kZUZpbHRlcjogewogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBwYXRoOiAnY29kZScsCiAgICAgICAgICAgICAgICAgIGNvZGU6IHsKICAgICAgICAgICAgICAgICAgICBDQ0wuRm9ybWF0Q29kZSgiRXhwb3N1cmUgdG8gQW50aHJheCBjb2RlIiksCiAgICAgICAgICAgICAgICAgICAgQ0NMLkZvcm1hdENvZGUoIkV4cG9zdXJlIHRvIEJhY2lsbHVzIGFudGhyYWNpcyAoZXZlbnQpIGNvZGUiKSwKICAgICAgICAgICAgICAgICAgICBDQ0wuRm9ybWF0Q29kZSgiQXN5bXB0b21hdGljIGNvZGUiKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICBjb25kaXRpb246IHsKICAgICAgICB7CiAgICAgICAgICBraW5kOiAnYXBwbGljYWJpbGl0eScsCiAgICAgICAgICBleHByZXNzaW9uOiB7CiAgICAgICAgICAgIGxhbmd1YWdlOiAndGV4dC9jcWwnLAogICAgICAgICAgICBleHByZXNzaW9uOiAnR2VuZXJhdGVPcmRlclNldCcKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCiAgICAgIGFjdGlvbjogQWN0aW9uTGlzdAogICAgfSB9LAogICAgY29udGFpbmVkOiBDb250YWluZWRSZXNvdXJjZXNMaXN0CiAgfQogIGVsc2UgbnVsbAo="^^xsd:base64Binary ]
  ] [
     fhir:contentType [ fhir:v "application/elm+xml" ]
  ] ) . # 

# -------------------------------------------------------------------------------------

